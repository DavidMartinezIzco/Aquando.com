<!DOCTYPE html><html><head>
      <title>dev</title>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      
      <link rel="stylesheet" href="file:///c:\Users\David Martinez\.vscode\extensions\shd101wyy.markdown-preview-enhanced-0.6.5\node_modules\@shd101wyy\mume\dependencies\katex\katex.min.css">
      
      
      
      
      
      
      
      
      
      <style>
      /**
 * prism.js Github theme based on GitHub's theme.
 * @author Sam Clarke
 */
code[class*="language-"],
pre[class*="language-"] {
  color: #333;
  background: none;
  font-family: Consolas, "Liberation Mono", Menlo, Courier, monospace;
  text-align: left;
  white-space: pre;
  word-spacing: normal;
  word-break: normal;
  word-wrap: normal;
  line-height: 1.4;

  -moz-tab-size: 8;
  -o-tab-size: 8;
  tab-size: 8;

  -webkit-hyphens: none;
  -moz-hyphens: none;
  -ms-hyphens: none;
  hyphens: none;
}

/* Code blocks */
pre[class*="language-"] {
  padding: .8em;
  overflow: auto;
  /* border: 1px solid #ddd; */
  border-radius: 3px;
  /* background: #fff; */
  background: #f5f5f5;
}

/* Inline code */
:not(pre) > code[class*="language-"] {
  padding: .1em;
  border-radius: .3em;
  white-space: normal;
  background: #f5f5f5;
}

.token.comment,
.token.blockquote {
  color: #969896;
}

.token.cdata {
  color: #183691;
}

.token.doctype,
.token.punctuation,
.token.variable,
.token.macro.property {
  color: #333;
}

.token.operator,
.token.important,
.token.keyword,
.token.rule,
.token.builtin {
  color: #a71d5d;
}

.token.string,
.token.url,
.token.regex,
.token.attr-value {
  color: #183691;
}

.token.property,
.token.number,
.token.boolean,
.token.entity,
.token.atrule,
.token.constant,
.token.symbol,
.token.command,
.token.code {
  color: #0086b3;
}

.token.tag,
.token.selector,
.token.prolog {
  color: #63a35c;
}

.token.function,
.token.namespace,
.token.pseudo-element,
.token.class,
.token.class-name,
.token.pseudo-class,
.token.id,
.token.url-reference .token.variable,
.token.attr-name {
  color: #795da3;
}

.token.entity {
  cursor: help;
}

.token.title,
.token.title .token.punctuation {
  font-weight: bold;
  color: #1d3e81;
}

.token.list {
  color: #ed6a43;
}

.token.inserted {
  background-color: #eaffea;
  color: #55a532;
}

.token.deleted {
  background-color: #ffecec;
  color: #bd2c00;
}

.token.bold {
  font-weight: bold;
}

.token.italic {
  font-style: italic;
}


/* JSON */
.language-json .token.property {
  color: #183691;
}

.language-markup .token.tag .token.punctuation {
  color: #333;
}

/* CSS */
code.language-css,
.language-css .token.function {
  color: #0086b3;
}

/* YAML */
.language-yaml .token.atrule {
  color: #63a35c;
}

code.language-yaml {
  color: #183691;
}

/* Ruby */
.language-ruby .token.function {
  color: #333;
}

/* Markdown */
.language-markdown .token.url {
  color: #795da3;
}

/* Makefile */
.language-makefile .token.symbol {
  color: #795da3;
}

.language-makefile .token.variable {
  color: #183691;
}

.language-makefile .token.builtin {
  color: #0086b3;
}

/* Bash */
.language-bash .token.keyword {
  color: #0086b3;
}

/* highlight */
pre[data-line] {
  position: relative;
  padding: 1em 0 1em 3em;
}
pre[data-line] .line-highlight-wrapper {
  position: absolute;
  top: 0;
  left: 0;
  background-color: transparent;
  display: block;
  width: 100%;
}

pre[data-line] .line-highlight {
  position: absolute;
  left: 0;
  right: 0;
  padding: inherit 0;
  margin-top: 1em;
  background: hsla(24, 20%, 50%,.08);
  background: linear-gradient(to right, hsla(24, 20%, 50%,.1) 70%, hsla(24, 20%, 50%,0));
  pointer-events: none;
  line-height: inherit;
  white-space: pre;
}

pre[data-line] .line-highlight:before, 
pre[data-line] .line-highlight[data-end]:after {
  content: attr(data-start);
  position: absolute;
  top: .4em;
  left: .6em;
  min-width: 1em;
  padding: 0 .5em;
  background-color: hsla(24, 20%, 50%,.4);
  color: hsl(24, 20%, 95%);
  font: bold 65%/1.5 sans-serif;
  text-align: center;
  vertical-align: .3em;
  border-radius: 999px;
  text-shadow: none;
  box-shadow: 0 1px white;
}

pre[data-line] .line-highlight[data-end]:after {
  content: attr(data-end);
  top: auto;
  bottom: .4em;
}html body{font-family:"Helvetica Neue",Helvetica,"Segoe UI",Arial,freesans,sans-serif;font-size:16px;line-height:1.6;color:#333;background-color:#fff;overflow:initial;box-sizing:border-box;word-wrap:break-word}html body>:first-child{margin-top:0}html body h1,html body h2,html body h3,html body h4,html body h5,html body h6{line-height:1.2;margin-top:1em;margin-bottom:16px;color:#000}html body h1{font-size:2.25em;font-weight:300;padding-bottom:.3em}html body h2{font-size:1.75em;font-weight:400;padding-bottom:.3em}html body h3{font-size:1.5em;font-weight:500}html body h4{font-size:1.25em;font-weight:600}html body h5{font-size:1.1em;font-weight:600}html body h6{font-size:1em;font-weight:600}html body h1,html body h2,html body h3,html body h4,html body h5{font-weight:600}html body h5{font-size:1em}html body h6{color:#5c5c5c}html body strong{color:#000}html body del{color:#5c5c5c}html body a:not([href]){color:inherit;text-decoration:none}html body a{color:#08c;text-decoration:none}html body a:hover{color:#00a3f5;text-decoration:none}html body img{max-width:100%}html body>p{margin-top:0;margin-bottom:16px;word-wrap:break-word}html body>ul,html body>ol{margin-bottom:16px}html body ul,html body ol{padding-left:2em}html body ul.no-list,html body ol.no-list{padding:0;list-style-type:none}html body ul ul,html body ul ol,html body ol ol,html body ol ul{margin-top:0;margin-bottom:0}html body li{margin-bottom:0}html body li.task-list-item{list-style:none}html body li>p{margin-top:0;margin-bottom:0}html body .task-list-item-checkbox{margin:0 .2em .25em -1.8em;vertical-align:middle}html body .task-list-item-checkbox:hover{cursor:pointer}html body blockquote{margin:16px 0;font-size:inherit;padding:0 15px;color:#5c5c5c;background-color:#f0f0f0;border-left:4px solid #d6d6d6}html body blockquote>:first-child{margin-top:0}html body blockquote>:last-child{margin-bottom:0}html body hr{height:4px;margin:32px 0;background-color:#d6d6d6;border:0 none}html body table{margin:10px 0 15px 0;border-collapse:collapse;border-spacing:0;display:block;width:100%;overflow:auto;word-break:normal;word-break:keep-all}html body table th{font-weight:bold;color:#000}html body table td,html body table th{border:1px solid #d6d6d6;padding:6px 13px}html body dl{padding:0}html body dl dt{padding:0;margin-top:16px;font-size:1em;font-style:italic;font-weight:bold}html body dl dd{padding:0 16px;margin-bottom:16px}html body code{font-family:Menlo,Monaco,Consolas,'Courier New',monospace;font-size:.85em !important;color:#000;background-color:#f0f0f0;border-radius:3px;padding:.2em 0}html body code::before,html body code::after{letter-spacing:-0.2em;content:"\00a0"}html body pre>code{padding:0;margin:0;font-size:.85em !important;word-break:normal;white-space:pre;background:transparent;border:0}html body .highlight{margin-bottom:16px}html body .highlight pre,html body pre{padding:1em;overflow:auto;font-size:.85em !important;line-height:1.45;border:#d6d6d6;border-radius:3px}html body .highlight pre{margin-bottom:0;word-break:normal}html body pre code,html body pre tt{display:inline;max-width:initial;padding:0;margin:0;overflow:initial;line-height:inherit;word-wrap:normal;background-color:transparent;border:0}html body pre code:before,html body pre tt:before,html body pre code:after,html body pre tt:after{content:normal}html body p,html body blockquote,html body ul,html body ol,html body dl,html body pre{margin-top:0;margin-bottom:16px}html body kbd{color:#000;border:1px solid #d6d6d6;border-bottom:2px solid #c7c7c7;padding:2px 4px;background-color:#f0f0f0;border-radius:3px}@media print{html body{background-color:#fff}html body h1,html body h2,html body h3,html body h4,html body h5,html body h6{color:#000;page-break-after:avoid}html body blockquote{color:#5c5c5c}html body pre{page-break-inside:avoid}html body table{display:table}html body img{display:block;max-width:100%;max-height:100%}html body pre,html body code{word-wrap:break-word;white-space:pre}}.markdown-preview{width:100%;height:100%;box-sizing:border-box}.markdown-preview .pagebreak,.markdown-preview .newpage{page-break-before:always}.markdown-preview pre.line-numbers{position:relative;padding-left:3.8em;counter-reset:linenumber}.markdown-preview pre.line-numbers>code{position:relative}.markdown-preview pre.line-numbers .line-numbers-rows{position:absolute;pointer-events:none;top:1em;font-size:100%;left:0;width:3em;letter-spacing:-1px;border-right:1px solid #999;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.markdown-preview pre.line-numbers .line-numbers-rows>span{pointer-events:none;display:block;counter-increment:linenumber}.markdown-preview pre.line-numbers .line-numbers-rows>span:before{content:counter(linenumber);color:#999;display:block;padding-right:.8em;text-align:right}.markdown-preview .mathjax-exps .MathJax_Display{text-align:center !important}.markdown-preview:not([for="preview"]) .code-chunk .btn-group{display:none}.markdown-preview:not([for="preview"]) .code-chunk .status{display:none}.markdown-preview:not([for="preview"]) .code-chunk .output-div{margin-bottom:16px}.scrollbar-style::-webkit-scrollbar{width:8px}.scrollbar-style::-webkit-scrollbar-track{border-radius:10px;background-color:transparent}.scrollbar-style::-webkit-scrollbar-thumb{border-radius:5px;background-color:rgba(150,150,150,0.66);border:4px solid rgba(150,150,150,0.66);background-clip:content-box}html body[for="html-export"]:not([data-presentation-mode]){position:relative;width:100%;height:100%;top:0;left:0;margin:0;padding:0;overflow:auto}html body[for="html-export"]:not([data-presentation-mode]) .markdown-preview{position:relative;top:0}@media screen and (min-width:914px){html body[for="html-export"]:not([data-presentation-mode]) .markdown-preview{padding:2em calc(50% - 457px + 2em)}}@media screen and (max-width:914px){html body[for="html-export"]:not([data-presentation-mode]) .markdown-preview{padding:2em}}@media screen and (max-width:450px){html body[for="html-export"]:not([data-presentation-mode]) .markdown-preview{font-size:14px !important;padding:1em}}@media print{html body[for="html-export"]:not([data-presentation-mode]) #sidebar-toc-btn{display:none}}html body[for="html-export"]:not([data-presentation-mode]) #sidebar-toc-btn{position:fixed;bottom:8px;left:8px;font-size:28px;cursor:pointer;color:inherit;z-index:99;width:32px;text-align:center;opacity:.4}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] #sidebar-toc-btn{opacity:1}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc{position:fixed;top:0;left:0;width:300px;height:100%;padding:32px 0 48px 0;font-size:14px;box-shadow:0 0 4px rgba(150,150,150,0.33);box-sizing:border-box;overflow:auto;background-color:inherit}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar{width:8px}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar-track{border-radius:10px;background-color:transparent}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar-thumb{border-radius:5px;background-color:rgba(150,150,150,0.66);border:4px solid rgba(150,150,150,0.66);background-clip:content-box}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc a{text-decoration:none}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc ul{padding:0 1.6em;margin-top:.8em}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc li{margin-bottom:.8em}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc ul{list-style-type:none}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{left:300px;width:calc(100% -  300px);padding:2em calc(50% - 457px -  150px);margin:0;box-sizing:border-box}@media screen and (max-width:1274px){html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{padding:2em}}@media screen and (max-width:450px){html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{width:100%}}html body[for="html-export"]:not([data-presentation-mode]):not([html-show-sidebar-toc]) .markdown-preview{left:50%;transform:translateX(-50%)}html body[for="html-export"]:not([data-presentation-mode]):not([html-show-sidebar-toc]) .md-sidebar-toc{display:none}
/* Please visit the URL below for more information: */
/*   https://shd101wyy.github.io/markdown-preview-enhanced/#/customize-css */

      </style>
    </head>
    <body for="html-export">
      <div class="mume markdown-preview  ">
      <div style="padding:1em;border:3px solid gray;border-radius:1em;">
<h1>DOCUMENTACI&#xD3;N DE AQUANDO PARA DESARROLLADORES</h1>
<h2>Manual b&#xE1;sico de desarrollador para <span style="color:darkblue;"><b>Aquando</b></span></h2>
<hr>
<h3><strong>Contenidos:</strong> &#x1F4D6;</h3>
<ul>
<li><strong>General</strong>
<ul>
<li>Informaci&#xF3;n</li>
<li>Arquitectura general</li>
<li>Dependencias</li>
</ul>
</li>
<li><strong>Controlador</strong>
<ul>
<li>Inicio.php</li>
</ul>
</li>
<li><strong>Bases de datos</strong>
<ul>
<li>Database.php</li>
<li>DataWit.php</li>
</ul>
</li>
<li><strong>Modelos</strong>
<ul>
<li>Contras.php</li>
<li>Usuario.php</li>
<li>Validador.php</li>
</ul>
</li>
<li><strong>Vistas</strong>
<ul>
<li>Inicio</li>
<li>Estaciones</li>
<li>Alarmas</li>
<li>Graficas</li>
<li>Informes</li>
<li>Comunicaciones</li>
<li>Otros</li>
</ul>
</li>
<li><strong>Lado cliente</strong>
<ul>
<li>JavaScript</li>
<li>Ajax</li>
</ul>
</li>
</ul>
<hr>
<h1>GENERAL</h1>
<h3>Informaci&#xF3;n b&#xE1;sica:</h3>
<blockquote>
<p><span style="color:darkblue;"><b>Aquando</b></span> es una aplicaci&#xF3;n API-REST escrita mayormente en <span style="color:purple"><b>PHP</b></span> y <span style="color:gold"><b>JS</b></span>.<br>
Se apoya en la plataforma CodeIgniter para organizarla en un est&#xE1;ndar de producci&#xF3;n com&#xFA;n.</p>
</blockquote>
<p>B&#xE1;sicamente, <span style="color:darkblue;"><b>Aquando</b></span> consiste en un back-end que va a escuchar las distintas peticiones que se realicen desde cliente. Dependiendo de estas, desde el controlador se decide que hacer y como.<br>
Dependiendo del tipo de petici&#xF3;n en ocasiones no ser&#xE1; el controlador lo que procese las peticiones sino archivos en <span style="color:purple"><b>PHP</b></span> tambi&#xE9;n que se comunican con el cliente a traves de <span style="color:red"><b>AJAX</b></span>. Estos archivos existen dedicados para cada secci&#xF3;n y realizan acciones sencillas en tiempo real funcionando como peque&#xF1;os controladores para las secciones.<br>
El resto de acciones (normamente gr&#xE1;ficas y est&#xE9;ticas) son realizadas desde el lado cliente con JavaScript siempre que no requieran de archivos del servidor ni de las bases de datos.</p>
<h3>Dependencias:</h3>
<p><strong>SERVIDOR</strong></p>
<ul>
<li>Apache2 en entorno Linux o XAMPP en Windows.</li>
<li>Extensiones para <span style="color:purple"><b>PHP</b></span> 7+
<ul>
<li>sqlsrv</li>
<li>pgsql</li>
</ul>
</li>
<li>CodeIgniter 4</li>
<li>KoolReport</li>
</ul>
<p><strong>CLIENTE</strong></p>
<ul>
<li>fontAwesome</li>
<li>jquery</li>
<li>echarts</li>
<li>leaflet</li>
<li>html2pdf</li>
<li>html2canvas</li>
</ul>
<hr>
<h1><strong>1. CONTROLADOR</strong></h1>
<h3><strong>CLASE Inicio.php</strong></h3>
<p>El controlador se llama Inicio.php y se ejecuta despues de BaseController.php y el resto de componentes de codeIgniter.</p>
<p>El controlador es el componente que gestiona las peticiones que llegan desde lado cliente. Pero tambi&#xE9;n se encarga de instanciar la aplicaci&#xF3;n por primera vez cuando esta empieza a funcionar.</p>
<p>Para funcionar primero implementa las clases sobre las que se apoya para procesar la actividad en el servidor. Estas clases se explican mas en detalle en sus secciones mas adelante. Las clases son Usuario.php. Contras.php y Validador.php que se encuentran bajo la carpeta Models.<br>
Tambi&#xE9;n en el contrusctor de clase, instancian losetos usuario, sesion y vlr (validador).</p>
<h3>FUNCI&#xD3;N <strong>index()</strong></h3>
<blockquote>
<p><span style="color:green">@returns</span> View</p>
</blockquote>
<p>Esta funci&#xF3;n lo que hace es arrancar la aplicaci&#xF3;n. Tambi&#xE9;n muestra la secci&#xF3;n principal en caso de que la sesi&#xF3;n exista y muestra el Log-out si la sesi&#xF3;n ha expirado.</p>
<pre data-role="codeBlock" data-info="php" class="language-php">    <span class="token keyword keyword-public">public</span> <span class="token keyword keyword-function">function</span> <span class="token function-definition function">index</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token global">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;seccion&apos;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string single-quoted-string">&apos;inicio&apos;</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token keyword keyword-isset">isset</span><span class="token punctuation">(</span><span class="token global">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;log&apos;</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token global">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;log&apos;</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string single-quoted-string">&apos;out&apos;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">session_unset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token global">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;mensajeDesc&apos;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token constant boolean">true</span><span class="token punctuation">;</span>
            <span class="token global">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;seccion&apos;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string single-quoted-string">&apos;&apos;</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-return">return</span> <span class="token function">view</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&apos;inicio&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword keyword-else">else</span> <span class="token punctuation">{</span>
            <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token keyword keyword-isset">isset</span><span class="token punctuation">(</span><span class="token global">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;nombre&apos;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token property">usuario</span> <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token class-name">Usuario</span><span class="token punctuation">(</span><span class="token global">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;nombre&apos;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token global">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;pwd&apos;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token global">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;nombre_cliente&apos;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token property">usuario</span><span class="token operator">-&gt;</span><span class="token function">getCliente</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token variable">$datos</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;estaciones&apos;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token property">usuario</span><span class="token operator">-&gt;</span><span class="token function">obtenerEstacionesUsuario</span><span class="token punctuation">(</span><span class="token global">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;hpwd&apos;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token global">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;estaciones&apos;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$datos</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;estaciones&apos;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
                <span class="token variable">$datos</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;estacionesUbis&apos;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token property">usuario</span><span class="token operator">-&gt;</span><span class="token function">ultimasConexiones</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token global">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;seccion&apos;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;prin&quot;</span><span class="token punctuation">;</span>
                <span class="token keyword keyword-return">return</span> <span class="token function">view</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&apos;principal&apos;</span><span class="token punctuation">,</span> <span class="token variable">$datos</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword keyword-else">else</span> <span class="token punctuation">{</span>
                <span class="token function">session_unset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token global">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;seccion&apos;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;&quot;</span><span class="token punctuation">;</span>
                <span class="token global">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;mensajeDesc&apos;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token constant boolean">true</span><span class="token punctuation">;</span>
                <span class="token keyword keyword-return">return</span> <span class="token function">view</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&apos;inicio&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</pre><h3>FUNCI&#xD3;N <strong>inicioSesion()</strong></h3>
<blockquote>
<p><span style="color:green">@returns</span> View</p>
</blockquote>
<p>Esta funci&#xF3;n devuelve la vista de incio de sesi&#xF3;n y en caso de que est&#xE1; ya estuviera definida, la destruye.Tambi&#xE9;n se encarga de comprobar si las credenciales son correctas y de validarlas.</p>
<pre data-role="codeBlock" data-info="php" class="language-php">        <span class="token keyword keyword-public">public</span> <span class="token keyword keyword-function">function</span> <span class="token function-definition function">inicioSesion</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                <span class="token global">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;seccion&apos;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;login&quot;</span><span class="token punctuation">;</span>
                <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token keyword keyword-isset">isset</span><span class="token punctuation">(</span><span class="token global">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;nombre&apos;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token function">session_unset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token global">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;mensajeDesc&apos;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span>
                <span class="token variable">$nombre</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;&quot;</span><span class="token punctuation">;</span>
                <span class="token variable">$pwd</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;&quot;</span><span class="token punctuation">;</span>
                <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token keyword keyword-isset">isset</span><span class="token punctuation">(</span><span class="token global">$_POST</span><span class="token punctuation">[</span><span class="token string double-quoted-string">&quot;txtNombre&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword keyword-isset">isset</span><span class="token punctuation">(</span><span class="token global">$_POST</span><span class="token punctuation">[</span><span class="token string double-quoted-string">&quot;txtContrasena&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token variable">$nombre</span> <span class="token operator">=</span> <span class="token global">$_POST</span><span class="token punctuation">[</span><span class="token string double-quoted-string">&quot;txtNombre&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
                    <span class="token variable">$pwd</span> <span class="token operator">=</span> <span class="token global">$_POST</span><span class="token punctuation">[</span><span class="token string double-quoted-string">&quot;txtContrasena&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
                    <span class="token keyword keyword-if">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token property">vlr</span><span class="token operator">-&gt;</span><span class="token function">valLog</span><span class="token punctuation">(</span><span class="token variable">$nombre</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token operator">!</span><span class="token punctuation">(</span><span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token property">vlr</span><span class="token operator">-&gt;</span><span class="token function">valLog</span><span class="token punctuation">(</span><span class="token variable">$pwd</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">{</span>
                        <span class="token keyword keyword-echo">echo</span> <span class="token string single-quoted-string">&apos;&lt;script language=&quot;javascript&quot;&gt;alert(&quot;car&#xE1;cteres no v&#xE1;lidos&quot;)&lt;/script&gt;&apos;</span><span class="token punctuation">;</span>
                                <span class="token keyword keyword-return">return</span> <span class="token function">view</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&apos;inicioSesion&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                    <span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token property">usuario</span> <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token class-name">Usuario</span><span class="token punctuation">(</span><span class="token variable">$nombre</span><span class="token punctuation">,</span> <span class="token variable">$pwd</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token property">usuario</span><span class="token operator">-&gt;</span><span class="token function">existeUsuario</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token constant boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token variable">$id_usu</span> <span class="token operator">=</span> <span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token property">usuario</span><span class="token operator">-&gt;</span><span class="token function">obtenerIdUsuario</span><span class="token punctuation">(</span><span class="token variable">$nombre</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token variable">$id_usu</span> <span class="token operator">!=</span> <span class="token constant">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                            <span class="token variable">$conSys</span> <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token class-name">Contras</span><span class="token punctuation">(</span><span class="token variable">$id_usu</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token variable">$conSys</span><span class="token operator">-&gt;</span><span class="token function">loginUsuario</span><span class="token punctuation">(</span><span class="token variable">$pwd</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                                <span class="token global">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;hpwd&apos;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$conSys</span><span class="token operator">-&gt;</span><span class="token function">getHash</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                                <span class="token global">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;estaciones&apos;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token property">usuario</span><span class="token operator">-&gt;</span><span class="token function">obtenerEstacionesUsuario</span><span class="token punctuation">(</span><span class="token global">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;hpwd&apos;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                                <span class="token global">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;nombre&apos;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$nombre</span><span class="token punctuation">;</span>
                                <span class="token global">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;pwd&apos;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$pwd</span><span class="token punctuation">;</span>
                                <span class="token keyword keyword-return">return</span> <span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token function">index</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            <span class="token punctuation">}</span> <span class="token keyword keyword-else">else</span> <span class="token punctuation">{</span>
                                <span class="token keyword keyword-echo">echo</span> <span class="token string single-quoted-string">&apos;&lt;script language=&quot;javascript&quot;&gt;alert(&quot;Contrase&#xF1;a incorrecta&quot;)&lt;/script&gt;&apos;</span><span class="token punctuation">;</span>
                                <span class="token keyword keyword-return">return</span> <span class="token function">view</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&apos;inicioSesion&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            <span class="token punctuation">}</span>
                        <span class="token punctuation">}</span> <span class="token keyword keyword-else">else</span> <span class="token punctuation">{</span>
                            <span class="token keyword keyword-echo">echo</span> <span class="token string single-quoted-string">&apos;&lt;script language=&quot;javascript&quot;&gt;alert(&quot;Datos incorrectos&quot;)&lt;/script&gt;&apos;</span><span class="token punctuation">;</span>
                            <span class="token keyword keyword-return">return</span> <span class="token function">view</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&apos;inicioSesion&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span> <span class="token keyword keyword-else">else</span> <span class="token punctuation">{</span>
                        <span class="token keyword keyword-echo">echo</span> <span class="token string single-quoted-string">&apos;&lt;script language=&quot;javascript&quot;&gt;alert(&quot;Usuario desconocido&quot;)&lt;/script&gt;&apos;</span><span class="token punctuation">;</span>
                        <span class="token keyword keyword-return">return</span> <span class="token function">view</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&apos;inicioSesion&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span> <span class="token keyword keyword-else">else</span> <span class="token punctuation">{</span>
                    <span class="token keyword keyword-return">return</span> <span class="token function">view</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&apos;inicioSesion&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
</pre><h3>FUNCI&#xD3;N <strong>estacion()</strong></h3>
<blockquote>
<p><span style="color:green">@returns</span> View</p>
</blockquote>
<p>Esta fucni&#xF3;n devuelve la vista de estaci&#xF3;n. Dependiendo de la informaci&#xF3;n adquirida por POST, comprobar&#xE1; si esa estaci&#xF3;n existe, si pertenece al usuario y en caso afirmativo, devuelve la vista estaci&#xF3;n con sus datos.</p>
<pre data-role="codeBlock" data-info="php" class="language-php">    <span class="token keyword keyword-public">public</span> <span class="token keyword keyword-function">function</span> <span class="token function-definition function">estacion</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token keyword keyword-isset">isset</span><span class="token punctuation">(</span><span class="token global">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;nombre&apos;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token global">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;seccion&apos;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;estacion&quot;</span><span class="token punctuation">;</span>
            <span class="token variable">$usuario</span> <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token class-name">Usuario</span><span class="token punctuation">(</span><span class="token global">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;nombre&apos;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token global">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;pwd&apos;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-foreach">foreach</span> <span class="token punctuation">(</span><span class="token global">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;estaciones&apos;</span><span class="token punctuation">]</span> <span class="token keyword keyword-as">as</span> <span class="token variable">$index</span> <span class="token operator">=&gt;</span> <span class="token variable">$estacion</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token variable">$estacion</span><span class="token punctuation">[</span><span class="token string double-quoted-string">&quot;id_estacion&quot;</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token global">$_POST</span><span class="token punctuation">[</span><span class="token string double-quoted-string">&quot;btnEstacion&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token variable">$nombreEstacion</span> <span class="token operator">=</span> <span class="token variable">$estacion</span><span class="token punctuation">[</span><span class="token string double-quoted-string">&quot;nombre_estacion&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
                    <span class="token variable">$datos</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;id_estacion&apos;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$estacion</span><span class="token punctuation">[</span><span class="token string double-quoted-string">&quot;id_estacion&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            <span class="token variable">$ultimaConex</span> <span class="token operator">=</span> <span class="token variable">$usuario</span><span class="token operator">-&gt;</span><span class="token function">ultimaConexionEstacion</span><span class="token punctuation">(</span><span class="token global">$_POST</span><span class="token punctuation">[</span><span class="token string double-quoted-string">&quot;btnEstacion&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token variable">$ultimaConex</span> <span class="token operator">!=</span> <span class="token constant boolean">false</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token variable">$datos</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;ultimaConex&apos;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$ultimaConex</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword keyword-else">else</span> <span class="token punctuation">{</span>
                <span class="token variable">$datos</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;ultimaConex&apos;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;error&quot;</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token variable">$datos</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;nombreEstacion&apos;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$nombreEstacion</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-return">return</span> <span class="token function">view</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&apos;estacion&apos;</span><span class="token punctuation">,</span> <span class="token variable">$datos</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword keyword-else">else</span> <span class="token punctuation">{</span>
            <span class="token keyword keyword-return">return</span> <span class="token function">view</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&apos;inicio&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

</pre><h3>FUNCI&#xD3;N <strong>graficas()</strong></h3>
<blockquote>
<p><span style="color:green">@returns</span> View</p>
</blockquote>
<p>Esta funci&#xF3;n devuelve la secci&#xF3;n de vista r&#xE1;pida o personalizada dependiendo de la informaci&#xF3;n que le llegue por POST.</p>
<pre data-role="codeBlock" data-info="php" class="language-php"><span class="token keyword keyword-public">public</span> <span class="token keyword keyword-function">function</span> <span class="token function-definition function">graficas</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token keyword keyword-isset">isset</span><span class="token punctuation">(</span><span class="token global">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;nombre&apos;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token global">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;seccion&apos;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;graficos&quot;</span><span class="token punctuation">;</span>
            <span class="token variable">$usuario</span> <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token class-name">Usuario</span><span class="token punctuation">(</span><span class="token global">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;nombre&apos;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token global">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;pwd&apos;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token variable">$datos</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;tagsEstaciones&apos;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$usuario</span><span class="token operator">-&gt;</span><span class="token function">obtenerTagsEstaciones</span><span class="token punctuation">(</span><span class="token variable">$usuario</span><span class="token operator">-&gt;</span><span class="token function">obtenerEstacionesUsuario</span><span class="token punctuation">(</span><span class="token global">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;hpwd&apos;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token keyword keyword-isset">isset</span><span class="token punctuation">(</span><span class="token global">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;btnGraf&apos;</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token global">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;btnGraf&apos;</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string single-quoted-string">&apos;rapida&apos;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword keyword-return">return</span> <span class="token function">view</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&apos;graficas&apos;</span><span class="token punctuation">,</span> <span class="token variable">$datos</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword keyword-else">else</span> <span class="token punctuation">{</span>
                <span class="token keyword keyword-return">return</span> <span class="token function">view</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&apos;graficasCustom&apos;</span><span class="token punctuation">,</span> <span class="token variable">$datos</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword keyword-else">else</span> <span class="token punctuation">{</span>
            <span class="token keyword keyword-return">return</span> <span class="token function">view</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&apos;inicio&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

</pre><h3>FUNCI&#xD3;N <strong>alarmas()</strong></h3>
<blockquote>
<p><span style="color:green">@returns</span> View</p>
</blockquote>
<p>Esta funci&#xF3;n devuelve la vista de alarmas con las alarmas pertenecientes a un usuario desde hace un mes*.</p>
<pre data-role="codeBlock" data-info="php" class="language-php"><span class="token keyword keyword-public">public</span> <span class="token keyword keyword-function">function</span> <span class="token function-definition function">alarmas</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token keyword keyword-isset">isset</span><span class="token punctuation">(</span><span class="token global">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;nombre&apos;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token global">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;seccion&apos;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;alarmas&quot;</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token keyword keyword-isset">isset</span><span class="token punctuation">(</span><span class="token global">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;alarmas&apos;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token variable">$datos</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;alarmas&apos;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token global">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;alarmas&apos;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword keyword-else">else</span> <span class="token punctuation">{</span>
                <span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token property">usuario</span> <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token class-name">Usuario</span><span class="token punctuation">(</span><span class="token global">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;nombre&apos;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token global">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;pwd&apos;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token variable">$estaciones</span> <span class="token operator">=</span> <span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token property">usuario</span><span class="token operator">-&gt;</span><span class="token function">obtenerEstacionesUsuario</span><span class="token punctuation">(</span><span class="token global">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;hpwd&apos;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token variable">$datos</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;estaciones&apos;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$estaciones</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword keyword-return">return</span> <span class="token function">view</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&apos;alarmas&apos;</span><span class="token punctuation">,</span> <span class="token variable">$datos</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword keyword-else">else</span> <span class="token punctuation">{</span>
            <span class="token keyword keyword-return">return</span> <span class="token function">view</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&apos;inicio&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

</pre><h3>FUNCI&#xD3;N <strong>informes()</strong></h3>
<blockquote>
<p><span style="color:green">@returns</span> View</p>
</blockquote>
<p>Esta fucni&#xF3;n devuelve la vista de informes</p>
<pre data-role="codeBlock" data-info="php" class="language-php"><span class="token keyword keyword-public">public</span> <span class="token keyword keyword-function">function</span> <span class="token function-definition function">informes</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token keyword keyword-isset">isset</span><span class="token punctuation">(</span><span class="token global">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;nombre&apos;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token global">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;seccion&apos;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;infos&quot;</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-return">return</span> <span class="token function">view</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&apos;informes&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword keyword-else">else</span> <span class="token punctuation">{</span>
            <span class="token keyword keyword-return">return</span> <span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token function">inicioSesion</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

</pre><h3>FUNCI&#xD3;N <strong>comunicaciones()</strong></h3>
<blockquote>
<p><span style="color:green">@returns</span> View</p>
</blockquote>
<p>Esta funcion devuelve la vista de comunicaciones</p>
<pre data-role="codeBlock" data-info="php" class="language-php"><span class="token keyword keyword-public">public</span> <span class="token keyword keyword-function">function</span> <span class="token function-definition function">comunicaciones</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token global">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;seccion&apos;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;coms&quot;</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token keyword keyword-isset">isset</span><span class="token punctuation">(</span><span class="token global">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;nombre&apos;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword keyword-return">return</span> <span class="token function">view</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&apos;comunicaciones&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword keyword-else">else</span> <span class="token punctuation">{</span>
            <span class="token keyword keyword-return">return</span> <span class="token function">view</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&apos;inicio&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

</pre><p>Y con esto hemos cubierto la totalidad del controlador. El funcionamiento de las clases de apoyo se explican mas adelante y el funcionamiento asi como enrutamiento est&#xE1;n en la documentaci&#xF3;n de codeIgniter.</p>
<hr>
<h1><strong>2. BASES DE DATOS</strong></h1>
<p><strong>IMPORTANTE</strong>: Estas clases son provisionales antes de implementar otras tecnolog&#xED;as mas potentes como Apache Spark o Fiware.<br>
El sistema de bases de datos se compone por dos clases: Database y DataWit.<br>
Database es la mas grande de las dos y se usa para pr&#xE1;cticamente todo. En ella se encuentran las interaciones con PostgreSQL.<br>
DataWit es una clase que conecta con dos bases de datos en SQL Server para ver y editar consignas asi como plannings de tiempo para algunas estaciones que por limitaciones en las comunicaciones no se pod&#xED;a hacer desde PostgreSQL</p>
<h2><strong>2.1 CLASE Database.php</strong></h2>
<blockquote>
<p>importante: esta clase se apoya en los drivers de PostgreSQL para <span style="color:purple"><b>PHP</b></span> (pgsql) no incluidos en apache</p>
</blockquote>
<p>Por lo general en Database vamos a hacer consultas a PostgreSQL en funci&#xF3;n de unos par&#xE1;metros incluidos en las llamadas a esta clase. Estas llamadas tienen varios origenes incluyendo el Controlador y los archivos de <span style="color:red"><b>AJAX</b></span></p>
<p>Nada mas instanciar la clase, se inician unas constantes con las credenciales y configuraci&#xF3;n de conexi&#xF3;n a la base de datos.<br>
En el constructor tambien se instancia una funcion que en versiones mas recientes de <span style="color:purple"><b>PHP</b></span> ya est&#xE1; incluida pero que por limitaciones de Debian, al tener que usar PHP5 necesitamos.</p>
<h3>FUNCI&#xD3;N <strong>conectar()</strong></h3>
<blockquote>
<p><span style="color:green">@returns</span> Mixed: conexion | bool</p>
</blockquote>
<p>Esta funci&#xF3;n establece la conexi&#xF3;n entre la aplicaci&#xF3;n y la base de datos.<br>
En ese caso devulve un objeto <em>SQLSTMT</em> de conexion.<br>
En caso de error, devuelve <em>false</em>.<br>
Su uso es puramente interno y es llamada en casi todas las funciones para comprobar que esta funciona.</p>
<pre data-role="codeBlock" data-info="php" class="language-php"><span class="token keyword keyword-private">private</span> <span class="token keyword keyword-function">function</span> <span class="token function-definition function">conectar</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token property">conexion</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword keyword-return">return</span> <span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token property">conexion</span> <span class="token operator">=</span> <span class="token function">pg_connect</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;host=<span class="token interpolation"><span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token property">host</span></span> dbname=<span class="token interpolation"><span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token property">dbname</span></span> user=<span class="token interpolation"><span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token property">user</span></span> password=<span class="token interpolation"><span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token property">password</span></span>&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword keyword-return">return</span> <span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token property">conexion</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</pre><h3>FUNCI&#xD3;N <strong>consultaExitosa()</strong></h3>
<blockquote>
<p><span style="color:green">@params</span> SQLSTMT resultado</p>
</blockquote>
<blockquote>
<p><span style="color:green">@returns</span> bool</p>
</blockquote>
<p>Esta es otra funcion interna a la cual se llama cada vez que se produce una consulta a la base de datos y se encarga de comprobar si el objeto <em>SQLSTMT</em> devulto por PostgreSQL es v&#xE1;lido y contiene informaci&#xF3;n.</p>
<pre data-role="codeBlock" data-info="php" class="language-php"><span class="token keyword keyword-private">private</span> <span class="token keyword keyword-function">function</span> <span class="token function-definition function">consultaExitosa</span><span class="token punctuation">(</span><span class="token variable">$resultado</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token variable">$nResuls</span> <span class="token operator">=</span> <span class="token function">pg_num_rows</span><span class="token punctuation">(</span><span class="token variable">$resultado</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token variable">$nResuls</span> <span class="token operator">!=</span> <span class="token number">0</span> <span class="token operator">||</span> <span class="token variable">$nResuls</span> <span class="token operator">!=</span> <span class="token constant">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword keyword-return">return</span> <span class="token constant boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword keyword-else">else</span> <span class="token punctuation">{</span>
            <span class="token keyword keyword-return">return</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</pre><h3>FUNCI&#xD3;N <strong>obtenerNombreTag()</strong></h3>
<blockquote>
<p><span style="color:green">@params</span> <b>INT</b> id_tag</p>
</blockquote>
<blockquote>
<p><span style="color:green">@returns</span> Mixed <b>String</b> | <b>Bool</b></p>
</blockquote>
<p>Funcion interna que devulve el nombre de un tag dado su id</p>
<pre data-role="codeBlock" data-info="php" class="language-php"><span class="token keyword keyword-private">private</span> <span class="token keyword keyword-function">function</span> <span class="token function-definition function">obtenerNombreTag</span><span class="token punctuation">(</span><span class="token variable">$id_tag</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token function">conectar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token variable">$con</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;SELECT nombre_tag FROM tags WHERE id_tag = &quot;</span> <span class="token operator">.</span> <span class="token variable">$id_tag</span><span class="token punctuation">;</span>
            <span class="token variable">$res</span> <span class="token operator">=</span> <span class="token function">pg_query</span><span class="token punctuation">(</span><span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token property">conexion</span><span class="token punctuation">,</span> <span class="token variable">$con</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token function">consultaExitosa</span><span class="token punctuation">(</span><span class="token variable">$res</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword keyword-return">return</span> <span class="token function">pg_fetch_all</span><span class="token punctuation">(</span><span class="token variable">$res</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;nombre_tag&apos;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

</pre><h3>FUNCI&#xD3;N <strong>obtenerConsignasTag()</strong></h3>
<blockquote>
<p><span style="color:green">@params</span> <b>INT</b> id_tag</p>
</blockquote>
<blockquote>
<p><span style="color:green">@returns</span> Mixed <b>Array</b> | <b>Bool</b></p>
</blockquote>
<p>Funcion interna que devulve las consignas de un tag dado su id</p>
<pre data-role="codeBlock" data-info="php" class="language-php"><span class="token keyword keyword-private">private</span> <span class="token keyword keyword-function">function</span> <span class="token function-definition function">obtenerConsignasTag</span><span class="token punctuation">(</span><span class="token variable">$id_tag</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token variable">$nombre_tag</span> <span class="token operator">=</span> <span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token function">obtenerNombreTag</span><span class="token punctuation">(</span><span class="token variable">$id_tag</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token function">conectar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token variable">$con</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;SELECT estaciones.nombre_estacion,tags.nombre_tag,tags.unidad, datos_valores.valor_float
            from datos_valores inner join tags on tags.id_tag = datos_valores.id_tag
            inner join estacion_tag on estacion_tag.id_tag = tags.id_tag
            inner join estaciones on estaciones.id_estacion = estacion_tag.id_estacion
            WHERE tags.nombre_tag LIKE(&apos;Consigna &quot;</span> <span class="token operator">.</span> <span class="token variable">$nombre_tag</span> <span class="token operator">.</span> <span class="token string double-quoted-string">&quot;%&apos;) and estaciones.id_estacion = (select id_estacion from estacion_tag where id_tag = &quot;</span> <span class="token operator">.</span> <span class="token variable">$id_tag</span> <span class="token operator">.</span> <span class="token string double-quoted-string">&quot;)
            order by estaciones.nombre_estacion&quot;</span><span class="token punctuation">;</span>
            <span class="token variable">$res</span> <span class="token operator">=</span> <span class="token function">pg_query</span><span class="token punctuation">(</span><span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token property">conexion</span><span class="token punctuation">,</span> <span class="token variable">$con</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token function">consultaExitosa</span><span class="token punctuation">(</span><span class="token variable">$res</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword keyword-return">return</span> <span class="token function">pg_fetch_all</span><span class="token punctuation">(</span><span class="token variable">$res</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword keyword-return">return</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</pre><h3>FUNCI&#xD3;N <strong>obtenerIdUsuario()</strong></h3>
<blockquote>
<p><span style="color:green">@params</span> <b>String</b> nombre_usuario</p>
</blockquote>
<blockquote>
<p><span style="color:green">@returns</span> Mixed <b>INT</b> | <b>Bool</b></p>
</blockquote>
<p>Esta es una funci&#xF3;n p&#xFA;blica que devuelve el id_usuario dado un nombre. Tiene un uso muy limitado y es de apoyo a otras funciones.</p>
<pre data-role="codeBlock" data-info="php" class="language-php"><span class="token punctuation">{</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token function">conectar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token variable">$consulta</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;SELECT id_usuario FROM usuarios WHERE nombre =&apos;<span class="token interpolation"><span class="token variable">$nombre</span></span>&apos;&quot;</span><span class="token punctuation">;</span>
            <span class="token variable">$resultado</span> <span class="token operator">=</span> <span class="token function">pg_query</span><span class="token punctuation">(</span><span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token property">conexion</span><span class="token punctuation">,</span> <span class="token variable">$consulta</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token function">consultaExitosa</span><span class="token punctuation">(</span><span class="token variable">$resultado</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token variable">$id_usu</span> <span class="token operator">=</span> <span class="token function">pg_fetch_all</span><span class="token punctuation">(</span><span class="token variable">$resultado</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword keyword-return">return</span> <span class="token variable">$id_usu</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword keyword-else">else</span> <span class="token punctuation">{</span>
                <span class="token keyword keyword-echo">echo</span> <span class="token string single-quoted-string">&apos;&lt;script language=&quot;javascript&quot;&gt;alert(&quot;Error de conexi&#xF3;n&quot;)&lt;/script&gt;&apos;</span><span class="token punctuation">;</span>
                <span class="token keyword keyword-return">return</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</pre><h3>FUNCI&#xD3;N obtenerClienteUsuario()</h3>
<blockquote>
<p><span style="color:green">@params</span> <b>String</b> nombre_usuario</p>
</blockquote>
<blockquote>
<p><span style="color:green">@returns</span> Mixed <b>String</b> | <b>Bool</b></p>
</blockquote>
<p>Funci&#xF3;n p&#xFA;blica que devuelve el cliente o grupo al que pertenece un usuario dado su nombre. Su uso es limitado y es de apoyo a otras funciones.</p>
<pre data-role="codeBlock" data-info="php" class="language-php"><span class="token keyword keyword-public">public</span> <span class="token keyword keyword-function">function</span> <span class="token function-definition function">obtenerClienteUsuario</span><span class="token punctuation">(</span><span class="token variable">$nombre_usuario</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token variable">$id_usuario</span> <span class="token operator">=</span> <span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token function">obtenerIdUsuario</span><span class="token punctuation">(</span><span class="token variable">$nombre_usuario</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;id_usuario&apos;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token variable">$id_usuario</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token variable">$con</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;SELECT cliente.nombre FROM cliente inner join usuarios on usuarios.id_cliente = cliente.id_cliente
           WHERE usuarios.id_usuario = &quot;</span> <span class="token operator">.</span> <span class="token variable">$id_usuario</span><span class="token punctuation">;</span>
            <span class="token variable">$res</span> <span class="token operator">=</span> <span class="token function">pg_query</span><span class="token punctuation">(</span><span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token property">conexion</span><span class="token punctuation">,</span> <span class="token variable">$con</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token function">consultaExitosa</span><span class="token punctuation">(</span><span class="token variable">$res</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword keyword-return">return</span> <span class="token function">pg_fetch_all</span><span class="token punctuation">(</span><span class="token variable">$res</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;nombre&apos;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword keyword-return">return</span> <span class="token string double-quoted-string">&quot;&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</pre><h3>FUNCI&#xD3;N <strong>existeUsusario()</strong></h3>
<blockquote>
<p><span style="color:green">@params</span> <b>String</b> nombre</p>
</blockquote>
<blockquote>
<p><span style="color:green">@returns</span> <b>Bool</b></p>
</blockquote>
<p>Funci&#xF3;n p&#xFA;blica que comprueba la existencia de un usuario dado su nombre. Su uso es limitado y sirve de apoyo a otras funciones.</p>
<pre data-role="codeBlock" data-info="php" class="language-php"><span class="token keyword keyword-public">public</span> <span class="token keyword keyword-function">function</span> <span class="token function-definition function">existeUsuario</span><span class="token punctuation">(</span><span class="token variable">$nombre</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token function">conectar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token variable">$consulta</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;SELECT * FROM public.usuarios WHERE nombre =&apos;<span class="token interpolation"><span class="token variable">$nombre</span></span>&apos;&quot;</span><span class="token punctuation">;</span>
            <span class="token variable">$resultado</span> <span class="token operator">=</span> <span class="token function">pg_query</span><span class="token punctuation">(</span><span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token property">conexion</span><span class="token punctuation">,</span> <span class="token variable">$consulta</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token function">consultaExitosa</span><span class="token punctuation">(</span><span class="token variable">$resultado</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword keyword-return">return</span> <span class="token constant boolean">true</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword keyword-else">else</span> <span class="token punctuation">{</span>
                <span class="token keyword keyword-return">return</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword keyword-else">else</span> <span class="token punctuation">{</span>
            <span class="token keyword keyword-echo">echo</span> <span class="token string single-quoted-string">&apos;&lt;script language=&quot;javascript&quot;&gt;alert(&quot;Error de conexi&#xF3;n&quot;)&lt;/script&gt;&apos;</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-return">return</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</pre><h3>FUNCI&#xD3;N <strong>userData()</strong></h3>
<blockquote>
<p><span style="color:green">@params</span> <b>INT</b> id_usu</p>
</blockquote>
<blockquote>
<p><span style="color:green">@returns</span> Mixed <b>Array</b> | <b>Bool</b></p>
</blockquote>
<p>Funci&#xF3;n p&#xFA;blica parte del sistema de Log-in que recoge informaci&#xF3;n necesaria para la clase Contras.php dado el id de un usuario.<br>
S&#xF3;lo se usa en el contructor de Contras.php</p>
<pre data-role="codeBlock" data-info="php" class="language-php"> <span class="token keyword keyword-public">public</span> <span class="token keyword keyword-function">function</span> <span class="token function-definition function">userData</span><span class="token punctuation">(</span><span class="token variable">$id_usu</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token variable">$uData</span> <span class="token operator">=</span> <span class="token constant">null</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token function">conectar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token variable">$con</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;SELECT * FROM usuarios WHERE id_usuario =&quot;</span> <span class="token operator">.</span> <span class="token variable">$id_usu</span> <span class="token operator">.</span> <span class="token string double-quoted-string">&quot;LIMIT 1&quot;</span><span class="token punctuation">;</span>
            <span class="token variable">$res</span> <span class="token operator">=</span> <span class="token function">pg_query</span><span class="token punctuation">(</span><span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token property">conexion</span><span class="token punctuation">,</span> <span class="token variable">$con</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token function">consultaExitosa</span><span class="token punctuation">(</span><span class="token variable">$res</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token variable">$uData</span> <span class="token operator">=</span> <span class="token function">pg_fetch_all</span><span class="token punctuation">(</span><span class="token variable">$res</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword keyword-return">return</span> <span class="token variable">$uData</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword keyword-return">return</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

</pre><h3>FUNCI&#xD3;N <strong>updateUserData()</strong></h3>
<blockquote>
<p><span style="color:green">@params</span> <b>INT</b> id_usu, <b>String</b> pwd</p>
</blockquote>
<blockquote>
<p><span style="color:green">@returns</span> <b>Bool</b></p>
</blockquote>
<p>Funci&#xF3;n p&#xFA;blica de la que se apoya Contras.php cuando debe actualizar el cifrado de un HASH de un usuario especifico.</p>
<pre data-role="codeBlock" data-info="php" class="language-php"><span class="token keyword keyword-public">public</span> <span class="token keyword keyword-function">function</span> <span class="token function-definition function">updateUserData</span><span class="token punctuation">(</span><span class="token variable">$id_usu</span><span class="token punctuation">,</span> <span class="token variable">$pwd</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token function">conectar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token variable">$con</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;UPDATE usuarios SET usuarios.hash = &quot;</span> <span class="token operator">.</span> <span class="token variable">$pwd</span> <span class="token operator">.</span> <span class="token string double-quoted-string">&quot; WHERE usuarios.id_usuario = <span class="token interpolation"><span class="token variable">$id_usu</span></span>&quot;</span><span class="token punctuation">;</span>
            <span class="token variable">$res</span> <span class="token operator">=</span> <span class="token function">pg_query</span><span class="token punctuation">(</span><span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token property">conexion</span><span class="token punctuation">,</span> <span class="token variable">$con</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token function">consultaExitosa</span><span class="token punctuation">(</span><span class="token variable">$res</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword keyword-return">return</span> <span class="token constant boolean">true</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword keyword-return">return</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</pre><h3>FUNCI&#xD3;N <strong>mostrarEstacionesCliente()</strong></h3>
<blockquote>
<p><span style="color:green">@params</span> <b>String</b> nombre, <b>String</b> pwd</p>
</blockquote>
<blockquote>
<p><span style="color:green">@returns</span> Mixed <b>Array</b> | <b>Bool</b></p>
</blockquote>
<p>Esta funci&#xF3;n p&#xFA;blica recoge toda la informaci&#xF3;n de las propiedades de todas las estaciones que pertenezcan a un usuario dado su nombre y contrase&#xF1;a cifrada</p>
<pre data-role="codeBlock" data-info="php" class="language-php"><span class="token keyword keyword-public">public</span> <span class="token keyword keyword-function">function</span> <span class="token function-definition function">mostrarEstacionesCliente</span><span class="token punctuation">(</span><span class="token variable">$nombre</span><span class="token punctuation">,</span> <span class="token variable">$pwd</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token function">conectar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token variable">$consulta</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;SELECT estaciones.nombre_estacion, estaciones.id_estacion, estaciones.latitud, estaciones.longitud
            FROM usuarios INNER JOIN usuario_estacion ON usuarios.id_usuario = usuario_estacion.id_usuario
            INNER JOIN estaciones ON usuario_estacion.id_estacion = estaciones.id_estacion
            WHERE usuarios.nombre =&apos;<span class="token interpolation"><span class="token variable">$nombre</span></span>&apos; AND usuarios.hash =&apos;<span class="token interpolation"><span class="token variable">$pwd</span></span>&apos;&quot;</span><span class="token punctuation">;</span>
            <span class="token variable">$resultado</span> <span class="token operator">=</span> <span class="token function">pg_query</span><span class="token punctuation">(</span><span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token property">conexion</span><span class="token punctuation">,</span> <span class="token variable">$consulta</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token function">consultaExitosa</span><span class="token punctuation">(</span><span class="token variable">$resultado</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token variable">$estacionesArr</span> <span class="token operator">=</span> <span class="token function">pg_fetch_all</span><span class="token punctuation">(</span><span class="token variable">$resultado</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword keyword-return">return</span> <span class="token variable">$estacionesArr</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword keyword-else">else</span> <span class="token punctuation">{</span>
                <span class="token keyword keyword-return">return</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</pre><h3>FUNCI&#xD3;N <strong>obtenerFotoEstacion()</strong></h3>
<blockquote>
<p><span style="color:green">@params</span> <b>INT</b> id_usuario</p>
</blockquote>
<blockquote>
<p><span style="color:green">@returns</span> Mixed <b>String</b> foto | <b>Bool</b></p>
</blockquote>
<p>Esta funci&#xF3;n p&#xFA;blica devulve los datos de imagen cifrados de una estaci&#xF3;n dada su id. Se usa en la secci&#xF3;n principal para los mapas y en las secciones de estaci&#xF3;n. Si esta estacion no tiene foto, devuelve false</p>
<pre data-role="codeBlock" data-info="php" class="language-php"><span class="token keyword keyword-public">public</span> <span class="token keyword keyword-function">function</span> <span class="token function-definition function">obtenerFotoEstacion</span><span class="token punctuation">(</span><span class="token variable">$id_estacion</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token global">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;obtenerFotoEstacion_id_estacion&apos;</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token variable">$id_estacion</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword keyword-return">return</span> <span class="token variable">$foto</span> <span class="token operator">=</span> <span class="token global">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;obtenerFotoEstacion_result&apos;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token function">conectar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token variable">$consulta</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;SELECT foto as foto
            FROM estaciones
            WHERE id_estacion = &quot;</span> <span class="token operator">.</span> <span class="token variable">$id_estacion</span><span class="token punctuation">;</span>
            <span class="token variable">$resultado</span> <span class="token operator">=</span> <span class="token function">pg_query</span><span class="token punctuation">(</span><span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token property">conexion</span><span class="token punctuation">,</span> <span class="token variable">$consulta</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token function">consultaExitosa</span><span class="token punctuation">(</span><span class="token variable">$resultado</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token variable">$foto</span> <span class="token operator">=</span> <span class="token function">pg_fetch_all</span><span class="token punctuation">(</span><span class="token variable">$resultado</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;foto&apos;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
                <span class="token global">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;obtenerFotoEstacion_id_estacion&apos;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$id_estacion</span><span class="token punctuation">;</span>
                <span class="token global">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;obtenerFotoEstacion_result&apos;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$foto</span><span class="token punctuation">;</span>
                <span class="token keyword keyword-return">return</span> <span class="token variable">$foto</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword keyword-else">else</span> <span class="token punctuation">{</span>
                <span class="token keyword keyword-return">return</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</pre><h3>FUNCI&#xD3;N <strong>obtenerAlarmasUsuario()</strong></h3>
<blockquote>
<p><span style="color:green">@params</span> <b>INT</b> id_usuario, <b>String</b> orden, <b>String</b> sentido, <b>TS</b> fechaInicio, <b>TS</b> fechaFin</p>
</blockquote>
<blockquote>
<p><span style="color:green">@returns</span> Mixed <b>Array</b> | <b>Bool</b></p>
</blockquote>
<p>Esta funci&#xF3;n p&#xFA;blica sirve para para extraer las alarmas de las estaciones pertenecientes a un usuario dado su id, sobre unas fechas dados sus TimeStamps en un orden y sentido dados en los par&#xE1;metros. Se usa en la secci&#xF3;n de alarmas.</p>
<pre data-role="codeBlock" data-info="php" class="language-php"><span class="token keyword keyword-public">public</span> <span class="token keyword keyword-function">function</span> <span class="token function-definition function">obtenerAlarmasUsuario</span><span class="token punctuation">(</span><span class="token variable">$id_usuario</span><span class="token punctuation">,</span> <span class="token variable">$orden</span><span class="token punctuation">,</span> <span class="token variable">$sentido</span><span class="token punctuation">,</span> <span class="token variable">$fechaInicio</span><span class="token punctuation">,</span> <span class="token variable">$fechaFin</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token global">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;obtenerAlarmasUsuario_id&apos;</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token variable">$id_usuario</span> <span class="token operator">&amp;&amp;</span> <span class="token global">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;obtenerAlarmasUsuario_orden&apos;</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token variable">$orden</span> <span class="token operator">&amp;&amp;</span> <span class="token global">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;obtenerAlarmasUsuario_sentido&apos;</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token variable">$sentido</span> <span class="token operator">&amp;&amp;</span> <span class="token global">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;obtenerAlarmasUsuario_fechaini&apos;</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token variable">$fechaInicio</span> <span class="token operator">&amp;&amp;</span> <span class="token global">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;obtenerAlarmasUsuario_fechafin&apos;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$fechaFin</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword keyword-return">return</span> <span class="token variable">$alarmas</span> <span class="token operator">=</span> <span class="token global">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;obtenerAlarmasUsuario_alarmas&apos;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token function">conectar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token variable">$prioridad</span> <span class="token operator">=</span> <span class="token string single-quoted-string">&apos;alarmas.fecha_origen&apos;</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token variable">$orden</span> <span class="token operator">!=</span> <span class="token constant">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token variable">$prioridad</span> <span class="token operator">=</span> <span class="token string single-quoted-string">&apos;alarmas.fecha_origen&apos;</span><span class="token punctuation">;</span>
                <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token variable">$orden</span> <span class="token operator">!=</span> <span class="token constant">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token variable">$prioridad</span> <span class="token operator">=</span> <span class="token constant">null</span><span class="token punctuation">;</span>
                    <span class="token keyword keyword-switch">switch</span> <span class="token punctuation">(</span><span class="token variable">$orden</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token keyword keyword-case">case</span> <span class="token string single-quoted-string">&apos;estado&apos;</span><span class="token punctuation">:</span>
                            <span class="token variable">$prioridad</span> <span class="token operator">=</span> <span class="token string single-quoted-string">&apos;alarmas.estado&apos;</span><span class="token punctuation">;</span>
                            <span class="token keyword keyword-break">break</span><span class="token punctuation">;</span>
                        <span class="token keyword keyword-case">case</span> <span class="token string single-quoted-string">&apos;senal&apos;</span><span class="token punctuation">:</span>
                            <span class="token variable">$prioridad</span> <span class="token operator">=</span> <span class="token string single-quoted-string">&apos;tags.nombre_tag&apos;</span><span class="token punctuation">;</span>
                            <span class="token keyword keyword-break">break</span><span class="token punctuation">;</span>
                        <span class="token keyword keyword-case">case</span> <span class="token string single-quoted-string">&apos;restauracionfecha&apos;</span><span class="token punctuation">:</span>
                            <span class="token variable">$prioridad</span> <span class="token operator">=</span> <span class="token string single-quoted-string">&apos;alarmas.fecha_restauracion&apos;</span><span class="token punctuation">;</span>
                            <span class="token keyword keyword-break">break</span><span class="token punctuation">;</span>
                        <span class="token keyword keyword-case">case</span> <span class="token string single-quoted-string">&apos;estacion&apos;</span><span class="token punctuation">:</span>
                            <span class="token variable">$prioridad</span> <span class="token operator">=</span> <span class="token string single-quoted-string">&apos;estaciones.nombre_estacion&apos;</span><span class="token punctuation">;</span>
                            <span class="token keyword keyword-break">break</span><span class="token punctuation">;</span>
                        <span class="token keyword keyword-case">case</span> <span class="token string single-quoted-string">&apos;reconfecha&apos;</span><span class="token punctuation">:</span>
                            <span class="token variable">$prioridad</span> <span class="token operator">=</span> <span class="token string single-quoted-string">&apos;alarmas.fecha_ack&apos;</span><span class="token punctuation">;</span>
                            <span class="token keyword keyword-break">break</span><span class="token punctuation">;</span>
                        <span class="token keyword keyword-case">case</span> <span class="token string single-quoted-string">&apos;reconusu&apos;</span><span class="token punctuation">:</span>
                            <span class="token variable">$prioridad</span> <span class="token operator">=</span> <span class="token string single-quoted-string">&apos;alarmas.ack_por&apos;</span><span class="token punctuation">;</span>
                            <span class="token keyword keyword-break">break</span><span class="token punctuation">;</span>
                        <span class="token keyword keyword-case">case</span> <span class="token string single-quoted-string">&apos;valor&apos;</span><span class="token punctuation">:</span>
                            <span class="token variable">$prioridad</span> <span class="token operator">=</span> <span class="token string single-quoted-string">&apos;alarmas.valor_alarma&apos;</span><span class="token punctuation">;</span>
                            <span class="token keyword keyword-break">break</span><span class="token punctuation">;</span>
                        <span class="token keyword keyword-case">case</span> <span class="token string single-quoted-string">&apos;origenfecha&apos;</span><span class="token punctuation">:</span>
                            <span class="token variable">$prioridad</span> <span class="token operator">=</span> <span class="token string single-quoted-string">&apos;alarmas.fecha_origen&apos;</span><span class="token punctuation">;</span>
                            <span class="token keyword keyword-break">break</span><span class="token punctuation">;</span>

                        <span class="token keyword keyword-default">default</span><span class="token punctuation">:</span>
                            <span class="token variable">$prioridad</span> <span class="token operator">=</span> <span class="token string single-quoted-string">&apos;alarmas.fecha_origen&apos;</span><span class="token punctuation">;</span>
                            <span class="token keyword keyword-break">break</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            <span class="token variable">$conAlarmas</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;SELECT DISTINCT
            estaciones.nombre_estacion, tags.nombre_tag, alarmas.id_alarmas, alarmas.valor_alarma, alarmas.fecha_origen, alarmas.fecha_restauracion, alarmas.estado, alarmas.ack_por, alarmas.fecha_ack
            FROM alarmas INNER JOIN estacion_tag ON alarmas.id_tag = estacion_tag.id_tag INNER JOIN usuario_estacion ON usuario_estacion.id_estacion = estacion_tag.id_estacion INNER JOIN estaciones ON estaciones.id_estacion = estacion_tag.id_estacion INNER JOIN tags ON alarmas.id_tag = tags.id_tag
            WHERE usuario_estacion.id_usuario = &quot;</span> <span class="token operator">.</span> <span class="token variable">$id_usuario</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;id_usuario&apos;</span><span class="token punctuation">]</span> <span class="token operator">.</span> <span class="token string double-quoted-string">&quot;&quot;</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token variable">$fechaInicio</span> <span class="token operator">!=</span> <span class="token constant">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token variable">$ini</span> <span class="token operator">=</span> <span class="token function">strtotime</span><span class="token punctuation">(</span><span class="token variable">$fechaInicio</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token variable">$conAlarmas</span> <span class="token operator">.=</span> <span class="token string double-quoted-string">&quot; AND cast(extract(epoch from alarmas.fecha_origen) as integer) &lt;= &quot;</span> <span class="token operator">.</span> <span class="token variable">$ini</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token variable">$fechaFin</span> <span class="token operator">!=</span> <span class="token constant">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token variable">$fin</span> <span class="token operator">=</span> <span class="token function">strtotime</span><span class="token punctuation">(</span><span class="token variable">$fechaFin</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token variable">$conAlarmas</span> <span class="token operator">.=</span> <span class="token string double-quoted-string">&quot; AND cast(extract(epoch from alarmas.fecha_origen) as integer) &gt; &quot;</span> <span class="token operator">.</span> <span class="token variable">$fin</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token variable">$sentido</span> <span class="token operator">!=</span> <span class="token constant">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token variable">$sentido</span> <span class="token operator">==</span> <span class="token string single-quoted-string">&apos;ASC&apos;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token variable">$conAlarmas</span> <span class="token operator">.=</span> <span class="token string double-quoted-string">&quot; ORDER BY <span class="token interpolation"><span class="token variable">$prioridad</span></span> ASC&quot;</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword keyword-else">else</span> <span class="token punctuation">{</span>
                    <span class="token variable">$conAlarmas</span> <span class="token operator">.=</span> <span class="token string double-quoted-string">&quot; ORDER BY <span class="token interpolation"><span class="token variable">$prioridad</span></span> DESC&quot;</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span> <span class="token keyword keyword-else">else</span> <span class="token punctuation">{</span>
                <span class="token variable">$conAlarmas</span> <span class="token operator">.=</span> <span class="token string double-quoted-string">&quot; ORDER BY <span class="token interpolation"><span class="token variable">$prioridad</span></span> DESC&quot;</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token variable">$conAlarmas</span> <span class="token operator">.=</span> <span class="token string double-quoted-string">&quot; LIMIT 500&quot;</span><span class="token punctuation">;</span>
            <span class="token variable">$resulAlarmas</span> <span class="token operator">=</span> <span class="token function">pg_query</span><span class="token punctuation">(</span><span class="token variable">$conAlarmas</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token function">consultaExitosa</span><span class="token punctuation">(</span><span class="token variable">$resulAlarmas</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token variable">$alarmas</span> <span class="token operator">=</span> <span class="token function">pg_fetch_all</span><span class="token punctuation">(</span><span class="token variable">$resulAlarmas</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token global">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;obtenerAlarmasUsuario_id&apos;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$id_usuario</span><span class="token punctuation">;</span>
                <span class="token global">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;obtenerAlarmasUsuario_orden&apos;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$orden</span><span class="token punctuation">;</span>
                <span class="token global">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;obtenerAlarmasUsuario_sentido&apos;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$sentido</span><span class="token punctuation">;</span>
                <span class="token global">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;obtenerAlarmasUsuario_fechaini&apos;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$fechaInicio</span><span class="token punctuation">;</span>
                <span class="token global">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;obtenerAlarmasUsuario_fechafin&apos;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$fechaFin</span><span class="token punctuation">;</span>
                <span class="token global">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;obtenerAlarmasUsuario_alarmas&apos;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$alarmas</span><span class="token punctuation">;</span>
                <span class="token keyword keyword-return">return</span> <span class="token variable">$alarmas</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword keyword-else">else</span> <span class="token punctuation">{</span>
                <span class="token keyword keyword-return">return</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword keyword-else">else</span> <span class="token punctuation">{</span>
            <span class="token keyword keyword-return">return</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

</pre><h3>FUNCI&#xD3;N <strong>obtenerAlarmasEstacion()</strong></h3>
<blockquote>
<p><span style="color:green">@params</span> <b>INT</b> id_estacion, <b>String</b> orden, <b>String</b> sentido, <b>TS</b> fechaInicio, <b>TS</b> fechaFin</p>
</blockquote>
<blockquote>
<p><span style="color:green">@returns</span> Mixed <b>Array</b> | <b>Bool</b></p>
</blockquote>
<p>Esta funci&#xF3;n p&#xFA;blica extrae las alarmas de una estacion dado su id, sobre unas fechas dados sus TimeStamps en un orden y sentido dados en los par&#xE1;metros. Se usa en la secci&#xF3;n de alarmas.</p>
<pre data-role="codeBlock" data-info="php" class="language-php"><span class="token keyword keyword-public">public</span> <span class="token keyword keyword-function">function</span> <span class="token function-definition function">obtenerAlarmasEstacion</span><span class="token punctuation">(</span><span class="token variable">$id_estacion</span><span class="token punctuation">,</span> <span class="token variable">$orden</span><span class="token punctuation">,</span> <span class="token variable">$sentido</span><span class="token punctuation">,</span> <span class="token variable">$fechaInicio</span><span class="token punctuation">,</span> <span class="token variable">$fechaFin</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token global">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;obtenerAlarmasEstacion_id_estacion&apos;</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token variable">$id_estacion</span> <span class="token operator">&amp;&amp;</span> <span class="token global">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;obtenerAlarmasEstacion_orden&apos;</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token variable">$orden</span> <span class="token operator">&amp;&amp;</span> <span class="token global">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;obtenerAlarmasEstacion_sentido&apos;</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token variable">$sentido</span> <span class="token operator">&amp;&amp;</span> <span class="token global">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;obtenerAlarmasEstacion_fechaini&apos;</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token variable">$fechaInicio</span> <span class="token operator">&amp;&amp;</span> <span class="token global">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;obtenerAlarmasEstacion_fechafin&apos;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$fechaFin</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword keyword-return">return</span> <span class="token variable">$alarmasEstacion</span> <span class="token operator">=</span> <span class="token global">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;obtenerAlarmasEstacion_id_estacion&apos;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token variable">$fechaInicio</span> <span class="token operator">!=</span> <span class="token constant">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token punctuation">}</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token variable">$fechaFin</span> <span class="token operator">!=</span> <span class="token constant">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token punctuation">}</span>

        <span class="token variable">$prioridad</span> <span class="token operator">=</span> <span class="token string single-quoted-string">&apos;alarmas.fecha_origen&apos;</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token variable">$orden</span> <span class="token operator">!=</span> <span class="token constant">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token variable">$prioridad</span> <span class="token operator">=</span> <span class="token constant">null</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-switch">switch</span> <span class="token punctuation">(</span><span class="token variable">$orden</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword keyword-case">case</span> <span class="token string single-quoted-string">&apos;estado&apos;</span><span class="token punctuation">:</span>
                    <span class="token variable">$prioridad</span> <span class="token operator">=</span> <span class="token string single-quoted-string">&apos;alarmas.estado&apos;</span><span class="token punctuation">;</span>
                    <span class="token keyword keyword-break">break</span><span class="token punctuation">;</span>
                <span class="token keyword keyword-case">case</span> <span class="token string single-quoted-string">&apos;senal&apos;</span><span class="token punctuation">:</span>
                    <span class="token variable">$prioridad</span> <span class="token operator">=</span> <span class="token string single-quoted-string">&apos;tags.nombre_tag&apos;</span><span class="token punctuation">;</span>
                    <span class="token keyword keyword-break">break</span><span class="token punctuation">;</span>
                <span class="token keyword keyword-case">case</span> <span class="token string single-quoted-string">&apos;restauracionfecha&apos;</span><span class="token punctuation">:</span>
                    <span class="token variable">$prioridad</span> <span class="token operator">=</span> <span class="token string single-quoted-string">&apos;alarmas.fecha_restauracion&apos;</span><span class="token punctuation">;</span>
                    <span class="token keyword keyword-break">break</span><span class="token punctuation">;</span>
                <span class="token keyword keyword-case">case</span> <span class="token string single-quoted-string">&apos;estacion&apos;</span><span class="token punctuation">:</span>
                    <span class="token variable">$prioridad</span> <span class="token operator">=</span> <span class="token string single-quoted-string">&apos;estaciones.nombre_estacion&apos;</span><span class="token punctuation">;</span>
                    <span class="token keyword keyword-break">break</span><span class="token punctuation">;</span>
                <span class="token keyword keyword-case">case</span> <span class="token string single-quoted-string">&apos;reconfecha&apos;</span><span class="token punctuation">:</span>
                    <span class="token variable">$prioridad</span> <span class="token operator">=</span> <span class="token string single-quoted-string">&apos;alarmas.fecha_ack&apos;</span><span class="token punctuation">;</span>
                    <span class="token keyword keyword-break">break</span><span class="token punctuation">;</span>
                <span class="token keyword keyword-case">case</span> <span class="token string single-quoted-string">&apos;reconusu&apos;</span><span class="token punctuation">:</span>
                    <span class="token variable">$prioridad</span> <span class="token operator">=</span> <span class="token string single-quoted-string">&apos;alarmas.ack_por&apos;</span><span class="token punctuation">;</span>
                    <span class="token keyword keyword-break">break</span><span class="token punctuation">;</span>
                <span class="token keyword keyword-case">case</span> <span class="token string single-quoted-string">&apos;valor&apos;</span><span class="token punctuation">:</span>
                    <span class="token variable">$prioridad</span> <span class="token operator">=</span> <span class="token string single-quoted-string">&apos;alarmas.valor_alarma&apos;</span><span class="token punctuation">;</span>
                    <span class="token keyword keyword-break">break</span><span class="token punctuation">;</span>
                <span class="token keyword keyword-case">case</span> <span class="token string single-quoted-string">&apos;origenfecha&apos;</span><span class="token punctuation">:</span>
                    <span class="token variable">$prioridad</span> <span class="token operator">=</span> <span class="token string single-quoted-string">&apos;alarmas.fecha_origen&apos;</span><span class="token punctuation">;</span>
                    <span class="token keyword keyword-break">break</span><span class="token punctuation">;</span>

                <span class="token keyword keyword-default">default</span><span class="token punctuation">:</span>
                    <span class="token variable">$prioridad</span> <span class="token operator">=</span> <span class="token string single-quoted-string">&apos;alarmas.fecha_origen&apos;</span><span class="token punctuation">;</span>
                    <span class="token keyword keyword-break">break</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token function">conectar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

            <span class="token variable">$consulta</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;SELECT estaciones.nombre_estacion, tags.nombre_tag, alarmas.id_alarmas, alarmas.valor_alarma, alarmas.fecha_origen, alarmas.fecha_restauracion, alarmas.estado, alarmas.ack_por, alarmas.fecha_ack
        FROM alarmas INNER JOIN estacion_tag ON alarmas.id_tag = estacion_tag.id_tag INNER JOIN usuario_estacion ON usuario_estacion.id_estacion = estacion_tag.id_estacion INNER JOIN estaciones ON estaciones.id_estacion = estacion_tag.id_estacion INNER JOIN tags ON alarmas.id_tag = tags.id_tag
        WHERE estacion_tag.id_estacion = &apos;<span class="token interpolation"><span class="token variable">$id_estacion</span></span>&apos;&quot;</span><span class="token punctuation">;</span>


            <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token variable">$fechaInicio</span> <span class="token operator">!=</span> <span class="token constant">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token variable">$ini</span> <span class="token operator">=</span> <span class="token function">strtotime</span><span class="token punctuation">(</span><span class="token variable">$fechaInicio</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token variable">$consulta</span> <span class="token operator">.=</span> <span class="token string double-quoted-string">&quot; AND cast(extract(epoch from alarmas.fecha_origen) as integer) &lt;= &quot;</span> <span class="token operator">.</span> <span class="token variable">$ini</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token variable">$fechaFin</span> <span class="token operator">!=</span> <span class="token constant">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token variable">$fin</span> <span class="token operator">=</span> <span class="token function">strtotime</span><span class="token punctuation">(</span><span class="token variable">$fechaFin</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token variable">$consulta</span> <span class="token operator">.=</span> <span class="token string double-quoted-string">&quot; AND cast(extract(epoch from alarmas.fecha_origen) as integer) &gt;= &quot;</span> <span class="token operator">.</span> <span class="token variable">$fin</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token variable">$sentido</span> <span class="token operator">!=</span> <span class="token constant">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token variable">$sentido</span> <span class="token operator">==</span> <span class="token string single-quoted-string">&apos;ASC&apos;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token variable">$consulta</span> <span class="token operator">.=</span> <span class="token string double-quoted-string">&quot; ORDER BY <span class="token interpolation"><span class="token variable">$prioridad</span></span> ASC LIMIT 300&quot;</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword keyword-else">else</span> <span class="token punctuation">{</span>
                    <span class="token variable">$consulta</span> <span class="token operator">.=</span> <span class="token string double-quoted-string">&quot; ORDER BY <span class="token interpolation"><span class="token variable">$prioridad</span></span> DESC LIMIT 300&quot;</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span> <span class="token keyword keyword-else">else</span> <span class="token punctuation">{</span>
                <span class="token variable">$consulta</span> <span class="token operator">.=</span> <span class="token string double-quoted-string">&quot; ORDER BY <span class="token interpolation"><span class="token variable">$prioridad</span></span> DESC LIMIT 300&quot;</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token variable">$resultado</span> <span class="token operator">=</span> <span class="token function">pg_query</span><span class="token punctuation">(</span><span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token property">conexion</span><span class="token punctuation">,</span> <span class="token variable">$consulta</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


            <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token function">consultaExitosa</span><span class="token punctuation">(</span><span class="token variable">$resultado</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token variable">$alarmasEstacion</span> <span class="token operator">=</span> <span class="token function">pg_fetch_all</span><span class="token punctuation">(</span><span class="token variable">$resultado</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token global">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;obtenerAlarmasEstacion_id_estacion&apos;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$id_estacion</span><span class="token punctuation">;</span>
                <span class="token global">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;obtenerAlarmasEstacion_orden&apos;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$orden</span><span class="token punctuation">;</span>
                <span class="token global">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;obtenerAlarmasEstacion_sentido&apos;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$sentido</span><span class="token punctuation">;</span>
                <span class="token global">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;obtenerAlarmasEstacion_fechafin&apos;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$fechaInicio</span><span class="token punctuation">;</span>
                <span class="token global">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;obtenerAlarmasEstacion_fechafin&apos;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$fechaFin</span><span class="token punctuation">;</span>
                <span class="token global">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;obtenerAlarmasEstacion_alarmas&apos;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$alarmasEstacion</span><span class="token punctuation">;</span>
                <span class="token keyword keyword-return">return</span> <span class="token variable">$alarmasEstacion</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword keyword-else">else</span> <span class="token punctuation">{</span>
            <span class="token keyword keyword-return">return</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</pre><h3>FUNCI&#xD3;N <strong>obtenerDetallesAlarma()</strong></h3>
<blockquote>
<p><span style="color:green">@params</span> <b>INT</b> id_alarma</p>
</blockquote>
<blockquote>
<p><span style="color:green">@returns</span> Mixed <b>Array</b> | <b>Bool</b></p>
</blockquote>
<p>Esta funci&#xF3;n p&#xFA;blica extrae los datos hist&#xF3;ricos del tag vinculado a una alarma dada su id, para mostrar durante un margen de un dia la tendencia de sus datos. Se usa en la secci&#xF3;n de alarmas</p>
<pre data-role="codeBlock" data-info="php" class="language-php"><span class="token keyword keyword-function">function</span> <span class="token function-definition function">obtenerDetallesAlarma</span><span class="token punctuation">(</span><span class="token variable">$id_alarma</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token function">conectar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token variable">$consulta_id</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;SELECT id_tag, fecha_origen from alarmas where id_alarmas = &quot;</span> <span class="token operator">.</span> <span class="token variable">$id_alarma</span> <span class="token operator">.</span> <span class="token string double-quoted-string">&quot; limit 1&quot;</span><span class="token punctuation">;</span>
            <span class="token variable">$respuesta_id</span> <span class="token operator">=</span> <span class="token function">pg_query</span><span class="token punctuation">(</span><span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token property">conexion</span><span class="token punctuation">,</span> <span class="token variable">$consulta_id</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token function">consultaExitosa</span><span class="token punctuation">(</span><span class="token variable">$respuesta_id</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token variable">$datos_alarma</span> <span class="token operator">=</span> <span class="token function">pg_fetch_all</span><span class="token punctuation">(</span><span class="token variable">$respuesta_id</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token variable">$consulta_detalles</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;SELECT datos_historicos.valor_bool, datos_historicos.valor_float, datos_historicos.valor_acu, datos_historicos.valor_int, datos_historicos.fecha, estaciones.nombre_estacion, tags.nombre_tag FROM datos_historicos INNER JOIN estacion_tag ON datos_historicos.id_tag = estacion_tag.id_tag INNER JOIN estaciones ON estacion_tag.id_estacion = estaciones.id_estacion INNER JOIN tags ON tags.id_tag = datos_historicos.id_tag WHERE datos_historicos.id_tag= &quot;</span> <span class="token operator">.</span> <span class="token variable">$datos_alarma</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;id_tag&apos;</span><span class="token punctuation">]</span> <span class="token operator">.</span> <span class="token string double-quoted-string">&quot; AND(datos_historicos.fecha::date - interval &apos;1 days&apos;) &lt; &apos;&quot;</span> <span class="token operator">.</span> <span class="token variable">$datos_alarma</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;fecha_origen&apos;</span><span class="token punctuation">]</span> <span class="token operator">.</span> <span class="token string double-quoted-string">&quot;&apos; AND (datos_historicos.fecha::date + interval &apos;1 days&apos;) &gt; &apos;&quot;</span> <span class="token operator">.</span> <span class="token variable">$datos_alarma</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;fecha_origen&apos;</span><span class="token punctuation">]</span> <span class="token operator">.</span> <span class="token string double-quoted-string">&quot;&apos; ORDER BY datos_historicos.fecha DESC&quot;</span><span class="token punctuation">;</span>
                <span class="token variable">$respuesta_detalles</span> <span class="token operator">=</span> <span class="token function">pg_query</span><span class="token punctuation">(</span><span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token property">conexion</span><span class="token punctuation">,</span> <span class="token variable">$consulta_detalles</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token function">consultaExitosa</span><span class="token punctuation">(</span><span class="token variable">$respuesta_detalles</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token variable">$detalles</span> <span class="token operator">=</span> <span class="token function">pg_fetch_all</span><span class="token punctuation">(</span><span class="token variable">$respuesta_detalles</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword keyword-return">return</span> <span class="token variable">$detalles</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword keyword-return">return</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</pre><h3>FUNCI&#xD3;N <strong>datosEstacion()</strong></h3>
<blockquote>
<p><span style="color:green">@params</span> <b>INT</b> id_estacion, <b>Bool todos</b></p>
</blockquote>
<blockquote>
<p><span style="color:green">@returns</span> <b>Array</b></p>
</blockquote>
<p>Esta funci&#xF3;n p&#xFA;blica obtiene la &#xFA;ltima informaci&#xF3;n conocida de una estaci&#xF3;n dado su id. Se usa en las secciones de estaci&#xF3;n.</p>
<pre data-role="codeBlock" data-info="php" class="language-php"><span class="token keyword keyword-public">public</span> <span class="token keyword keyword-function">function</span> <span class="token function-definition function">datosEstacion</span><span class="token punctuation">(</span><span class="token variable">$id_estacion</span><span class="token punctuation">,</span> <span class="token variable">$todos</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token global">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;datosEstacion_id_estacion&apos;</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token variable">$id_estacion</span> <span class="token operator">&amp;&amp;</span> <span class="token global">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;datosEstacion_todos&apos;</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token variable">$todos</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword keyword-return">return</span> <span class="token variable">$ultimosDatosEstacionLimpio</span> <span class="token operator">=</span> <span class="token global">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;datosEstacion_result&apos;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token function">conectar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token variable">$tagsEstacion</span> <span class="token operator">=</span> <span class="token keyword keyword-array">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token variable">$ultimosDatosEstacion</span> <span class="token operator">=</span> <span class="token keyword keyword-array">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token variable">$todos</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token variable">$tagsEstacion</span> <span class="token operator">=</span> <span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token function">todosTagsEstacion</span><span class="token punctuation">(</span><span class="token variable">$id_estacion</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword keyword-else">else</span> <span class="token punctuation">{</span>
                <span class="token variable">$tagsEstacion</span> <span class="token operator">=</span> <span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token function">tagsEstacion</span><span class="token punctuation">(</span><span class="token variable">$id_estacion</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword keyword-foreach">foreach</span> <span class="token punctuation">(</span><span class="token variable">$tagsEstacion</span> <span class="token keyword keyword-as">as</span> <span class="token variable">$index</span> <span class="token operator">=&gt;</span> <span class="token variable">$tag</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token variable">$conUltimoValorTag</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;SELECT tags.nombre_tag, tags.unidad, tags.r_max, tags.r_min,
            datos_valores.id_tag, datos_valores.fecha, datos_valores.valor_bool, datos_valores.valor_int, datos_valores.valor_float, datos_valores.valor_acu, datos_valores.valor_string, datos_valores.valor_date
            FROM datos_valores INNER JOIN tags ON datos_valores.id_tag = tags.id_tag
            INNER JOIN estacion_tag ON estacion_tag.id_tag = tags.id_tag
            WHERE tags.id_tag = &quot;</span> <span class="token operator">.</span> <span class="token variable">$tag</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;id_tag&apos;</span><span class="token punctuation">]</span> <span class="token operator">.</span> <span class="token string double-quoted-string">&quot; AND estacion_tag.id_estacion = &quot;</span> <span class="token operator">.</span> <span class="token variable">$id_estacion</span> <span class="token operator">.</span> <span class="token string double-quoted-string">&quot;&quot;</span><span class="token punctuation">;</span>

                <span class="token variable">$resulConUltimoValorTag</span> <span class="token operator">=</span> <span class="token function">pg_query</span><span class="token punctuation">(</span><span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token property">conexion</span><span class="token punctuation">,</span> <span class="token variable">$conUltimoValorTag</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token function">consultaExitosa</span><span class="token punctuation">(</span><span class="token variable">$resulConUltimoValorTag</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token variable">$ultimosDatosEstacion</span><span class="token punctuation">[</span><span class="token variable">$tag</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;id_tag&apos;</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">pg_fetch_all</span><span class="token punctuation">(</span><span class="token variable">$resulConUltimoValorTag</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            <span class="token variable">$ultimosDatosEstacionLimpio</span> <span class="token operator">=</span> <span class="token keyword keyword-array">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-foreach">foreach</span> <span class="token punctuation">(</span><span class="token variable">$ultimosDatosEstacion</span> <span class="token keyword keyword-as">as</span> <span class="token variable">$tag</span> <span class="token operator">=&gt;</span> <span class="token variable">$datosTag</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword keyword-foreach">foreach</span> <span class="token punctuation">(</span><span class="token variable">$datosTag</span> <span class="token keyword keyword-as">as</span> <span class="token variable">$nDato</span> <span class="token operator">=&gt;</span> <span class="token variable">$valor</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token variable">$nDato</span> <span class="token operator">!=</span> <span class="token string single-quoted-string">&apos;nombre_tag&apos;</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$nDato</span> <span class="token operator">!=</span> <span class="token string single-quoted-string">&apos;id_tag&apos;</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$nDato</span> <span class="token operator">!=</span> <span class="token string single-quoted-string">&apos;id_datos&apos;</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$nDato</span> <span class="token operator">!=</span> <span class="token string single-quoted-string">&apos;fecha&apos;</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$nDato</span> <span class="token operator">!=</span> <span class="token string single-quoted-string">&apos;calidad&apos;</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$nDato</span> <span class="token operator">!=</span> <span class="token string single-quoted-string">&apos;unidad&apos;</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$nDato</span> <span class="token operator">!=</span> <span class="token string single-quoted-string">&apos;r_max&apos;</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$nDato</span> <span class="token operator">!=</span> <span class="token string single-quoted-string">&apos;r_min&apos;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token variable">$valor</span> <span class="token operator">!=</span> <span class="token constant">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                            <span class="token variable">$ultimosDatosEstacionLimpio</span><span class="token punctuation">[</span><span class="token variable">$tag</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;valor&apos;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$valor</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span> <span class="token keyword keyword-else">else</span> <span class="token punctuation">{</span>
                        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token variable">$valor</span> <span class="token operator">!=</span> <span class="token constant">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                            <span class="token variable">$ultimosDatosEstacionLimpio</span><span class="token punctuation">[</span><span class="token variable">$tag</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token variable">$nDato</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$valor</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            <span class="token global">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;datosEstacion_id_estacion&apos;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$id_estacion</span><span class="token punctuation">;</span>
            <span class="token global">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;datosEstacion_todos&apos;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$todos</span><span class="token punctuation">;</span>
            <span class="token global">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;datosEstacion_result&apos;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$ultimosDatosEstacionLimpio</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-return">return</span> <span class="token variable">$ultimosDatosEstacionLimpio</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</pre><h3>FUNCI&#xD3;N <strong>tagsEstacion()</strong></h3>
<blockquote>
<p><span style="color:green">@params</span> <b>INT</b> id_estacion</p>
</blockquote>
<blockquote>
<p><span style="color:green">@returns</span> Mixed <b>Array</b> | <b>Bool</b></p>
</blockquote>
<p>Esta funci&#xF3;n obtiene los tags historizables de una estaci&#xF3;n dado su id. Se usa en las gr&#xE1;ficas y secciones de estaci&#xF3;n.</p>
<pre data-role="codeBlock" data-info="php" class="language-php"><span class="token keyword keyword-public">public</span> <span class="token keyword keyword-function">function</span> <span class="token function-definition function">tagsEstacion</span><span class="token punctuation">(</span><span class="token variable">$id_estacion</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token function">conectar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token variable">$conTags</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;SELECT tags.id_tag, tags.nombre_tag FROM estacion_tag INNER JOIN tags ON tags.id_tag = estacion_tag.id_tag WHERE estacion_tag.id_estacion = <span class="token interpolation"><span class="token variable">$id_estacion</span></span> AND tags.historizar = true AND tags.nombre_tag NOT LIKE(&apos;%Bomba%&apos;)&quot;</span><span class="token punctuation">;</span>
            <span class="token variable">$resulTags</span> <span class="token operator">=</span> <span class="token function">pg_query</span><span class="token punctuation">(</span><span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token property">conexion</span><span class="token punctuation">,</span> <span class="token variable">$conTags</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token function">consultaExitosa</span><span class="token punctuation">(</span><span class="token variable">$resulTags</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token variable">$tagsEstacion</span> <span class="token operator">=</span> <span class="token function">pg_fetch_all</span><span class="token punctuation">(</span><span class="token variable">$resulTags</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token global">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;tagsEstacion&apos;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$tagsEstacion</span><span class="token punctuation">;</span>
                <span class="token keyword keyword-return">return</span> <span class="token variable">$tagsEstacion</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword keyword-else">else</span> <span class="token punctuation">{</span>
                <span class="token keyword keyword-return">return</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword keyword-return">return</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</pre><h3>FUNCI&#xD3;N <strong>todosTagsEstacion()</strong></h3>
<blockquote>
<p><span style="color:green">@params</span> <b>INT</b> id_estacion</p>
</blockquote>
<blockquote>
<p><span style="color:green">@returns</span> Mixed <b>Array</b> | <b>Bool</b></p>
</blockquote>
<p>Esta funci&#xF3;n obtiene los tags de una estaci&#xF3;n dado su id. Se usa en las gr&#xE1;ficas, secci&#xF3;n principal y secciones de estaci&#xF3;n.</p>
<pre data-role="codeBlock" data-info="php" class="language-php">    <span class="token keyword keyword-public">public</span> <span class="token keyword keyword-function">function</span> <span class="token function-definition function">todosTagsEstacion</span><span class="token punctuation">(</span><span class="token variable">$id_estacion</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token global">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;todosTagsEstacion_id_estacion&apos;</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token variable">$id_estacion</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword keyword-return">return</span> <span class="token variable">$tagsEstacion</span> <span class="token operator">=</span> <span class="token global">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;todosTagsEstacion_result&apos;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token function">conectar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token variable">$conTags</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;SELECT tags.id_tag, tags.nombre_tag FROM estacion_tag INNER JOIN tags ON tags.id_tag = estacion_tag.id_tag WHERE estacion_tag.id_estacion = &quot;</span> <span class="token operator">.</span> <span class="token variable">$id_estacion</span> <span class="token operator">.</span> <span class="token string double-quoted-string">&quot; AND tags.nombre_tag NOT LIKE(&apos;%Alarma%&apos;);&quot;</span><span class="token punctuation">;</span>
            <span class="token variable">$resulTags</span> <span class="token operator">=</span> <span class="token function">pg_query</span><span class="token punctuation">(</span><span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token property">conexion</span><span class="token punctuation">,</span> <span class="token variable">$conTags</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token function">consultaExitosa</span><span class="token punctuation">(</span><span class="token variable">$resulTags</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token variable">$tagsEstacion</span> <span class="token operator">=</span> <span class="token function">pg_fetch_all</span><span class="token punctuation">(</span><span class="token variable">$resulTags</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token global">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;tagsEstacion&apos;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$tagsEstacion</span><span class="token punctuation">;</span>
                <span class="token global">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;todosTagsEstacion_id_estacion&apos;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$id_estacion</span><span class="token punctuation">;</span>
                <span class="token global">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;todosTagsEstacion_result&apos;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$tagsEstacion</span><span class="token punctuation">;</span>
                <span class="token keyword keyword-return">return</span> <span class="token variable">$tagsEstacion</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword keyword-else">else</span> <span class="token punctuation">{</span>
                <span class="token keyword keyword-return">return</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword keyword-return">return</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</pre><h3>FUNCI&#xD3;N <strong>tagsAnalogHisto()</strong></h3>
<blockquote>
<p><span style="color:green">@params</span> <b>Array</b> estaciones</p>
</blockquote>
<blockquote>
<p><span style="color:green">@returns</span> Mixed <b>Array</b> | <b>Bool</b></p>
</blockquote>
<p>Esta funci&#xF3;n obtiene los tags anal&#xF3;gicos historizables de un grupo de estaciones dados los id de las estaciones.</p>
<pre data-role="codeBlock" data-info="php" class="language-php"><span class="token keyword keyword-public">public</span> <span class="token keyword keyword-function">function</span> <span class="token function-definition function">tagsAnalogHisto</span><span class="token punctuation">(</span><span class="token variable">$estaciones</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token global">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;tagsAnalogHisto_estaciones&apos;</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token variable">$estaciones</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword keyword-return">return</span> <span class="token variable">$tagsAnalogsHisto</span> <span class="token operator">=</span> <span class="token global">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;tagsAnalogHisto_result&apos;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token variable">$tagsAnalogsHisto</span> <span class="token operator">=</span> <span class="token keyword keyword-array">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token function">conectar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword keyword-foreach">foreach</span> <span class="token punctuation">(</span><span class="token variable">$estaciones</span> <span class="token keyword keyword-as">as</span> <span class="token variable">$index</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token variable">$id</span> <span class="token operator">=</span> <span class="token variable">$index</span><span class="token operator">-&gt;</span><span class="token property">id_estacion</span><span class="token punctuation">;</span>
                <span class="token variable">$conAnalog</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;select tags.id_tag,tags.nombre_tag, estaciones.id_estacion, estaciones.nombre_estacion from tags inner join estacion_tag on tags.id_tag = estacion_tag.id_tag inner join estaciones on estaciones.id_estacion = estacion_tag.id_estacion
                where tags.type_tag &gt; 2 and tags.type_tag &lt; 5 and tags.historizar = true and tags.disabled = false
                and estaciones.id_estacion = &quot;</span> <span class="token operator">.</span> <span class="token variable">$id</span> <span class="token operator">.</span> <span class="token string double-quoted-string">&quot;
                order by estaciones.nombre_estacion asc&quot;</span><span class="token punctuation">;</span>

                <span class="token variable">$resAnalog</span> <span class="token operator">=</span> <span class="token function">pg_query</span><span class="token punctuation">(</span><span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token property">conexion</span><span class="token punctuation">,</span> <span class="token variable">$conAnalog</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token function">consultaExitosa</span><span class="token punctuation">(</span><span class="token variable">$resAnalog</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token variable">$tagsAnalog</span> <span class="token operator">=</span> <span class="token function">pg_fetch_all</span><span class="token punctuation">(</span><span class="token variable">$resAnalog</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token variable">$tagsAnalogsHisto</span><span class="token punctuation">[</span><span class="token variable">$index</span><span class="token operator">-&gt;</span><span class="token property">nombre_estacion</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$tagsAnalog</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            <span class="token global">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;tagsAnalogHisto_estaciones&apos;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$estaciones</span><span class="token punctuation">;</span>
            <span class="token global">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;tagsAnalogHisto_result&apos;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$tagsAnalogsHisto</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-return">return</span> <span class="token variable">$tagsAnalogsHisto</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword keyword-return">return</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</pre><h3>FUNCI&#xD3;N <strong>historicosEstacion()</strong></h3>
<blockquote>
<p><span style="color:green">@params</span> <b>INT</b> id_estacion, <b>TS</b> fechaIni, <b>TS</b> fechaFin</p>
</blockquote>
<blockquote>
<p><span style="color:green">@returns</span> Mixed <b>Array</b> | <b>Bool</b></p>
</blockquote>
<p>Esta funci&#xF3;n obtiene los datos hist&#xF3;ricos de todos los tags historizables de una estaci&#xF3;n dado el id de la estaci&#xF3;n entre unas fechas comprendidas entre los TimeStamps de fechaIni y fechaFin.</p>
<pre data-role="codeBlock" data-info="php" class="language-php"><span class="token keyword keyword-public">public</span> <span class="token keyword keyword-function">function</span> <span class="token function-definition function">historicosEstacion</span><span class="token punctuation">(</span><span class="token variable">$id_estacion</span><span class="token punctuation">,</span> <span class="token variable">$fechaIni</span><span class="token punctuation">,</span> <span class="token variable">$fechaFin</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token function">conectar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token variable">$tagsEstacion</span> <span class="token operator">=</span> <span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token function">tagsEstacion</span><span class="token punctuation">(</span><span class="token variable">$id_estacion</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token global">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;tagsEstacion&apos;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$tagsEstacion</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token variable">$tagsEstacion</span> <span class="token operator">!=</span> <span class="token constant boolean">false</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword keyword-foreach">foreach</span> <span class="token punctuation">(</span><span class="token variable">$tagsEstacion</span> <span class="token keyword keyword-as">as</span> <span class="token variable">$index</span> <span class="token operator">=&gt;</span> <span class="token variable">$tag</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token variable">$tag</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;id_tag&apos;</span><span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token variable">$conHisto</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;SELECT fecha, calidad, valor_bool, valor_int, valor_acu, valor_float, valor_string, valor_date FROM datos_historicos WHERE id_tag = &quot;</span> <span class="token operator">.</span> <span class="token variable">$tag</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;id_tag&apos;</span><span class="token punctuation">]</span> <span class="token operator">.</span> <span class="token string double-quoted-string">&quot; &quot;</span><span class="token punctuation">;</span>
                        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token variable">$fechaIni</span> <span class="token operator">!=</span> <span class="token string double-quoted-string">&quot;&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                            <span class="token variable">$conHisto</span> <span class="token operator">.=</span> <span class="token string double-quoted-string">&quot; AND fecha &gt;= <span class="token interpolation"><span class="token variable">$fechaIni</span></span> &quot;</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>
                        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token variable">$fechaFin</span> <span class="token operator">!=</span> <span class="token string double-quoted-string">&quot;&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                            <span class="token variable">$conHisto</span> <span class="token operator">.=</span>  <span class="token string double-quoted-string">&quot; AND fecha &lt;= <span class="token interpolation"><span class="token variable">$fechaFin</span></span> &quot;</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>
                        <span class="token variable">$conHisto</span> <span class="token operator">.=</span> <span class="token string double-quoted-string">&quot; ORDER BY fecha DESC LIMIT 100&quot;</span><span class="token punctuation">;</span>

                        <span class="token variable">$resulHisto</span> <span class="token operator">=</span> <span class="token function">pg_query</span><span class="token punctuation">(</span><span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token property">conexion</span><span class="token punctuation">,</span> <span class="token variable">$conHisto</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token function">consultaExitosa</span><span class="token punctuation">(</span><span class="token variable">$resulHisto</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                            <span class="token variable">$historicoTag</span> <span class="token operator">=</span> <span class="token function">pg_fetch_all</span><span class="token punctuation">(</span><span class="token variable">$resulHisto</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            <span class="token variable">$historicos</span><span class="token punctuation">[</span><span class="token variable">$tag</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;nombre_tag&apos;</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$historicoTag</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
                <span class="token keyword keyword-return">return</span> <span class="token variable">$historicos</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword keyword-else">else</span> <span class="token punctuation">{</span>
            <span class="token keyword keyword-return">return</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</pre><h3>FUNCI&#xD3;N <strong>historicosTagEstacion()</strong></h3>
<blockquote>
<p><span style="color:green">@params</span> <b>INT</b> id_tag</p>
</blockquote>
<blockquote>
<p><span style="color:green">@returns</span> Mixed <b>Array</b> | <b>Bool</b></p>
</blockquote>
<p>Esta funci&#xF3;n obtiene los datos_historicos de los ultimos 7 dias en un agregado 5 minutal de un tag dado su id. Se usa en graficas &gt; vista r&#xE1;pida</p>
<pre data-role="codeBlock" data-info="php" class="language-php"><span class="token keyword keyword-public">public</span> <span class="token keyword keyword-function">function</span> <span class="token function-definition function">historicosTagEstacion</span><span class="token punctuation">(</span><span class="token variable">$id_estacion</span><span class="token punctuation">,</span> <span class="token variable">$id_tag</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token function">conectar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token variable">$conHistoTagEst</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;WITH t as
            (
             SELECT
                to_timestamp(round((extract(epoch from fecha)) / 10) * 10)::TIMESTAMP AS ts,
                AVG(valor_float) AS dob, AVG(valor_acu) AS acu, AVG(valor_int) AS ent
             FROM datos_historicos
             WHERE id_tag = &quot;</span> <span class="token operator">.</span> <span class="token variable">$id_tag</span> <span class="token operator">.</span> <span class="token string double-quoted-string">&quot; AND fecha::date &gt; current_date::date - interval &apos;7 days&apos;  AND fecha::date &lt; current_date::date
             GROUP BY ts
            ),
            contiguous_ts_list as
            (
             select ts from generate_series(
              (select min(ts) from t),
              (select max(ts) from t),
              interval &apos;5 minutes&apos;
             ) ts
            )
            select *
            from contiguous_ts_list
            left outer join t using (ts)
            order by ts;&quot;</span><span class="token punctuation">;</span>
            <span class="token variable">$resulHistoTagEst</span> <span class="token operator">=</span> <span class="token function">pg_query</span><span class="token punctuation">(</span><span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token property">conexion</span><span class="token punctuation">,</span> <span class="token variable">$conHistoTagEst</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token function">consultaExitosa</span><span class="token punctuation">(</span><span class="token variable">$resulHistoTagEst</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token variable">$datosHistoTagEst</span> <span class="token operator">=</span> <span class="token function">pg_fetch_all</span><span class="token punctuation">(</span><span class="token variable">$resulHistoTagEst</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token variable">$datosHisto</span> <span class="token operator">=</span> <span class="token keyword keyword-array">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword keyword-foreach">foreach</span> <span class="token punctuation">(</span><span class="token variable">$datosHistoTagEst</span> <span class="token keyword keyword-as">as</span> <span class="token variable">$index</span> <span class="token operator">=&gt;</span> <span class="token variable">$dato</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword keyword-foreach">foreach</span> <span class="token punctuation">(</span><span class="token variable">$dato</span> <span class="token keyword keyword-as">as</span> <span class="token variable">$factor</span> <span class="token operator">=&gt;</span> <span class="token variable">$valor</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token variable">$valor</span> <span class="token operator">!=</span> <span class="token constant">null</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$factor</span> <span class="token operator">!=</span> <span class="token string single-quoted-string">&apos;ts&apos;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                            <span class="token variable">$datosHisto</span><span class="token punctuation">[</span><span class="token variable">$index</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;valor&apos;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">number_format</span><span class="token punctuation">(</span><span class="token variable">$valor</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>
                        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token variable">$factor</span> <span class="token operator">==</span> <span class="token string single-quoted-string">&apos;ts&apos;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                            <span class="token variable">$datosHisto</span><span class="token punctuation">[</span><span class="token variable">$index</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;fecha&apos;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$valor</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
                <span class="token variable">$seriesTag</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;tag&apos;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$datosHisto</span><span class="token punctuation">;</span>
                <span class="token keyword keyword-return">return</span> <span class="token variable">$seriesTag</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword keyword-else">else</span> <span class="token punctuation">{</span>
                <span class="token keyword keyword-return">return</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword keyword-else">else</span> <span class="token punctuation">{</span>
            <span class="token keyword keyword-return">return</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</pre><h3>FUNCI&#xD3;N <strong>historicosTagEstacionCustom()</strong></h3>
<blockquote>
<p><span style="color:green">@params</span> <b>INT</b> id_estacion, <b>INT</b> id_tag, <b>Array</b> ajustesMeta, <b>TS</b> fechaInicio, <b>TS</b> fechaFin</p>
</blockquote>
<blockquote>
<p><span style="color:green">@returns</span> Mixed <b>Array</b> | <b>Bool</b></p>
</blockquote>
<p>Esta fucni&#xF3;n p&#xFA;blica obtiene los datos historicos en agregados 5 minutales de un tag dado su id entre unas fechas dados los TimeStamps con una configuraci&#xF3;n dada en ajustesMeta de una estacion dada su id.<br>
Se usa en gr&#xE1;ficas &gt; vista personalizada.</p>
<pre data-role="codeBlock" data-info="php" class="language-php"><span class="token punctuation">{</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token function">conectar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token variable">$seriesTagCustom</span> <span class="token operator">=</span> <span class="token keyword keyword-array">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token variable">$metaCustom</span> <span class="token operator">=</span> <span class="token keyword keyword-array">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token variable">$meta</span> <span class="token operator">=</span> <span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token function">metaTag</span><span class="token punctuation">(</span><span class="token variable">$id_tag</span><span class="token punctuation">,</span> <span class="token variable">$id_estacion</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-foreach">foreach</span> <span class="token punctuation">(</span><span class="token variable">$ajustesMeta</span> <span class="token keyword keyword-as">as</span> <span class="token variable">$index</span> <span class="token operator">=&gt;</span> <span class="token variable">$tipo</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token variable">$tipo</span> <span class="token operator">==</span> <span class="token string double-quoted-string">&quot;maxGen&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token variable">$metaCustom</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;max&apos;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$meta</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;max&apos;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token variable">$tipo</span> <span class="token operator">==</span> <span class="token string double-quoted-string">&quot;minGen&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token variable">$metaCustom</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;min&apos;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$meta</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;min&apos;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token variable">$tipo</span> <span class="token operator">==</span> <span class="token string double-quoted-string">&quot;avgGen&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token variable">$metaCustom</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;avg&apos;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$meta</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;avg&apos;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            <span class="token variable">$seriesTagCustom</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;meta&apos;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$metaCustom</span><span class="token punctuation">;</span>
            <span class="token variable">$ini</span> <span class="token operator">=</span> <span class="token function">strtotime</span><span class="token punctuation">(</span><span class="token variable">$fechaInicio</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token variable">$fin</span> <span class="token operator">=</span> <span class="token function">strtotime</span><span class="token punctuation">(</span><span class="token variable">$fechaFin</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token variable">$conHistoTagEst</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;WITH t as
            (
             SELECT
                to_timestamp(round((extract(epoch from fecha)) / 10) * 10)::TIMESTAMP AS ts,
                AVG(valor_float) AS dob, AVG(valor_acu) AS acu, AVG(valor_int) AS ent
             FROM datos_historicos
             WHERE id_tag = &quot;</span> <span class="token operator">.</span> <span class="token variable">$id_tag</span> <span class="token operator">.</span> <span class="token string double-quoted-string">&quot; AND cast(extract(epoch from fecha) as integer) &lt; &quot;</span> <span class="token operator">.</span> <span class="token variable">$ini</span> <span class="token operator">.</span> <span class="token string double-quoted-string">&quot; AND cast(extract(epoch from fecha) as integer) &gt; &quot;</span> <span class="token operator">.</span> <span class="token variable">$fin</span> <span class="token operator">.</span> <span class="token string double-quoted-string">&quot;
             GROUP BY ts
            ),
            contiguous_ts_list as
            (
             select ts from generate_series(
              (select min(ts) from t),
              (select max(ts) from t),
              interval &apos;5 minutes&apos;
             ) ts
            )
            select *
            from contiguous_ts_list
            left outer join t using (ts)
            order by ts;&quot;</span><span class="token punctuation">;</span>
            <span class="token variable">$resulHistoTagEst</span> <span class="token operator">=</span> <span class="token function">pg_query</span><span class="token punctuation">(</span><span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token property">conexion</span><span class="token punctuation">,</span> <span class="token variable">$conHistoTagEst</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token function">consultaExitosa</span><span class="token punctuation">(</span><span class="token variable">$resulHistoTagEst</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token variable">$datosHistoTagEst</span> <span class="token operator">=</span> <span class="token function">pg_fetch_all</span><span class="token punctuation">(</span><span class="token variable">$resulHistoTagEst</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token variable">$datosHisto</span> <span class="token operator">=</span> <span class="token keyword keyword-array">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword keyword-foreach">foreach</span> <span class="token punctuation">(</span><span class="token variable">$datosHistoTagEst</span> <span class="token keyword keyword-as">as</span> <span class="token variable">$index</span> <span class="token operator">=&gt;</span> <span class="token variable">$dato</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token variable">$ultVal</span> <span class="token operator">=</span> <span class="token constant">null</span><span class="token punctuation">;</span>
                    <span class="token keyword keyword-foreach">foreach</span> <span class="token punctuation">(</span><span class="token variable">$dato</span> <span class="token keyword keyword-as">as</span> <span class="token variable">$factor</span> <span class="token operator">=&gt;</span> <span class="token variable">$valor</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token variable">$valor</span> <span class="token operator">!=</span> <span class="token constant">null</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$factor</span> <span class="token operator">!=</span> <span class="token string single-quoted-string">&apos;ts&apos;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                            <span class="token variable">$datosHisto</span><span class="token punctuation">[</span><span class="token variable">$index</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;valor&apos;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">number_format</span><span class="token punctuation">(</span><span class="token variable">$valor</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            <span class="token variable">$ultVal</span> <span class="token operator">=</span> <span class="token function">number_format</span><span class="token punctuation">(</span><span class="token variable">$valor</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>
                        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token variable">$valor</span> <span class="token operator">==</span> <span class="token constant">null</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$factor</span> <span class="token operator">!=</span> <span class="token string double-quoted-string">&quot;ts&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                            <span class="token variable">$datosHisto</span><span class="token punctuation">[</span><span class="token variable">$index</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;valor&apos;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$ultVal</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>
                        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token variable">$factor</span> <span class="token operator">==</span> <span class="token string single-quoted-string">&apos;ts&apos;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                            <span class="token variable">$datosHisto</span><span class="token punctuation">[</span><span class="token variable">$index</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;fecha&apos;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$valor</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
                <span class="token variable">$seriesTagCustom</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;tag&apos;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$datosHisto</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword keyword-else">else</span> <span class="token punctuation">{</span>
                <span class="token keyword keyword-return">return</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword keyword-else">else</span> <span class="token punctuation">{</span>
            <span class="token keyword keyword-return">return</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword keyword-return">return</span> <span class="token variable">$seriesTagCustom</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</pre><h3>FUNCI&#xD3;N <strong>reconocerAlarma()</strong></h3>
<blockquote>
<p><span style="color:green">@params</span> <b>INT</b> id_alarma, <b>String</b> usuario, <b>TS</b> hora</p>
</blockquote>
<blockquote>
<p><span style="color:green">@returns</span> <b>Bool</b></p>
</blockquote>
<p>Esta funci&#xF3;n p&#xFA;blica se usa en alarmas y sirve para reconocer una alarma dada su id por un usuario dado su nombre a una hora dada su <b>TS</b>.</p>
<pre data-role="codeBlock" data-info="php" class="language-php"><span class="token keyword keyword-public">public</span> <span class="token keyword keyword-function">function</span> <span class="token function-definition function">reconocerAlarma</span><span class="token punctuation">(</span><span class="token variable">$id_alarma</span><span class="token punctuation">,</span> <span class="token variable">$usuario</span><span class="token punctuation">,</span> <span class="token variable">$hora</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token function">conectar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token variable">$conDatosAlarma</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;SELECT estado FROM alarmas WHERE id_alarmas = <span class="token interpolation"><span class="token variable">$id_alarma</span></span>&quot;</span><span class="token punctuation">;</span>
            <span class="token variable">$resulDatosAlarma</span> <span class="token operator">=</span> <span class="token function">pg_query</span><span class="token punctuation">(</span><span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token property">conexion</span><span class="token punctuation">,</span> <span class="token variable">$conDatosAlarma</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token function">consultaExitosa</span><span class="token punctuation">(</span><span class="token variable">$resulDatosAlarma</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token variable">$datosAlarma</span> <span class="token operator">=</span> <span class="token function">pg_fetch_all</span><span class="token punctuation">(</span><span class="token variable">$resulDatosAlarma</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token variable">$estadoAlarma</span> <span class="token operator">=</span> <span class="token variable">$datosAlarma</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;estado&apos;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
                <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token variable">$estadoAlarma</span> <span class="token operator">==</span> <span class="token string double-quoted-string">&quot;1&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token variable">$nuevoEstado</span> <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token variable">$estadoAlarma</span> <span class="token operator">==</span> <span class="token string double-quoted-string">&quot;2&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token variable">$nuevoEstado</span> <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token variable">$secuencia</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;UPDATE alarmas SET estado = <span class="token interpolation"><span class="token variable">$nuevoEstado</span></span>, ack_por = &apos;<span class="token interpolation"><span class="token variable">$usuario</span></span>&apos;, fecha_ack = &apos;<span class="token interpolation"><span class="token variable">$hora</span></span>&apos; WHERE id_alarmas = <span class="token interpolation"><span class="token variable">$id_alarma</span></span>&quot;</span><span class="token punctuation">;</span>
                <span class="token variable">$resultado</span> <span class="token operator">=</span> <span class="token function">pg_query</span><span class="token punctuation">(</span><span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token property">conexion</span><span class="token punctuation">,</span> <span class="token variable">$secuencia</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token function">consultaExitosa</span><span class="token punctuation">(</span><span class="token variable">$resultado</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword keyword-return">return</span> <span class="token constant boolean">true</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span> <span class="token keyword keyword-else">else</span> <span class="token punctuation">{</span>
                <span class="token keyword keyword-return">return</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword keyword-else">else</span> <span class="token punctuation">{</span>
            <span class="token keyword keyword-return">return</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</pre><h3>FUNCI&#xD3;N <strong>alarmasSur()</strong></h3>
<blockquote>
<p><span style="color:green">@params</span> <b>INT</b> id_usuario</p>
</blockquote>
<blockquote>
<p><span style="color:green">@returns</span> Mixed <b>Array</b> | <b>Bool</b></p>
</blockquote>
<p>Esta funci&#xF3;n p&#xFA;blica se usa en el men&#xFA; sur en las secciones distintas a las de estaci&#xF3;n.<br>
Extrae las ultimas 7 alarmas de las estaciones que pertenezcan a un usuario dado su id.</p>
<pre data-role="codeBlock" data-info="php" class="language-php"><span class="token keyword keyword-public">public</span> <span class="token keyword keyword-function">function</span> <span class="token function-definition function">alarmasSur</span><span class="token punctuation">(</span><span class="token variable">$id_usuario</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token function">conectar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token variable">$conAlarmas</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;SELECT estaciones.nombre_estacion, tags.nombre_tag, alarmas.id_alarmas, alarmas.valor_alarma, alarmas.fecha_origen, alarmas.fecha_restauracion, alarmas.estado, alarmas.ack_por, alarmas.fecha_ack
        FROM alarmas INNER JOIN estacion_tag ON alarmas.id_tag = estacion_tag.id_tag INNER JOIN usuario_estacion ON usuario_estacion.id_estacion = estacion_tag.id_estacion INNER JOIN estaciones ON estaciones.id_estacion = estacion_tag.id_estacion INNER JOIN tags ON alarmas.id_tag = tags.id_tag
        WHERE usuario_estacion.id_usuario = &quot;</span> <span class="token operator">.</span> <span class="token variable">$id_usuario</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;id_usuario&apos;</span><span class="token punctuation">]</span> <span class="token operator">.</span> <span class="token string double-quoted-string">&quot; ORDER BY alarmas.fecha_origen DESC limit 7&quot;</span><span class="token punctuation">;</span>
            <span class="token variable">$resulAlarmas</span> <span class="token operator">=</span> <span class="token function">pg_query</span><span class="token punctuation">(</span><span class="token variable">$conAlarmas</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token function">consultaExitosa</span><span class="token punctuation">(</span><span class="token variable">$resulAlarmas</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token variable">$alarmas</span> <span class="token operator">=</span> <span class="token function">pg_fetch_all</span><span class="token punctuation">(</span><span class="token variable">$resulAlarmas</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword keyword-return">return</span> <span class="token variable">$alarmas</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword keyword-else">else</span> <span class="token punctuation">{</span>
                <span class="token keyword keyword-return">return</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword keyword-else">else</span> <span class="token punctuation">{</span>
            <span class="token keyword keyword-return">return</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</pre><h3>FUNCI&#xD3;N <strong>alarmasEstacionSur()</strong></h3>
<blockquote>
<p><span style="color:green">@params</span> <b>INT</b> id_estacion</p>
</blockquote>
<blockquote>
<p><span style="color:green">@returns</span> Mixed <b>Array</b> | <b>Bool</b></p>
</blockquote>
<p>Esta funci&#xF3;n p&#xFA;blica se usa en el men&#xFA; sur en las secciones de estaci&#xF3;n.<br>
Extrae las ultimas 7 alarmas de las estaciones que pertenezcan a una estaci&#xF3;n dada su id.</p>
<pre data-role="codeBlock" data-info="php" class="language-php"><span class="token keyword keyword-public">public</span> <span class="token keyword keyword-function">function</span> <span class="token function-definition function">alarmasEstacionSur</span><span class="token punctuation">(</span><span class="token variable">$id_estacion</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token function">conectar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token variable">$consulta</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;SELECT estaciones.nombre_estacion, tags.nombre_tag, alarmas.id_alarmas, alarmas.valor_alarma, alarmas.fecha_origen, alarmas.fecha_restauracion, alarmas.estado, alarmas.ack_por, alarmas.fecha_ack
        FROM alarmas INNER JOIN estacion_tag ON alarmas.id_tag = estacion_tag.id_tag INNER JOIN usuario_estacion ON usuario_estacion.id_estacion = estacion_tag.id_estacion INNER JOIN estaciones ON estaciones.id_estacion = estacion_tag.id_estacion INNER JOIN tags ON alarmas.id_tag = tags.id_tag
        WHERE estacion_tag.id_estacion = &apos;<span class="token interpolation"><span class="token variable">$id_estacion</span></span>&apos; ORDER BY alarmas.fecha_origen DESC LIMIT 7&quot;</span><span class="token punctuation">;</span>
            <span class="token variable">$resultado</span> <span class="token operator">=</span> <span class="token function">pg_query</span><span class="token punctuation">(</span><span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token property">conexion</span><span class="token punctuation">,</span> <span class="token variable">$consulta</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token function">consultaExitosa</span><span class="token punctuation">(</span><span class="token variable">$resultado</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token variable">$alarmasEstacion</span> <span class="token operator">=</span> <span class="token function">pg_fetch_all</span><span class="token punctuation">(</span><span class="token variable">$resultado</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword keyword-return">return</span> <span class="token variable">$alarmasEstacion</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword keyword-else">else</span> <span class="token punctuation">{</span>
            <span class="token keyword keyword-return">return</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</pre><h3>FUNCI&#xD3;N <strong>ultimaComunicacionEstacion()</strong></h3>
<blockquote>
<p><span style="color:green">@params</span> <b>INT</b> id_estacion</p>
</blockquote>
<blockquote>
<p><span style="color:green">@returns</span> <b>String</b></p>
</blockquote>
<p>Esta funci&#xF3;n p&#xFA;blica obtiene la fecha de la &#xFA;ltima comunicaci&#xF3;n de una estaci&#xF3;n dada su id.<br>
Se usa en la secci&#xF3;n principal, estaciones y comunicaciones</p>
<pre data-role="codeBlock" data-info="php" class="language-php"><span class="token keyword keyword-public">public</span> <span class="token keyword keyword-function">function</span> <span class="token function-definition function">ultimaComunicacionEstacion</span><span class="token punctuation">(</span><span class="token variable">$id_estacion</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token function">conectar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token variable">$consulta</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;SELECT estaciones.id_estacion, estaciones.nombre_estacion, datos_valores.valor_date, tags.nombre_tag,estaciones.latitud,estaciones.longitud, estaciones.foto  FROM estaciones INNER JOIN estacion_tag ON estaciones.id_estacion = estacion_tag.id_estacion INNER JOIN tags ON tags.id_tag = estacion_tag.id_tag INNER JOIN datos_valores ON estacion_tag.id_tag = datos_valores.id_tag WHERE tags.nombre_tag LIKE &apos;Ultima Comunicacion%&apos; AND estaciones.id_estacion = &quot;</span> <span class="token operator">.</span> <span class="token variable">$id_estacion</span> <span class="token operator">.</span> <span class="token string double-quoted-string">&quot; ORDER BY estaciones.nombre_estacion DESC&quot;</span><span class="token punctuation">;</span>
            <span class="token variable">$resultado</span> <span class="token operator">=</span> <span class="token function">pg_query</span><span class="token punctuation">(</span><span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token property">conexion</span><span class="token punctuation">,</span> <span class="token variable">$consulta</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token function">consultaExitosa</span><span class="token punctuation">(</span><span class="token variable">$resultado</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token variable">$ultimaConexion</span> <span class="token operator">=</span> <span class="token function">pg_fetch_all</span><span class="token punctuation">(</span><span class="token variable">$resultado</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword keyword-return">return</span> <span class="token variable">$ultimaConexion</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword keyword-else">else</span> <span class="token punctuation">{</span>
                <span class="token keyword keyword-return">return</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword keyword-else">else</span> <span class="token punctuation">{</span>
            <span class="token keyword keyword-return">return</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</pre><h3>FUNCI&#xD3;N <strong>calidadTagsEstacion()</strong> --&gt; OBSOLETO</h3>
<blockquote>
<p><span style="color:green">@params</span> <b>INT</b> id_estacion</p>
</blockquote>
<blockquote>
<p><span style="color:green">@returns</span> <b>Array</b></p>
</blockquote>
<p>Esta funci&#xF3;n est&#xE1; obsoleta y ya no se usa.</p>
<h3>FUNCI&#xD3;N <strong>obtenerNombreEstacion()</strong></h3>
<blockquote>
<p><span style="color:green">@params</span> <b>INT</b> id_estacion</p>
</blockquote>
<blockquote>
<p><span style="color:green">@returns</span> Mixed <b>String</b> | <b>Bool</b></p>
</blockquote>
<p>Esta funci&#xF3;n p&#xFA;blica obtiene el nombre de una estaci&#xF3;n dada su id.</p>
<pre data-role="codeBlock" data-info="php" class="language-php"><span class="token keyword keyword-public">public</span> <span class="token keyword keyword-function">function</span> <span class="token function-definition function">obtenerNombreEstacion</span><span class="token punctuation">(</span><span class="token variable">$id_estacion</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token variable">$id_estacion</span> <span class="token operator">==</span> <span class="token global">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;obtenerNombreEstacion_id_estacion&apos;</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword keyword-return">return</span> <span class="token variable">$estacion</span> <span class="token operator">=</span> <span class="token global">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;obtenerNombreEstacion_result&apos;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token function">conectar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token variable">$consulta</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;SELECT nombre_estacion FROM estaciones WHERE id_estacion = &quot;</span> <span class="token operator">.</span> <span class="token variable">$id_estacion</span><span class="token punctuation">;</span>
            <span class="token variable">$resul</span> <span class="token operator">=</span> <span class="token function">pg_query</span><span class="token punctuation">(</span><span class="token variable">$consulta</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token function">consultaExitosa</span><span class="token punctuation">(</span><span class="token variable">$resul</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token variable">$estacion</span> <span class="token operator">=</span> <span class="token function">pg_fetch_all</span><span class="token punctuation">(</span><span class="token variable">$resul</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token global">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;obtenerNombreEstacion_id_estacion&apos;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$id_estacion</span><span class="token punctuation">;</span>
                <span class="token global">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;obtenerNombreEstacion_result&apos;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$estacion</span><span class="token punctuation">;</span>
                <span class="token keyword keyword-return">return</span> <span class="token variable">$estacion</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword keyword-else">else</span> <span class="token punctuation">{</span>
                <span class="token keyword keyword-return">return</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword keyword-else">else</span> <span class="token punctuation">{</span>
            <span class="token keyword keyword-return">return</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</pre><h3>FUNCI&#xD3;N <strong>metaTag()</strong></h3>
<blockquote>
<p><span style="color:green">@params</span> <b>INT</b> id_tag, <b>INT</b> id_estacion</p>
</blockquote>
<blockquote>
<p><span style="color:green">@returns</span> Mixed <b>Array</b> | <b>Bool</b></p>
</blockquote>
<p>Esta funci&#xF3;n p&#xFA;blica obtiene los metadatos calculados de un tag dado su id de una estacion dada su id. Se usa en ambas vistas de gr&#xE1;ficas.</p>
<pre data-role="codeBlock" data-info="php" class="language-php">    <span class="token keyword keyword-public">public</span> <span class="token keyword keyword-function">function</span> <span class="token function-definition function">metaTag</span><span class="token punctuation">(</span><span class="token variable">$id_tag</span><span class="token punctuation">,</span> <span class="token variable">$id_estacion</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token function">conectar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token variable">$metaDatos</span> <span class="token operator">=</span> <span class="token keyword keyword-array">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token variable">$conmaxval</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;SELECT MAX(datos_historicos.valor_int), CAST(MAX(datos_historicos.valor_float)*100 AS &lt;b&gt;INT&lt;/b&gt;), MAX(datos_historicos.valor_acu) FROM datos_historicos INNER JOIN estacion_tag ON estacion_tag.id_tag = datos_historicos.id_tag WHERE datos_historicos.id_tag = &quot;</span> <span class="token operator">.</span> <span class="token variable">$id_tag</span> <span class="token operator">.</span> <span class="token string double-quoted-string">&quot; AND estacion_tag.id_estacion = &quot;</span> <span class="token operator">.</span> <span class="token variable">$id_estacion</span> <span class="token operator">.</span> <span class="token string double-quoted-string">&quot;&quot;</span><span class="token punctuation">;</span>
            <span class="token variable">$conminval</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;SELECT MIN(datos_historicos.valor_int),CAST(MIN(datos_historicos.valor_float)*100 AS &lt;b&gt;INT&lt;/b&gt;), MIN(datos_historicos.valor_acu) FROM datos_historicos INNER JOIN estacion_tag ON estacion_tag.id_tag = datos_historicos.id_tag WHERE datos_historicos.id_tag = &quot;</span> <span class="token operator">.</span> <span class="token variable">$id_tag</span> <span class="token operator">.</span> <span class="token string double-quoted-string">&quot; AND estacion_tag.id_estacion = &quot;</span> <span class="token operator">.</span> <span class="token variable">$id_estacion</span> <span class="token operator">.</span> <span class="token string double-quoted-string">&quot;&quot;</span><span class="token punctuation">;</span>
            <span class="token variable">$conmedia</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;SELECT AVG(datos_historicos.valor_int),CAST(AVG(datos_historicos.valor_float)*100 AS &lt;b&gt;INT&lt;/b&gt;), AVG(datos_historicos.valor_acu) FROM datos_historicos INNER JOIN estacion_tag ON estacion_tag.id_tag = datos_historicos.id_tag WHERE datos_historicos.id_tag = &quot;</span> <span class="token operator">.</span> <span class="token variable">$id_tag</span> <span class="token operator">.</span> <span class="token string double-quoted-string">&quot; AND estacion_tag.id_estacion = &quot;</span> <span class="token operator">.</span> <span class="token variable">$id_estacion</span> <span class="token operator">.</span> <span class="token string double-quoted-string">&quot;&quot;</span><span class="token punctuation">;</span>
            <span class="token variable">$resulmaxval</span> <span class="token operator">=</span> <span class="token function">pg_query</span><span class="token punctuation">(</span><span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token property">conexion</span><span class="token punctuation">,</span> <span class="token variable">$conmaxval</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token variable">$resulminval</span> <span class="token operator">=</span> <span class="token function">pg_query</span><span class="token punctuation">(</span><span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token property">conexion</span><span class="token punctuation">,</span> <span class="token variable">$conminval</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token variable">$resulmedia</span> <span class="token operator">=</span> <span class="token function">pg_query</span><span class="token punctuation">(</span><span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token property">conexion</span><span class="token punctuation">,</span> <span class="token variable">$conmedia</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token function">consultaExitosa</span><span class="token punctuation">(</span><span class="token variable">$resulmaxval</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token variable">$maxval</span> <span class="token operator">=</span> <span class="token function">pg_fetch_all</span><span class="token punctuation">(</span><span class="token variable">$resulmaxval</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword keyword-foreach">foreach</span> <span class="token punctuation">(</span><span class="token variable">$maxval</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token keyword keyword-as">as</span> <span class="token variable">$index</span> <span class="token operator">=&gt;</span> <span class="token variable">$valor</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token variable">$valor</span> <span class="token operator">!=</span> <span class="token constant">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token variable">$index</span> <span class="token operator">=</span> <span class="token string single-quoted-string">&apos;int4&apos;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                            <span class="token variable">$metaDatos</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;max&apos;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$valor</span> <span class="token operator">/</span> <span class="token number">100</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span> <span class="token keyword keyword-else">else</span> <span class="token punctuation">{</span>
                            <span class="token variable">$metaDatos</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;max&apos;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$valor</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token function">consultaExitosa</span><span class="token punctuation">(</span><span class="token variable">$resulminval</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token variable">$minval</span> <span class="token operator">=</span> <span class="token function">pg_fetch_all</span><span class="token punctuation">(</span><span class="token variable">$resulminval</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword keyword-foreach">foreach</span> <span class="token punctuation">(</span><span class="token variable">$minval</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token keyword keyword-as">as</span> <span class="token variable">$index</span> <span class="token operator">=&gt;</span> <span class="token variable">$valor</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token variable">$valor</span> <span class="token operator">!=</span> <span class="token constant">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token variable">$index</span> <span class="token operator">=</span> <span class="token string single-quoted-string">&apos;int4&apos;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                            <span class="token variable">$metaDatos</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;min&apos;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$valor</span> <span class="token operator">/</span> <span class="token number">100</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span> <span class="token keyword keyword-else">else</span> <span class="token punctuation">{</span>
                            <span class="token variable">$metaDatos</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;min&apos;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$valor</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token function">consultaExitosa</span><span class="token punctuation">(</span><span class="token variable">$resulmedia</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token variable">$media</span> <span class="token operator">=</span> <span class="token function">pg_fetch_all</span><span class="token punctuation">(</span><span class="token variable">$resulmedia</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword keyword-foreach">foreach</span> <span class="token punctuation">(</span><span class="token variable">$media</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token keyword keyword-as">as</span> <span class="token variable">$index</span> <span class="token operator">=&gt;</span> <span class="token variable">$valor</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token variable">$valor</span> <span class="token operator">!=</span> <span class="token constant">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token variable">$index</span> <span class="token operator">=</span> <span class="token string single-quoted-string">&apos;int4&apos;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                            <span class="token variable">$metaDatos</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;avg&apos;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$valor</span> <span class="token operator">/</span> <span class="token number">100</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span> <span class="token keyword keyword-else">else</span> <span class="token punctuation">{</span>
                            <span class="token variable">$metaDatos</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;avg&apos;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$valor</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            <span class="token keyword keyword-return">return</span> <span class="token variable">$metaDatos</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword keyword-else">else</span> <span class="token punctuation">{</span>
            <span class="token keyword keyword-return">return</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</pre><h3>FUNCI&#xD3;N <strong>tagTrend()</strong> --&gt; OBSOLETO</h3>
<blockquote>
<p><span style="color:green">@params</span> <b>INT</b> id_tag, <b>INT</b> id_estacion</p>
</blockquote>
<blockquote>
<p><span style="color:green">@returns</span> Mixed <b>Array</b> | <b>Bool</b></p>
</blockquote>
<p>Esta funci&#xF3;n p&#xFA;blica obtiene un trend (7 maximos valores de 7 d&#xED;as) de un tag dado su id de una estacion dada su id.<br>
Esta funci&#xF3;n es obsoleta y ya no se usa por motivos de optimizaci&#xF3;n. En su lugar se usa <strong>tagsTrends()</strong>.</p>
<h3>FUNCI&#xD3;N <strong>tagsTrends()</strong></h3>
<blockquote>
<p><span style="color:green">@params</span> <b>Array</b> datosAnalog</p>
</blockquote>
<blockquote>
<p><span style="color:green">@returns</span> Mixed <b>Array</b> | <b>Bool</b></p>
</blockquote>
<p>Esta fucni&#xF3;n p&#xFA;blica obtiene los trends (7 maximos valores de 7 d&#xED;as) de varios tags dados sus ids de una estacion dada su id. Se usa en las secciones de estaci&#xF3;n.<br>
Sustituye a <strong>tagTrend()</strong>.</p>
<pre data-role="codeBlock" data-info="php" class="language-php"><span class="token keyword keyword-public">public</span> <span class="token keyword keyword-function">function</span> <span class="token function-definition function">tagsTrends</span><span class="token punctuation">(</span><span class="token variable">$datosAnalog</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token variable">$conTrends</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;&quot;</span><span class="token punctuation">;</span>
        <span class="token variable">$conAux</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;&quot;</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token function">conectar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token variable">$conAux</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;(&quot;</span><span class="token punctuation">;</span>
            <span class="token variable">$a</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-foreach">foreach</span> <span class="token punctuation">(</span><span class="token variable">$datosAnalog</span> <span class="token keyword keyword-as">as</span> <span class="token variable">$indexTag</span> <span class="token operator">=&gt;</span> <span class="token variable">$datosTag</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token variable">$indexTag</span> <span class="token operator">!=</span> <span class="token constant">null</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$datosTag</span> <span class="token operator">!=</span> <span class="token constant">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token variable">$tag</span> <span class="token operator">=</span> <span class="token variable">$datosTag</span><span class="token operator">-&gt;</span><span class="token property">id_tag</span><span class="token punctuation">;</span>
                    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token variable">$a</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token variable">$conAux</span> <span class="token operator">.=</span> <span class="token string double-quoted-string">&quot; <span class="token interpolation"><span class="token variable">$tag</span></span> &quot;</span><span class="token punctuation">;</span>
                        <span class="token variable">$a</span><span class="token operator">++</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span> <span class="token keyword keyword-else">else</span> <span class="token punctuation">{</span>
                        <span class="token variable">$conAux</span> <span class="token operator">.=</span> <span class="token string double-quoted-string">&quot; ,<span class="token interpolation"><span class="token variable">$tag</span></span> &quot;</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            <span class="token variable">$conAux</span> <span class="token operator">.=</span> <span class="token string double-quoted-string">&quot;)&quot;</span><span class="token punctuation">;</span>
            <span class="token variable">$conTrends</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;SELECT datos_historicos.id_tag, MAX(datos_historicos.valor_acu) as acu, MAX(datos_historicos.valor_int) as int, MAX(datos_historicos.valor_float) as float, datos_historicos.fecha::date
            from datos_historicos inner join estacion_tag on datos_historicos.id_tag = estacion_tag.id_tag
            where datos_historicos.fecha::date &gt; current_date::date - interval &apos;7 days&apos; AND datos_historicos.id_tag IN <span class="token interpolation"><span class="token variable">$conAux</span></span> GROUP BY datos_historicos.id_tag, datos_historicos.fecha::date&quot;</span><span class="token punctuation">;</span>

            <span class="token variable">$resTrends</span> <span class="token operator">=</span> <span class="token function">pg_query</span><span class="token punctuation">(</span><span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token property">conexion</span><span class="token punctuation">,</span> <span class="token variable">$conTrends</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token function">consultaExitosa</span><span class="token punctuation">(</span><span class="token variable">$resTrends</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token variable">$datosTrendsTags</span> <span class="token operator">=</span> <span class="token function">pg_fetch_all</span><span class="token punctuation">(</span><span class="token variable">$resTrends</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword keyword-return">return</span> <span class="token variable">$datosTrendsTags</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword keyword-return">return</span> <span class="token variable">$conTrends</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword keyword-return">return</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</pre><h3>FUNCI&#xD3;N <strong>informeSe&#xF1;alEstacion()</strong></h3>
<blockquote>
<p><span style="color:green">@params</span> <b>INT</b>, id_estacion, <b>String</b> se&#xF1;al, <b>TS</b> fechaIni, <b>TS</b> fechaFin</p>
</blockquote>
<blockquote>
<p><span style="color:green">@returns</span> <b>Array</b></p>
</blockquote>
<p>Esta funci&#xF3;n p&#xFA;blica obtiene los informes dado su tipo, de los tags de una estacion dado su id comprendido entre unas fechas definidas sus <b>TS</b>.</p>
<pre data-role="codeBlock" data-info="php" class="language-php"><span class="token keyword keyword-public">public</span> <span class="token keyword keyword-function">function</span> informeSe&#xF1;<span class="token function">alEstacion</span><span class="token punctuation">(</span><span class="token variable">$id_estacion</span><span class="token punctuation">,</span> <span class="token variable">$se</span>&#xF1;al<span class="token punctuation">,</span> <span class="token variable">$fechaIni</span><span class="token punctuation">,</span> <span class="token variable">$fechaFin</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token variable">$ini</span> <span class="token operator">=</span> <span class="token function">strtotime</span><span class="token punctuation">(</span><span class="token variable">$fechaIni</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$fin</span> <span class="token operator">=</span> <span class="token function">strtotime</span><span class="token punctuation">(</span><span class="token variable">$fechaFin</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token function">conectar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token variable">$se</span>&#xF1;al <span class="token operator">==</span> <span class="token string single-quoted-string">&apos;cau&apos;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token variable">$tagscaudales</span> <span class="token operator">=</span> <span class="token keyword keyword-array">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token variable">$informeTags</span> <span class="token operator">=</span> <span class="token keyword keyword-array">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token variable">$conTagsCaudales</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;SELECT tags.nombre_tag, tags.id_tag, tags.unidad
                FROM tags INNER JOIN estacion_tag ON tags.id_tag = estacion_tag.id_tag
                WHERE id_estacion = &quot;</span> <span class="token operator">.</span> <span class="token variable">$id_estacion</span> <span class="token operator">.</span> <span class="token string double-quoted-string">&quot; AND tags.nombre_tag LIKE(&apos;Caudal%&apos;)&quot;</span><span class="token punctuation">;</span>
                <span class="token variable">$resTagsCaudales</span> <span class="token operator">=</span> <span class="token function">pg_query</span><span class="token punctuation">(</span><span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token property">conexion</span><span class="token punctuation">,</span> <span class="token variable">$conTagsCaudales</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token function">consultaExitosa</span><span class="token punctuation">(</span><span class="token variable">$resTagsCaudales</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token variable">$tagscaudales</span> <span class="token operator">=</span> <span class="token function">pg_fetch_all</span><span class="token punctuation">(</span><span class="token variable">$resTagsCaudales</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword keyword-foreach">foreach</span> <span class="token punctuation">(</span><span class="token variable">$tagscaudales</span> <span class="token keyword keyword-as">as</span> <span class="token variable">$index</span> <span class="token operator">=&gt;</span> <span class="token variable">$tag</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token variable">$conAgregTag</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;SELECT MAX(datos_historicos.valor_float) as maximo, MIN(datos_historicos.valor_float) as minimo, cast(AVG(datos_historicos.valor_float) as numeric(10,2)) as media, datos_historicos.fecha::date
                        from datos_historicos inner join estacion_tag on datos_historicos.id_tag = estacion_tag.id_tag
                        where datos_historicos.id_tag = &quot;</span> <span class="token operator">.</span> <span class="token variable">$tag</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;id_tag&apos;</span><span class="token punctuation">]</span> <span class="token operator">.</span> <span class="token string double-quoted-string">&quot; and estacion_tag.id_estacion = &quot;</span> <span class="token operator">.</span> <span class="token variable">$id_estacion</span> <span class="token operator">.</span> <span class="token string double-quoted-string">&quot;AND cast(extract(epoch from datos_historicos.fecha) as integer) &lt;= &quot;</span> <span class="token operator">.</span> <span class="token variable">$ini</span> <span class="token operator">.</span> <span class="token string double-quoted-string">&quot; AND cast(extract(epoch from datos_historicos.fecha) as integer) &gt; &quot;</span> <span class="token operator">.</span> <span class="token variable">$fin</span> <span class="token operator">.</span> <span class="token string double-quoted-string">&quot;
                        GROUP BY datos_historicos.fecha::date ORDER BY datos_historicos.fecha::date desc&quot;</span><span class="token punctuation">;</span>
                        <span class="token variable">$resAgregTag</span> <span class="token operator">=</span> <span class="token function">pg_query</span><span class="token punctuation">(</span><span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token property">conexion</span><span class="token punctuation">,</span> <span class="token variable">$conAgregTag</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token function">consultaExitosa</span><span class="token punctuation">(</span><span class="token variable">$resAgregTag</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                            <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token variable">$tag</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;unidad&apos;</span><span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token constant">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                                <span class="token variable">$nombretag</span> <span class="token operator">=</span> <span class="token variable">$tag</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;nombre_tag&apos;</span><span class="token punctuation">]</span> <span class="token operator">.</span> <span class="token string double-quoted-string">&quot; (&quot;</span> <span class="token operator">.</span> <span class="token variable">$tag</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;unidad&apos;</span><span class="token punctuation">]</span> <span class="token operator">.</span> <span class="token string double-quoted-string">&quot;)&quot;</span><span class="token punctuation">;</span>
                                <span class="token variable">$informeTags</span><span class="token punctuation">[</span><span class="token variable">$nombretag</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">pg_fetch_all</span><span class="token punctuation">(</span><span class="token variable">$resAgregTag</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            <span class="token punctuation">}</span> <span class="token keyword keyword-else">else</span> <span class="token punctuation">{</span>
                                <span class="token variable">$informeTags</span><span class="token punctuation">[</span><span class="token variable">$tag</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;nombre_tag&apos;</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">pg_fetch_all</span><span class="token punctuation">(</span><span class="token variable">$resAgregTag</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            <span class="token punctuation">}</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
                <span class="token keyword keyword-return">return</span> <span class="token variable">$informeTags</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token variable">$se</span>&#xF1;al <span class="token operator">==</span> <span class="token string single-quoted-string">&apos;niv&apos;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token variable">$tagscaudales</span> <span class="token operator">=</span> <span class="token keyword keyword-array">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token variable">$informeTags</span> <span class="token operator">=</span> <span class="token keyword keyword-array">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token variable">$conTagsCaudales</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;SELECT tags.nombre_tag, tags.id_tag, tags.unidad
                FROM tags INNER JOIN estacion_tag ON tags.id_tag = estacion_tag.id_tag
                WHERE id_estacion = &quot;</span> <span class="token operator">.</span> <span class="token variable">$id_estacion</span> <span class="token operator">.</span> <span class="token string double-quoted-string">&quot; AND tags.nombre_tag LIKE(&apos;Nivel%&apos;)&quot;</span><span class="token punctuation">;</span>
                <span class="token variable">$resTagsCaudales</span> <span class="token operator">=</span> <span class="token function">pg_query</span><span class="token punctuation">(</span><span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token property">conexion</span><span class="token punctuation">,</span> <span class="token variable">$conTagsCaudales</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token function">consultaExitosa</span><span class="token punctuation">(</span><span class="token variable">$resTagsCaudales</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token variable">$tagscaudales</span> <span class="token operator">=</span> <span class="token function">pg_fetch_all</span><span class="token punctuation">(</span><span class="token variable">$resTagsCaudales</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword keyword-foreach">foreach</span> <span class="token punctuation">(</span><span class="token variable">$tagscaudales</span> <span class="token keyword keyword-as">as</span> <span class="token variable">$index</span> <span class="token operator">=&gt;</span> <span class="token variable">$tag</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token variable">$conAgregTag</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;SELECT MAX(datos_historicos.valor_float) as maximo, MIN(datos_historicos.valor_float) as minimo, cast(AVG(datos_historicos.valor_float) as numeric(10,2)) as media, datos_historicos.fecha::date
                        from datos_historicos inner join estacion_tag on datos_historicos.id_tag = estacion_tag.id_tag
                        where datos_historicos.id_tag = &quot;</span> <span class="token operator">.</span> <span class="token variable">$tag</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;id_tag&apos;</span><span class="token punctuation">]</span> <span class="token operator">.</span> <span class="token string double-quoted-string">&quot; and estacion_tag.id_estacion = &quot;</span> <span class="token operator">.</span> <span class="token variable">$id_estacion</span> <span class="token operator">.</span> <span class="token string double-quoted-string">&quot;AND cast(extract(epoch from datos_historicos.fecha) as integer) &lt;= &quot;</span> <span class="token operator">.</span> <span class="token variable">$ini</span> <span class="token operator">.</span> <span class="token string double-quoted-string">&quot; AND cast(extract(epoch from datos_historicos.fecha) as integer) &gt; &quot;</span> <span class="token operator">.</span> <span class="token variable">$fin</span> <span class="token operator">.</span> <span class="token string double-quoted-string">&quot;
                        GROUP BY datos_historicos.fecha::date ORDER BY datos_historicos.fecha::date desc&quot;</span><span class="token punctuation">;</span>
                        <span class="token variable">$resAgregTag</span> <span class="token operator">=</span> <span class="token function">pg_query</span><span class="token punctuation">(</span><span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token property">conexion</span><span class="token punctuation">,</span> <span class="token variable">$conAgregTag</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token function">consultaExitosa</span><span class="token punctuation">(</span><span class="token variable">$resAgregTag</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                            <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token variable">$tag</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;unidad&apos;</span><span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token constant">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                                <span class="token variable">$nombretag</span> <span class="token operator">=</span> <span class="token variable">$tag</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;nombre_tag&apos;</span><span class="token punctuation">]</span> <span class="token operator">.</span> <span class="token string double-quoted-string">&quot; (&quot;</span> <span class="token operator">.</span> <span class="token variable">$tag</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;unidad&apos;</span><span class="token punctuation">]</span> <span class="token operator">.</span> <span class="token string double-quoted-string">&quot;)&quot;</span><span class="token punctuation">;</span>
                                <span class="token variable">$informeTags</span><span class="token punctuation">[</span><span class="token variable">$nombretag</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">pg_fetch_all</span><span class="token punctuation">(</span><span class="token variable">$resAgregTag</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            <span class="token punctuation">}</span> <span class="token keyword keyword-else">else</span> <span class="token punctuation">{</span>
                                <span class="token variable">$informeTags</span><span class="token punctuation">[</span><span class="token variable">$tag</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;nombre_tag&apos;</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">pg_fetch_all</span><span class="token punctuation">(</span><span class="token variable">$resAgregTag</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            <span class="token punctuation">}</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
                <span class="token keyword keyword-return">return</span> <span class="token variable">$informeTags</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token variable">$se</span>&#xF1;al <span class="token operator">==</span> <span class="token string single-quoted-string">&apos;acu&apos;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token variable">$tagscaudales</span> <span class="token operator">=</span> <span class="token keyword keyword-array">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token variable">$informeTags</span> <span class="token operator">=</span> <span class="token keyword keyword-array">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token variable">$conTagsCaudales</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;SELECT tags.nombre_tag, tags.id_tag, tags.unidad
                FROM tags INNER JOIN estacion_tag ON tags.id_tag = estacion_tag.id_tag
                WHERE id_estacion = &quot;</span> <span class="token operator">.</span> <span class="token variable">$id_estacion</span> <span class="token operator">.</span> <span class="token string double-quoted-string">&quot; AND tags.nombre_tag LIKE(&apos;Acumulado%&apos;) AND tags.nombre_tag LIKE(&apos;%Dia&apos;)&quot;</span><span class="token punctuation">;</span>
                <span class="token variable">$resTagsCaudales</span> <span class="token operator">=</span> <span class="token function">pg_query</span><span class="token punctuation">(</span><span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token property">conexion</span><span class="token punctuation">,</span> <span class="token variable">$conTagsCaudales</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token function">consultaExitosa</span><span class="token punctuation">(</span><span class="token variable">$resTagsCaudales</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token variable">$tagscaudales</span> <span class="token operator">=</span> <span class="token function">pg_fetch_all</span><span class="token punctuation">(</span><span class="token variable">$resTagsCaudales</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword keyword-foreach">foreach</span> <span class="token punctuation">(</span><span class="token variable">$tagscaudales</span> <span class="token keyword keyword-as">as</span> <span class="token variable">$index</span> <span class="token operator">=&gt;</span> <span class="token variable">$tag</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token variable">$conAgregTag</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;SELECT MAX(datos_historicos.valor_acu) as valor, datos_historicos.fecha::date
                        from datos_historicos inner join estacion_tag on datos_historicos.id_tag = estacion_tag.id_tag
                        where datos_historicos.id_tag = &quot;</span> <span class="token operator">.</span> <span class="token variable">$tag</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;id_tag&apos;</span><span class="token punctuation">]</span> <span class="token operator">.</span> <span class="token string double-quoted-string">&quot; and estacion_tag.id_estacion = &quot;</span> <span class="token operator">.</span> <span class="token variable">$id_estacion</span> <span class="token operator">.</span> <span class="token string double-quoted-string">&quot;AND cast(extract(epoch from datos_historicos.fecha) as integer) &lt;= &quot;</span> <span class="token operator">.</span> <span class="token variable">$ini</span> <span class="token operator">.</span> <span class="token string double-quoted-string">&quot; AND cast(extract(epoch from datos_historicos.fecha) as integer) &gt; &quot;</span> <span class="token operator">.</span> <span class="token variable">$fin</span> <span class="token operator">.</span> <span class="token string double-quoted-string">&quot;
                        GROUP BY datos_historicos.fecha::date ORDER BY datos_historicos.fecha::date desc&quot;</span><span class="token punctuation">;</span>
                        <span class="token variable">$resAgregTag</span> <span class="token operator">=</span> <span class="token function">pg_query</span><span class="token punctuation">(</span><span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token property">conexion</span><span class="token punctuation">,</span> <span class="token variable">$conAgregTag</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token function">consultaExitosa</span><span class="token punctuation">(</span><span class="token variable">$resAgregTag</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                            <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token variable">$tag</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;unidad&apos;</span><span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token constant">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                                <span class="token variable">$nombretag</span> <span class="token operator">=</span> <span class="token variable">$tag</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;nombre_tag&apos;</span><span class="token punctuation">]</span> <span class="token operator">.</span> <span class="token string double-quoted-string">&quot; (&quot;</span> <span class="token operator">.</span> <span class="token variable">$tag</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;unidad&apos;</span><span class="token punctuation">]</span> <span class="token operator">.</span> <span class="token string double-quoted-string">&quot;)&quot;</span><span class="token punctuation">;</span>
                                <span class="token variable">$informeTags</span><span class="token punctuation">[</span><span class="token variable">$nombretag</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">pg_fetch_all</span><span class="token punctuation">(</span><span class="token variable">$resAgregTag</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            <span class="token punctuation">}</span> <span class="token keyword keyword-else">else</span> <span class="token punctuation">{</span>
                                <span class="token variable">$informeTags</span><span class="token punctuation">[</span><span class="token variable">$tag</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;nombre_tag&apos;</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">pg_fetch_all</span><span class="token punctuation">(</span><span class="token variable">$resAgregTag</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            <span class="token punctuation">}</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
                <span class="token keyword keyword-return">return</span> <span class="token variable">$informeTags</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token variable">$se</span>&#xF1;al <span class="token operator">==</span> <span class="token string double-quoted-string">&quot;clo&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token variable">$tagscaudales</span> <span class="token operator">=</span> <span class="token keyword keyword-array">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token variable">$informeTags</span> <span class="token operator">=</span> <span class="token keyword keyword-array">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token variable">$conTagsCaudales</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;SELECT tags.nombre_tag, tags.id_tag, tags.unidad
                FROM tags INNER JOIN estacion_tag ON tags.id_tag = estacion_tag.id_tag
                WHERE id_estacion = &quot;</span> <span class="token operator">.</span> <span class="token variable">$id_estacion</span> <span class="token operator">.</span> <span class="token string double-quoted-string">&quot;
                AND tags.nombre_tag LIKE(&apos;Cloro%&apos;)
                OR tags.nombre_tag LIKE(&apos;Turbidez%&apos;)&quot;</span><span class="token punctuation">;</span>
                <span class="token variable">$resTagsCaudales</span> <span class="token operator">=</span> <span class="token function">pg_query</span><span class="token punctuation">(</span><span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token property">conexion</span><span class="token punctuation">,</span> <span class="token variable">$conTagsCaudales</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token function">consultaExitosa</span><span class="token punctuation">(</span><span class="token variable">$resTagsCaudales</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token variable">$tagscaudales</span> <span class="token operator">=</span> <span class="token function">pg_fetch_all</span><span class="token punctuation">(</span><span class="token variable">$resTagsCaudales</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword keyword-foreach">foreach</span> <span class="token punctuation">(</span><span class="token variable">$tagscaudales</span> <span class="token keyword keyword-as">as</span> <span class="token variable">$index</span> <span class="token operator">=&gt;</span> <span class="token variable">$tag</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token variable">$conAgregTag</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;SELECT MAX(datos_historicos.valor_float) as maximo, MIN(datos_historicos.valor_float) as minimo, cast(AVG(datos_historicos.valor_float) as numeric(10,2)) as media, datos_historicos.fecha::date
                        from datos_historicos inner join estacion_tag on datos_historicos.id_tag = estacion_tag.id_tag
                        where datos_historicos.id_tag = &quot;</span> <span class="token operator">.</span> <span class="token variable">$tag</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;id_tag&apos;</span><span class="token punctuation">]</span> <span class="token operator">.</span> <span class="token string double-quoted-string">&quot; and estacion_tag.id_estacion = &quot;</span> <span class="token operator">.</span> <span class="token variable">$id_estacion</span> <span class="token operator">.</span> <span class="token string double-quoted-string">&quot;AND cast(extract(epoch from datos_historicos.fecha) as integer) &lt;= &quot;</span> <span class="token operator">.</span> <span class="token variable">$ini</span> <span class="token operator">.</span> <span class="token string double-quoted-string">&quot; AND cast(extract(epoch from datos_historicos.fecha) as integer) &gt; &quot;</span> <span class="token operator">.</span> <span class="token variable">$fin</span> <span class="token operator">.</span> <span class="token string double-quoted-string">&quot;
                        GROUP BY datos_historicos.fecha::date ORDER BY datos_historicos.fecha::date desc&quot;</span><span class="token punctuation">;</span>
                        <span class="token variable">$resAgregTag</span> <span class="token operator">=</span> <span class="token function">pg_query</span><span class="token punctuation">(</span><span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token property">conexion</span><span class="token punctuation">,</span> <span class="token variable">$conAgregTag</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token function">consultaExitosa</span><span class="token punctuation">(</span><span class="token variable">$resAgregTag</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                            <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token variable">$tag</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;unidad&apos;</span><span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token constant">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                                <span class="token variable">$nombretag</span> <span class="token operator">=</span> <span class="token variable">$tag</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;nombre_tag&apos;</span><span class="token punctuation">]</span> <span class="token operator">.</span> <span class="token string double-quoted-string">&quot; (&quot;</span> <span class="token operator">.</span> <span class="token variable">$tag</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;unidad&apos;</span><span class="token punctuation">]</span> <span class="token operator">.</span> <span class="token string double-quoted-string">&quot;)&quot;</span><span class="token punctuation">;</span>
                                <span class="token variable">$informeTags</span><span class="token punctuation">[</span><span class="token variable">$nombretag</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">pg_fetch_all</span><span class="token punctuation">(</span><span class="token variable">$resAgregTag</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            <span class="token punctuation">}</span> <span class="token keyword keyword-else">else</span> <span class="token punctuation">{</span>
                                <span class="token variable">$informeTags</span><span class="token punctuation">[</span><span class="token variable">$tag</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;nombre_tag&apos;</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">pg_fetch_all</span><span class="token punctuation">(</span><span class="token variable">$resAgregTag</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            <span class="token punctuation">}</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
                <span class="token keyword keyword-return">return</span> <span class="token variable">$informeTags</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</pre><h3>FUNCI&#xD3;N <strong>feedPrincipalDigital()</strong> --&gt; en Desuso</h3>
<blockquote>
<p><span style="color:green">@params</span> <b>Array</b> estaciones</p>
</blockquote>
<blockquote>
<p><span style="color:green">@returns</span> Mixed <b>Array</b> | <b>Bool</b></p>
</blockquote>
<p>Est&#xE1; funci&#xF3;n p&#xFA;blica devolv&#xED;a las 4 alertas de tags digitales mas recientes pertenecientes a un grupo de estaciones dados sus id.<br>
Su utilidad era tan escasa que se elimin&#xF3; el feed digital de la secci&#xF3;n de inicio dejando en desuso esta funci&#xF3;n.</p>
<pre data-role="codeBlock" data-info="php" class="language-php"><span class="token keyword keyword-public">public</span> <span class="token keyword keyword-function">function</span> <span class="token function-definition function">feedPrincipalDigital</span><span class="token punctuation">(</span><span class="token variable">$estaciones</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token global">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;feedPrincipalDigital_estaciones&apos;</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token variable">$estaciones</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword keyword-return">return</span> <span class="token variable">$feed</span> <span class="token operator">=</span> <span class="token global">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;feedPrincipalDigital_result&apos;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token function">conectar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token variable">$feed</span> <span class="token operator">=</span> <span class="token keyword keyword-array">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-foreach">foreach</span> <span class="token punctuation">(</span><span class="token variable">$estaciones</span> <span class="token keyword keyword-as">as</span> <span class="token variable">$index</span> <span class="token operator">=&gt;</span> <span class="token variable">$estacion</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token variable">$id_estacion</span> <span class="token operator">=</span> <span class="token variable">$estacion</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;id_estacion&apos;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
                <span class="token variable">$conTagsDigi</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;SELECT tags.id_tag, tags.nombre_tag
                FROM estacion_tag INNER JOIN tags ON tags.id_tag = estacion_tag.id_tag
                WHERE estacion_tag.id_estacion = <span class="token interpolation"><span class="token variable">$id_estacion</span></span> AND tags.type_tag = 1&quot;</span><span class="token punctuation">;</span>
                <span class="token variable">$resTagsDigi</span> <span class="token operator">=</span> <span class="token function">pg_query</span><span class="token punctuation">(</span><span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token property">conexion</span><span class="token punctuation">,</span> <span class="token variable">$conTagsDigi</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token function">consultaExitosa</span><span class="token punctuation">(</span><span class="token variable">$resTagsDigi</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token variable">$tagsDigiEstacion</span> <span class="token operator">=</span> <span class="token function">pg_fetch_all</span><span class="token punctuation">(</span><span class="token variable">$resTagsDigi</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword keyword-foreach">foreach</span> <span class="token punctuation">(</span><span class="token variable">$tagsDigiEstacion</span> <span class="token keyword keyword-as">as</span> <span class="token variable">$index</span> <span class="token operator">=&gt;</span> <span class="token variable">$tag</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token variable">$id</span> <span class="token operator">=</span> <span class="token variable">$tag</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;id_tag&apos;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
                        <span class="token variable">$conAlarma</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;SELECT fecha_origen, id_tag, valor_alarma
                        FROM alarmas
                        WHERE id_tag = &quot;</span> <span class="token operator">.</span> <span class="token variable">$id</span> <span class="token operator">.</span> <span class="token string double-quoted-string">&quot; AND estado IN(1,3) AND fecha_origen::date &gt; current_date::date - interval &apos;7 days&apos;
                        ORDER BY fecha_origen DESC&quot;</span><span class="token punctuation">;</span>

                        <span class="token variable">$resAlarmas</span> <span class="token operator">=</span> <span class="token function">pg_query</span><span class="token punctuation">(</span><span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token property">conexion</span><span class="token punctuation">,</span> <span class="token variable">$conAlarma</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token function">consultaExitosa</span><span class="token punctuation">(</span><span class="token variable">$resAlarmas</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                            <span class="token variable">$alarmasTagDigi</span> <span class="token operator">=</span> <span class="token function">pg_fetch_all</span><span class="token punctuation">(</span><span class="token variable">$resAlarmas</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            <span class="token variable">$alarmasTagDigi</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;nombre&apos;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$tag</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;nombre_tag&apos;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
                            <span class="token variable">$feed</span><span class="token punctuation">[</span><span class="token variable">$estacion</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;nombre_estacion&apos;</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token variable">$id</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$alarmasTagDigi</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
                            <span class="token global">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;feedPrincipalDigital_estaciones&apos;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$estaciones</span><span class="token punctuation">;</span>
                            <span class="token global">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;feedPrincipalDigital_result&apos;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$feed</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span> <span class="token keyword keyword-else">else</span> <span class="token punctuation">{</span>
                    <span class="token keyword keyword-return">return</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            <span class="token keyword keyword-return">return</span> <span class="token variable">$feed</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword keyword-else">else</span> <span class="token punctuation">{</span>
            <span class="token keyword keyword-return">return</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</pre><h3>FUNCI&#xD3;N <strong>confirmarWidget()</strong></h3>
<blockquote>
<p><span style="color:green">@params</span> <b>String</b> wid, <b>INT</b> tag, <b>INT</b> id_usuario</p>
</blockquote>
<blockquote>
<p><span style="color:green">@returns</span> <b>Bool</b></p>
</blockquote>
<p>Esta funci&#xF3;n p&#xFA;blica pertenece a los ajustes de la secci&#xF3;n principal y establece un feed anal&#xF3;gico para un widget concreto.</p>
<pre data-role="codeBlock" data-info="php" class="language-php"><span class="token keyword keyword-public">public</span> <span class="token keyword keyword-function">function</span> <span class="token function-definition function">confirmarWidget</span><span class="token punctuation">(</span><span class="token variable">$wid</span><span class="token punctuation">,</span> <span class="token variable">$tag</span><span class="token punctuation">,</span> <span class="token variable">$id_usuario</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token variable">$configBD</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;&quot;</span><span class="token punctuation">;</span>
        <span class="token variable">$configuracionWidgetsUsuario</span> <span class="token operator">=</span> <span class="token keyword keyword-array">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token function">conectar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token variable">$configVieja</span> <span class="token operator">=</span> <span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token function">obtenerConfigInicio</span><span class="token punctuation">(</span><span class="token variable">$id_usuario</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token variable">$configVieja</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token variable">$configArr</span> <span class="token operator">=</span> <span class="token function">explode</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;-&quot;</span><span class="token punctuation">,</span> <span class="token variable">$configVieja</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;configuracion_inicio&apos;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword keyword-foreach">foreach</span> <span class="token punctuation">(</span><span class="token variable">$configArr</span> <span class="token keyword keyword-as">as</span> <span class="token variable">$index</span> <span class="token operator">=&gt;</span> <span class="token variable">$configWid</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token variable">$arrConfigWid</span> <span class="token operator">=</span> <span class="token function">explode</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;:&quot;</span><span class="token punctuation">,</span> <span class="token variable">$configWid</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token variable">$configuracionWidgetsUsuario</span><span class="token punctuation">[</span><span class="token variable">$arrConfigWid</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$arrConfigWid</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token variable">$wid</span> <span class="token operator">==</span> <span class="token string single-quoted-string">&apos;w1&apos;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token variable">$configuracionWidgetsUsuario</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;w1&apos;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$tag</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token variable">$wid</span> <span class="token operator">==</span> <span class="token string single-quoted-string">&apos;w2&apos;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token variable">$configuracionWidgetsUsuario</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;w2&apos;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$tag</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token variable">$wid</span> <span class="token operator">==</span> <span class="token string single-quoted-string">&apos;w3&apos;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token variable">$configuracionWidgetsUsuario</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;w3&apos;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$tag</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token variable">$wid</span> <span class="token operator">==</span> <span class="token string single-quoted-string">&apos;w4&apos;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token variable">$configuracionWidgetsUsuario</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;w4&apos;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$tag</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span> <span class="token keyword keyword-else">else</span> <span class="token punctuation">{</span>
                <span class="token variable">$configuracionWidgetsUsuario</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;w1&apos;</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">&apos;&apos;</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">&apos;w2&apos;</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">&apos;&apos;</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">&apos;w3&apos;</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">&apos;&apos;</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">&apos;w4&apos;</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">&apos;&apos;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token variable">$configBD</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;w1:&quot;</span> <span class="token operator">.</span> <span class="token variable">$configuracionWidgetsUsuario</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;w1&apos;</span><span class="token punctuation">]</span> <span class="token operator">.</span> <span class="token string double-quoted-string">&quot;-w2:&quot;</span> <span class="token operator">.</span> <span class="token variable">$configuracionWidgetsUsuario</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;w2&apos;</span><span class="token punctuation">]</span> <span class="token operator">.</span> <span class="token string double-quoted-string">&quot;-w3:&quot;</span> <span class="token operator">.</span> <span class="token variable">$configuracionWidgetsUsuario</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;w3&apos;</span><span class="token punctuation">]</span> <span class="token operator">.</span> <span class="token string double-quoted-string">&quot;-w4:&quot;</span> <span class="token operator">.</span> <span class="token variable">$configuracionWidgetsUsuario</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;w4&apos;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token variable">$secuencia</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;UPDATE usuarios SET configuracion_inicio = &apos;&quot;</span> <span class="token operator">.</span> <span class="token variable">$configBD</span> <span class="token operator">.</span> <span class="token string double-quoted-string">&quot;&apos; WHERE id_usuario = &quot;</span> <span class="token operator">.</span> <span class="token variable">$id_usuario</span><span class="token punctuation">;</span>
            <span class="token variable">$envio</span> <span class="token operator">=</span> <span class="token function">pg_query</span><span class="token punctuation">(</span><span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token property">conexion</span><span class="token punctuation">,</span> <span class="token variable">$secuencia</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token function">consultaExitosa</span><span class="token punctuation">(</span><span class="token variable">$envio</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword keyword-return">return</span> <span class="token constant boolean">true</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword keyword-return">return</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</pre><h3>FUNCI&#xD3;N <strong>feedPrincipalCustom()</strong></h3>
<blockquote>
<p><span style="color:green">@params</span> <b>INT</b> id_usuario</p>
</blockquote>
<blockquote>
<p><span style="color:green">@returns</span> <b>Array</b></p>
</blockquote>
<p>Esta funci&#xF3;n p&#xFA;blica se usa en la secci&#xF3;n principal y extrae los feeds de los tags definidos en la configuracion de un usuario concreto seg&#xFA;n su id.</p>
<pre data-role="codeBlock" data-info="php" class="language-php"> <span class="token keyword keyword-public">public</span> <span class="token keyword keyword-function">function</span> <span class="token function-definition function">feedPrincipalCustom</span><span class="token punctuation">(</span><span class="token variable">$id_usuario</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token variable">$id_usuario</span> <span class="token operator">==</span> <span class="token global">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;feedPrincipalCustom_id_usuario&apos;</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword keyword-return">return</span> <span class="token variable">$infoTag</span> <span class="token operator">=</span> <span class="token global">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;feedPrincipalCustom_result&apos;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token function">conectar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token variable">$configuracionWidgetsUsuario</span> <span class="token operator">=</span> <span class="token keyword keyword-array">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token variable">$config</span> <span class="token operator">=</span> <span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token function">obtenerConfigInicio</span><span class="token punctuation">(</span><span class="token variable">$id_usuario</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token variable">$config</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token variable">$configArr</span> <span class="token operator">=</span> <span class="token function">explode</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;-&quot;</span><span class="token punctuation">,</span> <span class="token variable">$config</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;configuracion_inicio&apos;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword keyword-foreach">foreach</span> <span class="token punctuation">(</span><span class="token variable">$configArr</span> <span class="token keyword keyword-as">as</span> <span class="token variable">$index</span> <span class="token operator">=&gt;</span> <span class="token variable">$configWid</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token variable">$arrConfigWid</span> <span class="token operator">=</span> <span class="token function">explode</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;:&quot;</span><span class="token punctuation">,</span> <span class="token variable">$configWid</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token variable">$configuracionWidgetsUsuario</span><span class="token punctuation">[</span><span class="token variable">$arrConfigWid</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$arrConfigWid</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            <span class="token variable">$ultvalor</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;&quot;</span><span class="token punctuation">;</span>
            <span class="token variable">$trendDia</span> <span class="token operator">=</span> <span class="token keyword keyword-array">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token variable">$agregSemana</span> <span class="token operator">=</span> <span class="token keyword keyword-array">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token variable">$infoTag</span> <span class="token operator">=</span> <span class="token keyword keyword-array">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token variable">$consignas_tag</span> <span class="token operator">=</span> <span class="token keyword keyword-array">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-foreach">foreach</span> <span class="token punctuation">(</span><span class="token variable">$configuracionWidgetsUsuario</span> <span class="token keyword keyword-as">as</span> <span class="token variable">$widget</span> <span class="token operator">=&gt;</span> <span class="token variable">$tag</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token variable">$tag</span> <span class="token operator">=</span> <span class="token function">intval</span><span class="token punctuation">(</span><span class="token variable">$tag</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token variable">$consignas_tag</span> <span class="token operator">=</span> <span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token function">obtenerConsignasTag</span><span class="token punctuation">(</span><span class="token variable">$tag</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token variable">$conUltimoValor</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;SELECT tags.unidad,tags.r_min,tags.r_max,estaciones.nombre_estacion, tags.nombre_tag, datos_valores.valor_acu, datos_valores.valor_float,datos_valores.valor_int,datos_valores.id_tag,datos_valores.fecha
                FROM datos_valores inner join tags on tags.id_tag = datos_valores.id_tag
                inner join estacion_tag on tags.id_tag = estacion_tag.id_tag
                inner join estaciones on estaciones.id_estacion = estacion_tag.id_estacion
                WHERE datos_valores.id_tag=&quot;</span> <span class="token operator">.</span> <span class="token variable">$tag</span><span class="token punctuation">;</span>
                <span class="token variable">$resUltimoValor</span> <span class="token operator">=</span> <span class="token function">pg_query</span><span class="token punctuation">(</span><span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token property">conexion</span><span class="token punctuation">,</span> <span class="token variable">$conUltimoValor</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token function">consultaExitosa</span><span class="token punctuation">(</span><span class="token variable">$resUltimoValor</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token variable">$ultvalor</span> <span class="token operator">=</span> <span class="token function">pg_fetch_all</span><span class="token punctuation">(</span><span class="token variable">$resUltimoValor</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
                    <span class="token variable">$ultValorLimpio</span> <span class="token operator">=</span> <span class="token keyword keyword-array">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword keyword-foreach">foreach</span> <span class="token punctuation">(</span><span class="token variable">$ultvalor</span> <span class="token keyword keyword-as">as</span> <span class="token variable">$factor</span> <span class="token operator">=&gt;</span> <span class="token variable">$valor</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token function">str_contains</span><span class="token punctuation">(</span><span class="token variable">$factor</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">&apos;valor_&apos;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                            <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token variable">$valor</span> <span class="token operator">!=</span> <span class="token constant">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                                <span class="token variable">$ultValorLimpio</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;valor&apos;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$valor</span><span class="token punctuation">;</span>
                            <span class="token punctuation">}</span>
                        <span class="token punctuation">}</span> <span class="token keyword keyword-else">else</span> <span class="token punctuation">{</span>
                            <span class="token variable">$ultValorLimpio</span><span class="token punctuation">[</span><span class="token variable">$factor</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$valor</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span>
                    <span class="token variable">$ultvalor</span> <span class="token operator">=</span> <span class="token variable">$ultValorLimpio</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword keyword-else">else</span> <span class="token punctuation">{</span>
                    <span class="token variable">$ultvalor</span> <span class="token operator">=</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token variable">$conTrendDia</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;&quot;</span><span class="token punctuation">;</span>
                <span class="token variable">$n_tag</span> <span class="token operator">=</span> <span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token function">obtenerNombreTag</span><span class="token punctuation">(</span><span class="token variable">$tag</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token function">strpos</span><span class="token punctuation">(</span><span class="token variable">$n_tag</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">&apos;Acumulado&apos;</span><span class="token punctuation">)</span> <span class="token operator">!==</span> <span class="token constant boolean">false</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token variable">$conTrendDia</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;SELECT datos_historicos.fecha, datos_historicos.valor_acu, datos_historicos.valor_float, valor_int FROM datos_historicos WHERE id_tag=&quot;</span> <span class="token operator">.</span> <span class="token variable">$tag</span> <span class="token operator">.</span> <span class="token string double-quoted-string">&quot; AND datos_historicos.fecha::date &gt;= current_date::date - interval &apos;7 days&apos; AND datos_historicos.fecha::date &lt;= current_date::date ORDER BY fecha desc&quot;</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword keyword-else">else</span> <span class="token punctuation">{</span>
                    <span class="token variable">$conTrendDia</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;WITH t as (SELECT to_timestamp(round((extract(epoch from fecha)) / 10) * 10)::TIMESTAMP AS fecha, AVG(valor_float) as valor_float, AVG(valor_acu) as valor_acu, AVG(valor_int) as valor_int FROM datos_historicos WHERE id_tag = &quot;</span> <span class="token operator">.</span> <span class="token variable">$tag</span> <span class="token operator">.</span> <span class="token string double-quoted-string">&quot; AND datos_historicos.fecha::date &gt;= current_date::date - interval &apos;1 days&apos; AND datos_historicos.fecha::date &lt;= current_date::date GROUP BY fecha),contiguous_ts_list as (select fecha from generate_series((select min(fecha) from t),(select max(fecha) from t),interval &apos;1 hour&apos;) fecha) SELECT * from contiguous_ts_list left outer join t using(fecha) ORDER BY fecha DESC&quot;</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token variable">$resTrendDia</span> <span class="token operator">=</span> <span class="token function">pg_query</span><span class="token punctuation">(</span><span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token property">conexion</span><span class="token punctuation">,</span> <span class="token variable">$conTrendDia</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token function">consultaExitosa</span><span class="token punctuation">(</span><span class="token variable">$resTrendDia</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token variable">$trendDia</span> <span class="token operator">=</span> <span class="token function">pg_fetch_all</span><span class="token punctuation">(</span><span class="token variable">$resTrendDia</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token variable">$trendDiaLimpio</span> <span class="token operator">=</span> <span class="token keyword keyword-array">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token variable">$ultVal</span> <span class="token operator">=</span> <span class="token constant">null</span><span class="token punctuation">;</span>
                    <span class="token keyword keyword-foreach">foreach</span> <span class="token punctuation">(</span><span class="token variable">$trendDia</span> <span class="token keyword keyword-as">as</span> <span class="token variable">$index</span> <span class="token operator">=&gt;</span> <span class="token variable">$dato</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token keyword keyword-foreach">foreach</span> <span class="token punctuation">(</span><span class="token variable">$dato</span> <span class="token keyword keyword-as">as</span> <span class="token variable">$factor</span> <span class="token operator">=&gt;</span> <span class="token variable">$valor</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                            <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token function">str_contains</span><span class="token punctuation">(</span><span class="token variable">$factor</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">&apos;valor_&apos;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                                <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token variable">$valor</span> <span class="token operator">!=</span> <span class="token constant">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                                    <span class="token variable">$trendDiaLimpio</span><span class="token punctuation">[</span><span class="token variable">$index</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;valor&apos;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$valor</span><span class="token punctuation">;</span>
                                    <span class="token variable">$ultVal</span> <span class="token operator">=</span> <span class="token variable">$valor</span><span class="token punctuation">;</span>
                                <span class="token punctuation">}</span> <span class="token keyword keyword-else">else</span> <span class="token punctuation">{</span>
                                    <span class="token variable">$trendDiaLimpio</span><span class="token punctuation">[</span><span class="token variable">$index</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;valor&apos;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$ultVal</span><span class="token punctuation">;</span>
                                <span class="token punctuation">}</span>
                            <span class="token punctuation">}</span> <span class="token keyword keyword-else">else</span> <span class="token punctuation">{</span>
                                <span class="token variable">$trendDiaLimpio</span><span class="token punctuation">[</span><span class="token variable">$index</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token variable">$factor</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$valor</span><span class="token punctuation">;</span>
                            <span class="token punctuation">}</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span>
                    <span class="token variable">$trendDia</span> <span class="token operator">=</span> <span class="token variable">$trendDiaLimpio</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword keyword-else">else</span> <span class="token punctuation">{</span>
                    <span class="token variable">$trendDia</span> <span class="token operator">=</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token variable">$conAgregSemanal</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;&quot;</span><span class="token punctuation">;</span>
                <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token function">strpos</span><span class="token punctuation">(</span><span class="token variable">$n_tag</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">&apos;Acumulado&apos;</span><span class="token punctuation">)</span> <span class="token operator">!==</span> <span class="token constant boolean">false</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token variable">$conAgregSemanal</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;SELECT MAX(datos_historicos.valor_acu) as max_acu, MAX(datos_historicos.valor_int) as max_int, MAX(datos_historicos.valor_float) as max_float,datos_historicos.fecha::date
                    from datos_historicos inner join estacion_tag on datos_historicos.id_tag = estacion_tag.id_tag
                    where datos_historicos.id_tag = &quot;</span> <span class="token operator">.</span> <span class="token variable">$tag</span> <span class="token operator">.</span> <span class="token string double-quoted-string">&quot;
                    and datos_historicos.fecha::date &gt; current_date::date - interval &apos;14 days&apos; AND datos_historicos.fecha::date &lt;= current_date::date GROUP BY datos_historicos.fecha::date LIMIT 14&quot;</span><span class="token punctuation">;</span>
                    <span class="token variable">$resAgregSemanal</span> <span class="token operator">=</span> <span class="token function">pg_query</span><span class="token punctuation">(</span><span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token property">conexion</span><span class="token punctuation">,</span> <span class="token variable">$conAgregSemanal</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token function">consultaExitosa</span><span class="token punctuation">(</span><span class="token variable">$resAgregSemanal</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token variable">$agregSemana</span> <span class="token operator">=</span> <span class="token function">pg_fetch_all</span><span class="token punctuation">(</span><span class="token variable">$resAgregSemanal</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token variable">$agregSemanaLimpio</span> <span class="token operator">=</span> <span class="token keyword keyword-array">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token keyword keyword-foreach">foreach</span> <span class="token punctuation">(</span><span class="token variable">$agregSemana</span> <span class="token keyword keyword-as">as</span> <span class="token variable">$index</span> <span class="token operator">=&gt;</span> <span class="token variable">$dato</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                            <span class="token keyword keyword-foreach">foreach</span> <span class="token punctuation">(</span><span class="token variable">$dato</span> <span class="token keyword keyword-as">as</span> <span class="token variable">$factor</span> <span class="token operator">=&gt;</span> <span class="token variable">$valor</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                                <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token variable">$valor</span> <span class="token operator">!=</span> <span class="token constant">null</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$factor</span> <span class="token operator">!=</span> <span class="token string single-quoted-string">&apos;fecha&apos;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                                    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token function">strpos</span><span class="token punctuation">(</span><span class="token variable">$factor</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">&apos;max&apos;</span><span class="token punctuation">)</span> <span class="token operator">!==</span> <span class="token constant boolean">false</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                                        <span class="token variable">$agregSemanaLimpio</span><span class="token punctuation">[</span><span class="token variable">$index</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;max&apos;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$valor</span><span class="token punctuation">;</span>
                                    <span class="token punctuation">}</span>
                                <span class="token punctuation">}</span> <span class="token keyword keyword-else">else</span> <span class="token punctuation">{</span>
                                    <span class="token variable">$agregSemanaLimpio</span><span class="token punctuation">[</span><span class="token variable">$index</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token variable">$factor</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$valor</span><span class="token punctuation">;</span>
                                <span class="token punctuation">}</span>
                            <span class="token punctuation">}</span>
                        <span class="token punctuation">}</span>
                        <span class="token variable">$agregSemana</span> <span class="token operator">=</span> <span class="token variable">$agregSemanaLimpio</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span> <span class="token keyword keyword-else">else</span> <span class="token punctuation">{</span>
                    <span class="token variable">$conAgregSemanal</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;SELECT MAX(datos_historicos.valor_acu) as max_acu, MAX(datos_historicos.valor_int) as max_int, MAX(datos_historicos.valor_float) as max_float,
                    MIN(datos_historicos.valor_acu) as min_acu, MIN(datos_historicos.valor_int) as min_int, MIN(datos_historicos.valor_float) as min_float,
                    AVG(datos_historicos.valor_acu) as avg_acu, AVG(datos_historicos.valor_int) as avg_int, AVG(datos_historicos.valor_float) as avg_float,datos_historicos.fecha::date
                    from datos_historicos inner join estacion_tag on datos_historicos.id_tag = estacion_tag.id_tag
                    where datos_historicos.id_tag = &quot;</span> <span class="token operator">.</span> <span class="token variable">$tag</span> <span class="token operator">.</span> <span class="token string double-quoted-string">&quot;
                    and datos_historicos.fecha::date &gt; current_date::date - interval &apos;7 days&apos; AND datos_historicos.fecha::date &lt;= current_date::date GROUP BY datos_historicos.fecha::date LIMIT 7&quot;</span><span class="token punctuation">;</span>
                    <span class="token variable">$resAgregSemanal</span> <span class="token operator">=</span> <span class="token function">pg_query</span><span class="token punctuation">(</span><span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token property">conexion</span><span class="token punctuation">,</span> <span class="token variable">$conAgregSemanal</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token function">consultaExitosa</span><span class="token punctuation">(</span><span class="token variable">$resAgregSemanal</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token variable">$agregSemana</span> <span class="token operator">=</span> <span class="token function">pg_fetch_all</span><span class="token punctuation">(</span><span class="token variable">$resAgregSemanal</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token variable">$agregSemanaLimpio</span> <span class="token operator">=</span> <span class="token keyword keyword-array">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token keyword keyword-foreach">foreach</span> <span class="token punctuation">(</span><span class="token variable">$agregSemana</span> <span class="token keyword keyword-as">as</span> <span class="token variable">$index</span> <span class="token operator">=&gt;</span> <span class="token variable">$dato</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                            <span class="token keyword keyword-foreach">foreach</span> <span class="token punctuation">(</span><span class="token variable">$dato</span> <span class="token keyword keyword-as">as</span> <span class="token variable">$factor</span> <span class="token operator">=&gt;</span> <span class="token variable">$valor</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                                <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token variable">$valor</span> <span class="token operator">!=</span> <span class="token constant">null</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$factor</span> <span class="token operator">!=</span> <span class="token string single-quoted-string">&apos;fecha&apos;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                                    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token function">strpos</span><span class="token punctuation">(</span><span class="token variable">$factor</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">&apos;max&apos;</span><span class="token punctuation">)</span> <span class="token operator">!==</span> <span class="token constant boolean">false</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                                        <span class="token variable">$agregSemanaLimpio</span><span class="token punctuation">[</span><span class="token variable">$index</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;max&apos;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$valor</span><span class="token punctuation">;</span>
                                    <span class="token punctuation">}</span>
                                    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token function">strpos</span><span class="token punctuation">(</span><span class="token variable">$factor</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">&apos;min&apos;</span><span class="token punctuation">)</span> <span class="token operator">!==</span> <span class="token constant boolean">false</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                                        <span class="token variable">$agregSemanaLimpio</span><span class="token punctuation">[</span><span class="token variable">$index</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;min&apos;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$valor</span><span class="token punctuation">;</span>
                                    <span class="token punctuation">}</span>
                                    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token function">strpos</span><span class="token punctuation">(</span><span class="token variable">$factor</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">&apos;avg&apos;</span><span class="token punctuation">)</span> <span class="token operator">!==</span> <span class="token constant boolean">false</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                                        <span class="token variable">$agregSemanaLimpio</span><span class="token punctuation">[</span><span class="token variable">$index</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;avg&apos;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$valor</span><span class="token punctuation">;</span>
                                    <span class="token punctuation">}</span>
                                <span class="token punctuation">}</span> <span class="token keyword keyword-else">else</span> <span class="token punctuation">{</span>
                                    <span class="token variable">$agregSemanaLimpio</span><span class="token punctuation">[</span><span class="token variable">$index</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token variable">$factor</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$valor</span><span class="token punctuation">;</span>
                                <span class="token punctuation">}</span>
                            <span class="token punctuation">}</span>
                        <span class="token punctuation">}</span>
                        <span class="token variable">$agregSemana</span> <span class="token operator">=</span> <span class="token variable">$agregSemanaLimpio</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span> <span class="token keyword keyword-else">else</span> <span class="token punctuation">{</span>
                        <span class="token variable">$agregSemana</span> <span class="token operator">=</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
                <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token variable">$consignas_tag</span> <span class="token operator">!=</span> <span class="token constant boolean">false</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token variable">$infoTag</span><span class="token punctuation">[</span><span class="token variable">$widget</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string double-quoted-string">&quot;unidad&quot;</span> <span class="token operator">=&gt;</span> <span class="token variable">$ultvalor</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;unidad&apos;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">&quot;consignas&quot;</span> <span class="token operator">=&gt;</span> <span class="token variable">$consignas_tag</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">&quot;widget&quot;</span> <span class="token operator">=&gt;</span> <span class="token variable">$widget</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">&quot;nombre&quot;</span> <span class="token operator">=&gt;</span> <span class="token variable">$ultvalor</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;nombre_tag&apos;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">&quot;estacion&quot;</span> <span class="token operator">=&gt;</span> <span class="token variable">$ultvalor</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;nombre_estacion&apos;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">&quot;ultimo_valor&quot;</span> <span class="token operator">=&gt;</span> <span class="token variable">$ultvalor</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">&quot;trend_dia&quot;</span> <span class="token operator">=&gt;</span> <span class="token variable">$trendDia</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">&quot;agreg_semana&quot;</span> <span class="token operator">=&gt;</span> <span class="token variable">$agregSemana</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword keyword-else">else</span> <span class="token punctuation">{</span>
                    <span class="token variable">$infoTag</span><span class="token punctuation">[</span><span class="token variable">$widget</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string double-quoted-string">&quot;unidad&quot;</span> <span class="token operator">=&gt;</span> <span class="token variable">$ultvalor</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;unidad&apos;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">&quot;widget&quot;</span> <span class="token operator">=&gt;</span> <span class="token variable">$widget</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">&quot;nombre&quot;</span> <span class="token operator">=&gt;</span> <span class="token variable">$ultvalor</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;nombre_tag&apos;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">&quot;estacion&quot;</span> <span class="token operator">=&gt;</span> <span class="token variable">$ultvalor</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;nombre_estacion&apos;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">&quot;ultimo_valor&quot;</span> <span class="token operator">=&gt;</span> <span class="token variable">$ultvalor</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">&quot;trend_dia&quot;</span> <span class="token operator">=&gt;</span> <span class="token variable">$trendDia</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">&quot;agreg_semana&quot;</span> <span class="token operator">=&gt;</span> <span class="token variable">$agregSemana</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            <span class="token global">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;feedPrincipalCustom_id_usuario&apos;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$id_usuario</span><span class="token punctuation">;</span>
            <span class="token global">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;feedPrincipalCustom_result&apos;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$infoTag</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-return">return</span> <span class="token variable">$infoTag</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</pre><h3>FUNCI&#xD3;N <strong>borrarPreset()</strong></h3>
<blockquote>
<p><span style="color:green">@params</span> <b>String</b> n_preset, <b>INT</b> id_usuario</p>
</blockquote>
<blockquote>
<p><span style="color:green">@returns</span> <b>Bool</b></p>
</blockquote>
<p>Funci&#xF3;n p&#xFA;blica perteneciente a gr&#xE1;ficas &gt; vista personalizada que borra un preset dado su nombre guardado en la config de un usuario dado su id.</p>
<pre data-role="codeBlock" data-info="php" class="language-php"><span class="token keyword keyword-public">public</span> <span class="token keyword keyword-function">function</span> <span class="token function-definition function">borrarPreset</span><span class="token punctuation">(</span><span class="token variable">$n_preset</span><span class="token punctuation">,</span> <span class="token variable">$id_usuario</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token function">conectar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token variable">$sec</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;DELETE FROM graficas WHERE id_usuario = &quot;</span> <span class="token operator">.</span> <span class="token variable">$id_usuario</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;id_usuario&apos;</span><span class="token punctuation">]</span> <span class="token operator">.</span> <span class="token string double-quoted-string">&quot; AND configuracion LIKE(&apos;&quot;</span> <span class="token operator">.</span> <span class="token variable">$n_preset</span> <span class="token operator">.</span> <span class="token string double-quoted-string">&quot;%&apos;)&quot;</span><span class="token punctuation">;</span>
            <span class="token function">pg_query</span><span class="token punctuation">(</span><span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token property">conexion</span><span class="token punctuation">,</span> <span class="token variable">$sec</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-return">return</span> <span class="token constant boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword keyword-else">else</span> <span class="token punctuation">{</span>
            <span class="token keyword keyword-return">return</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</pre><h3>FUNCI&#xD3;N <strong>leerPresets()</strong></h3>
<blockquote>
<p><span style="color:green">@params</span> <b>INT</b> id_usuario</p>
</blockquote>
<blockquote>
<p><span style="color:green">@returns</span> Mixed <b>Array</b> | <b>Bool</b></p>
</blockquote>
<p>Funci&#xF3;n publica perteneciente a la secci&#xF3;n de gr&#xE1;ficas &gt; vista personalizada que busca los presets guardados en la configuraci&#xF3;n de un usuario dado su id.</p>
<pre data-role="codeBlock" data-info="php" class="language-php"><span class="token keyword keyword-public">public</span> <span class="token keyword keyword-function">function</span> <span class="token function-definition function">leerPresets</span><span class="token punctuation">(</span><span class="token variable">$id_usuario</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token function">conectar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token variable">$conPresets</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;SELECT configuracion FROM graficas WHERE id_usuario = &quot;</span> <span class="token operator">.</span> <span class="token variable">$id_usuario</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;id_usuario&apos;</span><span class="token punctuation">]</span> <span class="token operator">.</span> <span class="token string double-quoted-string">&quot;&quot;</span><span class="token punctuation">;</span>
            <span class="token variable">$resPresets</span> <span class="token operator">=</span> <span class="token function">pg_query</span><span class="token punctuation">(</span><span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token property">conexion</span><span class="token punctuation">,</span> <span class="token variable">$conPresets</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token function">consultaExitosa</span><span class="token punctuation">(</span><span class="token variable">$resPresets</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token variable">$presets</span> <span class="token operator">=</span> <span class="token function">pg_fetch_all</span><span class="token punctuation">(</span><span class="token variable">$resPresets</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword keyword-return">return</span> <span class="token variable">$presets</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword keyword-return">return</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</pre><h3>FUNCI&#xD3;N <strong>guardarPreset()</strong></h3>
<blockquote>
<p><span style="color:green">@params</span> <b>String</b> usuario, <b>String</b> nombre, <b>String</b> estacion, <b>Array</b> tags_colores</p>
</blockquote>
<blockquote>
<p><span style="color:green">@returns</span> <b>Bool</b></p>
</blockquote>
<p>Funci&#xF3;n publica perteneciente a la secci&#xF3;n de gr&#xE1;ficas &gt; vista personalizada que guarda un preset seg&#xFA;n su nombre y los tags incluidos con sus colores a un usuario dado su id.</p>
<pre data-role="codeBlock" data-info="php" class="language-php"><span class="token keyword keyword-public">public</span> <span class="token keyword keyword-function">function</span> <span class="token function-definition function">guardarPreset</span><span class="token punctuation">(</span><span class="token variable">$usuario</span><span class="token punctuation">,</span> <span class="token variable">$nombre</span><span class="token punctuation">,</span> <span class="token variable">$estacion</span><span class="token punctuation">,</span> <span class="token variable">$tags_colores</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token variable">$codigo</span> <span class="token operator">=</span> <span class="token variable">$nombre</span> <span class="token operator">.</span> <span class="token string double-quoted-string">&quot;@&quot;</span> <span class="token operator">.</span> <span class="token variable">$estacion</span> <span class="token operator">.</span> <span class="token string double-quoted-string">&quot;?&quot;</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-foreach">foreach</span> <span class="token punctuation">(</span><span class="token variable">$tags_colores</span> <span class="token keyword keyword-as">as</span> <span class="token variable">$tag</span> <span class="token operator">=&gt;</span> <span class="token variable">$color</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token variable">$color</span> <span class="token operator">!=</span> <span class="token constant">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token variable">$codigo</span> <span class="token operator">.=</span> <span class="token string double-quoted-string">&quot;/&quot;</span> <span class="token operator">.</span> <span class="token variable">$tag</span> <span class="token operator">.</span> <span class="token string double-quoted-string">&quot;:&quot;</span> <span class="token operator">.</span> <span class="token variable">$color</span> <span class="token operator">.</span> <span class="token string double-quoted-string">&quot;&quot;</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token variable">$id_usuario</span> <span class="token operator">=</span> <span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token function">obtenerIdUsuario</span><span class="token punctuation">(</span><span class="token variable">$usuario</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token variable">$id_usuario</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token variable">$secu</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;INSERT &lt;b&gt;INT&lt;/b&gt;O graficas(id_usuario, configuracion)
            VALUES (&quot;</span> <span class="token operator">.</span> <span class="token variable">$id_usuario</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;id_usuario&apos;</span><span class="token punctuation">]</span> <span class="token operator">.</span> <span class="token string double-quoted-string">&quot;, &apos;&quot;</span> <span class="token operator">.</span> <span class="token variable">$codigo</span> <span class="token operator">.</span> <span class="token string double-quoted-string">&quot;&apos;)&quot;</span><span class="token punctuation">;</span>
            <span class="token function">pg_query</span><span class="token punctuation">(</span><span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token property">conexion</span><span class="token punctuation">,</span> <span class="token variable">$secu</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-return">return</span> <span class="token constant boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword keyword-return">return</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</pre><hr>
<h2><strong>2.2 CLASE DataWit.php</strong></h2>
<blockquote>
<p>importante: esta clase se apoya en los drivers de SQLServer para <span style="color:purple"><b>PHP</b></span> (sqlsrv) no incluidos en apache.</p>
</blockquote>
<blockquote>
<p>Los contenidos de esta clase son provisionales y est&#xE1;n sujetos a posibles cambios.</p>
</blockquote>
<p>Esta clase contiene las funciones para acceder a las tablas en bases de datos de SQL Server, d&#xF3;nde se encuentran las configuraciones, datos y funciones de las consignas y los plannings de las se&#xF1;ales provenientes de WIT. Al no compartir la arquitectura con <span style="color:darkblue;"><b>Aquando</b></span>_ddbb, tambi&#xE9;n tiene una conexi&#xF3;n auxiliar a otra base de datos con la informaci&#xF3;n necesaria para relacionar la informaci&#xF3;n de <span style="color:darkblue;"><b>Aquando</b></span> con la del entorno WIT.</p>
<p>La clase instancia al principio las variables y constantes necesarias para establecer conexiones al servidor de SQLServer. La funci&#xF3;n de constructor se encuentra vac&#xED;a y la clase no requiere de ning&#xFA;n par&#xE1;metro.</p>
<h3>FUNCI&#xD3;N <strong>conectar()</strong></h3>
<blockquote>
<p><span style="color:green">@params</span> Void</p>
</blockquote>
<blockquote>
<p><span style="color:green">@returns</span> Mixed Sqlstmt | <b>Bool</b></p>
</blockquote>
<p>Funci&#xF3;n privada que conecta con <em>DBEASY452</em>. Se apoya en las constantes de conexi&#xF3;n definidas en la clase. Esta base de datos es la que tiene la informaci&#xF3;n &#xFA;til de las consignas.</p>
<pre data-role="codeBlock" data-info="php" class="language-php"><span class="token keyword keyword-private">private</span> <span class="token keyword keyword-function">function</span> <span class="token function-definition function">conectar</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token property">conexion</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token property">info_server</span> <span class="token operator">=</span> <span class="token keyword keyword-array">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;Database&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;DBEASY452&quot;</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">&quot;Uid&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;sa&quot;</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">&quot;PWD&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;dateando&quot;</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">&quot;Encrypt&quot;</span> <span class="token operator">=&gt;</span> <span class="token constant boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token variable">$stmt</span> <span class="token operator">=</span> <span class="token function">sqlsrv_connect</span><span class="token punctuation">(</span><span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token property">nombre_server</span><span class="token punctuation">,</span> <span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token property">info_server</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token function">consultaExitosa</span><span class="token punctuation">(</span><span class="token variable">$stmt</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword keyword-return">return</span> <span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token property">conexion</span> <span class="token operator">=</span> <span class="token variable">$stmt</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword keyword-else">else</span> <span class="token punctuation">{</span>
                <span class="token keyword keyword-return">return</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword keyword-return">return</span> <span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token property">conexion</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</pre><h3>FUNCI&#xD3;N <strong>conectarAux()</strong></h3>
<blockquote>
<p><span style="color:green">@params</span> Void</p>
</blockquote>
<blockquote>
<p><span style="color:green">@returns</span> Mixed Sqlstmt | <b>Bool</b></p>
</blockquote>
<p>Funci&#xF3;n privada que establece una conexi&#xF3;n auxiliar con <em>Conversion</em><span style="color:darkblue;"><b>Aquando</b></span>_. Est&#xE1; base de datos tiene las relaciones entre el entorno de <span style="color:darkblue;"><b>Aquando</b></span> y el de WIT</p>
<pre data-role="codeBlock" data-info="php" class="language-php"><span class="token keyword keyword-private">private</span> <span class="token keyword keyword-function">function</span> <span class="token function-definition function">conectarAux</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token property">conexionAux</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token property">info_server</span> <span class="token operator">=</span> <span class="token keyword keyword-array">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;Database&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;Conversion_&lt;span style=&apos;color:darkblue;&apos;&gt;&lt;b&gt;Aquando&lt;/b&gt;&lt;/span&gt;&quot;</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">&quot;Uid&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;sa&quot;</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">&quot;PWD&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;dateando&quot;</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">&quot;Encrypt&quot;</span> <span class="token operator">=&gt;</span> <span class="token constant boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token variable">$stmt</span> <span class="token operator">=</span> <span class="token function">sqlsrv_connect</span><span class="token punctuation">(</span><span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token property">nombre_server</span><span class="token punctuation">,</span> <span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token property">info_server</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token function">consultaExitosa</span><span class="token punctuation">(</span><span class="token variable">$stmt</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword keyword-return">return</span> <span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token property">conexionAux</span> <span class="token operator">=</span> <span class="token variable">$stmt</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword keyword-else">else</span> <span class="token punctuation">{</span>
                <span class="token keyword keyword-return">return</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword keyword-return">return</span> <span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token property">conexionAux</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</pre><h3>FUNCI&#xD3;N <strong>consultaExitosa()</strong></h3>
<blockquote>
<p><span style="color:green">@params</span> Sqlstmt</p>
</blockquote>
<blockquote>
<p><span style="color:green">@returns</span> <b>Bool</b></p>
</blockquote>
<p>Funci&#xF3;n privada que comprueba los resultados de una consulta.</p>
<pre data-role="codeBlock" data-info="php" class="language-php"><span class="token keyword keyword-private">private</span> <span class="token keyword keyword-function">function</span> <span class="token function-definition function">consultaExitosa</span><span class="token punctuation">(</span><span class="token variable">$stmt</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token variable">$stmt</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword keyword-return">return</span> <span class="token constant boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword keyword-else">else</span> <span class="token punctuation">{</span>
            <span class="token function">print_r</span><span class="token punctuation">(</span><span class="token function">sqlsrv_errors</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-return">return</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</pre><h3>FUNCI&#xD3;N <strong>consignasEstacion()</strong></h3>
<blockquote>
<p><span style="color:green">@params</span> <b>String</b> estacion</p>
</blockquote>
<blockquote>
<p><span style="color:green">@returns</span> Mixed <b>Array</b> | <b>Bool</b></p>
</blockquote>
<p>Funci&#xF3;n p&#xFA;blica que obtinene las consignas que existen en una estaci&#xF3;n dada su nombre.<br>
Se usa en las secciones de estacion &gt; ajustes</p>
<pre data-role="codeBlock" data-info="php" class="language-php">    <span class="token keyword keyword-public">public</span> <span class="token keyword keyword-function">function</span> <span class="token function-definition function">consignasEstacion</span><span class="token punctuation">(</span><span class="token variable">$estacion</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token function">conectarAux</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$estacion</span> <span class="token operator">!=</span> <span class="token string double-quoted-string">&quot;Deposito Berroa&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token variable">$consulta</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;SELECT * FROM Info_lkv where estacion like(&apos;%&quot;</span> <span class="token operator">.</span> <span class="token variable">$estacion</span> <span class="token operator">.</span> <span class="token string double-quoted-string">&quot;%&apos;) AND nombre_tag like (&apos;%Consigna%&apos;) AND Nombre_variable_wit LIKE(&apos;%Import%&apos;)&quot;</span><span class="token punctuation">;</span>
            <span class="token variable">$respuesta</span> <span class="token operator">=</span> <span class="token function">sqlsrv_query</span><span class="token punctuation">(</span><span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token property">conexionAux</span><span class="token punctuation">,</span> <span class="token variable">$consulta</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token function">consultaExitosa</span><span class="token punctuation">(</span><span class="token variable">$respuesta</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token variable">$datos</span> <span class="token operator">=</span> <span class="token keyword keyword-array">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword keyword-while">while</span> <span class="token punctuation">(</span><span class="token variable">$fila</span> <span class="token operator">=</span> <span class="token function">sqlsrv_fetch_array</span><span class="token punctuation">(</span><span class="token variable">$respuesta</span><span class="token punctuation">,</span> <span class="token constant">SQLSRV_FETCH_ASSOC</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token variable">$datos</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$fila</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token function">sqlsrv_free_stmt</span><span class="token punctuation">(</span><span class="token variable">$respuesta</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword keyword-return">return</span> <span class="token variable">$datos</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword keyword-return">return</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</pre><h3>FUNCI&#xD3;N <strong>leerConsignaWit()</strong></h3>
<blockquote>
<p><span style="color:green">@params</span> <b>String</b> recurso</p>
</blockquote>
<blockquote>
<p><span style="color:green">@returns</span> Mixed <b>Array</b> | <b>Bool</b></p>
</blockquote>
<p>Funci&#xF3;n p&#xFA;blica que obtiene los valores de una consigna determinada dada su identificaci&#xF3;n dentro del entorno WIT.<br>
Se usa en las secciones de estacion &gt; ajustes</p>
<pre data-role="codeBlock" data-info="php" class="language-php">    <span class="token keyword keyword-public">public</span> <span class="token keyword keyword-function">function</span> <span class="token function-definition function">leerConsignaWIT</span><span class="token punctuation">(</span><span class="token variable">$recurso</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token function">conectar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token variable">$consulta</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;SELECT * FROM [DBEASY452].[dbo].[WValue] WHERE ValueWOSAdd LIKE(&apos;%&quot;</span> <span class="token operator">.</span> <span class="token variable">$recurso</span> <span class="token operator">.</span> <span class="token string double-quoted-string">&quot;%&apos;) AND ValueWOSAdd LIKE(&apos;%InLink%&apos;)&quot;</span><span class="token punctuation">;</span>
            <span class="token variable">$respuesta</span> <span class="token operator">=</span> <span class="token function">sqlsrv_query</span><span class="token punctuation">(</span><span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token property">conexion</span><span class="token punctuation">,</span> <span class="token variable">$consulta</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token function">consultaExitosa</span><span class="token punctuation">(</span><span class="token variable">$respuesta</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token variable">$datos</span> <span class="token operator">=</span> <span class="token function">sqlsrv_fetch_array</span><span class="token punctuation">(</span><span class="token variable">$respuesta</span><span class="token punctuation">,</span> <span class="token constant">SQLSRV_FETCH_ASSOC</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token function">sqlsrv_free_stmt</span><span class="token punctuation">(</span><span class="token variable">$respuesta</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword keyword-return">return</span> <span class="token variable">$datos</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword keyword-return">return</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</pre><h3>FUNCI&#xD3;N <strong>modificarConsignaWit()</strong></h3>
<blockquote>
<p><span style="color:green">@params</span> <b>String</b> ref, Float valor</p>
</blockquote>
<blockquote>
<p><span style="color:green">@returns</span> <b>String</b></p>
</blockquote>
<p>Funci&#xF3;n p&#xFA;blica que modifica el valor de una consigna WIT dada su referencia dentro del entorno WIT por un valor dado en los par&#xE1;metros.</p>
<pre data-role="codeBlock" data-info="php" class="language-php">    <span class="token keyword keyword-public">public</span> <span class="token keyword keyword-function">function</span> <span class="token function-definition function">modificarConsignaWit</span><span class="token punctuation">(</span><span class="token variable">$ref</span><span class="token punctuation">,</span> <span class="token variable">$valor</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token function">conectar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token variable">$conConsignas</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;UPDATE [DBEASY452].[dbo].[WValue] SET ValueReadData = &apos;&quot;</span> <span class="token operator">.</span> <span class="token variable">$valor</span> <span class="token operator">.</span> <span class="token string double-quoted-string">&quot;&apos;, ValueWriteStatus = 10 WHERE ValueWOSAdd LIKE(&apos;%&quot;</span> <span class="token operator">.</span> <span class="token variable">$ref</span> <span class="token operator">.</span> <span class="token string double-quoted-string">&quot;InLink%&apos;)&quot;</span><span class="token punctuation">;</span>
            <span class="token variable">$params</span> <span class="token operator">=</span> <span class="token keyword keyword-array">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token variable">$stmt</span> <span class="token operator">=</span> <span class="token function">sqlsrv_query</span><span class="token punctuation">(</span><span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token property">conexion</span><span class="token punctuation">,</span> <span class="token variable">$conConsignas</span><span class="token punctuation">,</span> <span class="token variable">$params</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token function">consultaExitosa</span><span class="token punctuation">(</span><span class="token variable">$stmt</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">sqlsrv_free_stmt</span><span class="token punctuation">(</span><span class="token variable">$stmt</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword keyword-return">return</span> <span class="token string single-quoted-string">&apos;updated&apos;</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword keyword-return">return</span> <span class="token string single-quoted-string">&apos;error&apos;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</pre><h3>FUNCI&#xD3;N <strong>leerPlanningsEstacion()</strong> --&gt; WIP</h3>
<blockquote>
<p><span style="color:green">@params</span> ?</p>
</blockquote>
<blockquote>
<p><span style="color:green">@returns</span> ?</p>
</blockquote>
<p><em>Est&#xE1; funci&#xF3;n aun no est&#xE1; implementada y su c&#xF3;digo no es definitivo.</em><br>
Esta funci&#xF3;n p&#xFA;blica se encarga de listar todos los plannnings existentes de una estaci&#xF3;n determinada.</p>
<pre data-role="codeBlock" data-info="php" class="language-php"><span class="token comment">//C&#xF3;digo no disponible</span>
</pre><h3>FUNCI&#xD3;N <strong>leerValorPlanning()</strong> --&gt; WIP</h3>
<blockquote>
<p><span style="color:green">@params</span> ?</p>
</blockquote>
<blockquote>
<p><span style="color:green">@returns</span> ?</p>
</blockquote>
<p><em>Est&#xE1; funci&#xF3;n aun no est&#xE1; implementada y su c&#xF3;digo no es definitivo.</em><br>
Esta funci&#xF3;n p&#xFA;blica se encarga de leer el valor de un planning dada su referencia.</p>
<pre data-role="codeBlock" data-info="php" class="language-php"><span class="token comment">//C&#xF3;digo no disponible</span>
</pre><h3>FUNCI&#xD3;N <strong>modificarPlanning()</strong> --&gt; WIP</h3>
<blockquote>
<p><span style="color:green">@params</span> ?</p>
</blockquote>
<blockquote>
<p><span style="color:green">@returns</span> ?</p>
</blockquote>
<p><em>Est&#xE1; funci&#xF3;n aun no est&#xE1; implementada y su c&#xF3;digo no es definitivo.</em><br>
Esta funci&#xF3;n p&#xFA;blica se encarga de modificar el valor de un planning determinado por una configuraci&#xF3;n nueva determinada.</p>
<pre data-role="codeBlock" data-info="php" class="language-php"><span class="token comment">//C&#xF3;digo no disponible</span>
</pre><hr>
<h1><strong>3. MODELOS</strong></h1>
<p>Los modelos son clases de <span style="color:purple"><b>PHP</b></span> situadas bajo el directorio <em>App/Models</em> sobre las cuales se apoyan tanto el controlador, como los archivos en Ajax para funcionar. Estas incluyen funciones especiales y conforman los objetos con los que se trabaja en <span style="color:darkblue;"><b>Aquando</b></span>.<br>
Son tres:</p>
<ul>
<li>Contras.php: la clase que trabaja las contrase&#xF1;as y cifrados.</li>
<li>Usuario.php: la clase que trabaja los objetos usuario y las sesiones.</li>
<li>Validador.php: la clase que proteje el back-end de imputs err&#xF3;neos o maliciosos.</li>
</ul>
<h2><strong>3.1 CLASE Contras.php</strong></h2>
<p>Esta clase se encarga de todo lo relacionado con contrase&#xF1;as y cifrados de los usuarios.<br>
Al necesitar hacer peticiones que en ocasiones mandan informaci&#xF3;n comprometida, la aplicaci&#xF3;n se encarga de cifrarla en funci&#xF3;n de unas claves &#xFA;nicas en cada sesi&#xF3;n, para cada usuario que adem&#xE1;s cambian con el tiempo.</p>
<blockquote>
<p>El &#xFA;nico sentido de esta clase es la mantener la seguridad de las contrase&#xF1;as y que en caso de que alguien las robe, no sirvan de nada.</p>
</blockquote>
<p>La clase comienza instanciando las constantes y variables en las que se apoyar&#xE1;n el resto de fucniones. Estas son:</p>
<ul>
<li>HASH</li>
<li>COST</li>
<li>uData</li>
<li>db</li>
<li>hash</li>
</ul>
<p>El constructor tambi&#xE9;n crea un objeto <em>Database</em> y pide un id de usuario sobre el cual empezar a trabajar.</p>
<h3>FUNCI&#xD3;N <strong>save()</strong></h3>
<blockquote>
<p><span style="color:green">@params</span> Void</p>
</blockquote>
<blockquote>
<p><span style="color:green">@returns</span> Void</p>
</blockquote>
<p>Fucnion p&#xFA;blica que se encarga de guardar datos de usuario apoyandose en otras funciones de la clase.</p>
<pre data-role="codeBlock" data-info="php" class="language-php"><span class="token keyword keyword-public">public</span> <span class="token keyword keyword-function">function</span> <span class="token function-definition function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token property">db</span><span class="token operator">-&gt;</span><span class="token function">updateUserData</span><span class="token punctuation">(</span><span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token property">uData</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;id_usuario&apos;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token property">uData</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;id_usuario&apos;</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;password&apos;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</pre><h3>FUNCI&#xD3;N <strong>loginUsuario()</strong></h3>
<blockquote>
<p><span style="color:green">@params</span> <b>String</b> password</p>
</blockquote>
<blockquote>
<p><span style="color:green">@returns</span> <b>Bool</b></p>
</blockquote>
<p>Funci&#xF3;n p&#xFA;blica que se usa en el controlador en la parte de log-in. Compara el hash del usuario definido en las constantes con una contrase&#xF1;a dada en los parametros cifrandola seg&#xFA;n deber&#xED;a.</p>
<pre data-role="codeBlock" data-info="php" class="language-php"> <span class="token keyword keyword-public">public</span> <span class="token keyword keyword-function">function</span> <span class="token function-definition function">loginUsuario</span><span class="token punctuation">(</span><span class="token variable">$password</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token function">password_verify</span><span class="token punctuation">(</span><span class="token variable">$password</span><span class="token punctuation">,</span> <span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token property">uData</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;hash&apos;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token property">hash</span> <span class="token operator">=</span> <span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token property">uData</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;hash&apos;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token function">password_needs_rehash</span><span class="token punctuation">(</span><span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token property">uData</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;hash&apos;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token scope"><span class="token keyword keyword-self">self</span><span class="token punctuation">::</span></span><span class="token constant">HASH</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;cost&apos;</span> <span class="token operator">=&gt;</span> <span class="token scope"><span class="token keyword keyword-self">self</span><span class="token punctuation">::</span></span><span class="token constant">COST</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token function">setPassword</span><span class="token punctuation">(</span><span class="token variable">$password</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword keyword-return">return</span> <span class="token constant boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword keyword-return">return</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</pre><h3>FUNCI&#xD3;N <strong>setPassword()</strong></h3>
<blockquote>
<p><span style="color:green">@params</span> <b>String</b> password</p>
</blockquote>
<blockquote>
<p><span style="color:green">@returns</span> Void</p>
</blockquote>
<p>Funci&#xF3;n p&#xFA;blica que cifra la contrase&#xF1;a en uData seg&#xFA;n los par&#xE1;metros preestablecidos.</p>
<pre data-role="codeBlock" data-info="php" class="language-php"><span class="token keyword keyword-public">public</span> <span class="token keyword keyword-function">function</span> <span class="token function-definition function">setPassword</span><span class="token punctuation">(</span><span class="token variable">$password</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token property">uData</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;hash&apos;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">password_hash</span><span class="token punctuation">(</span><span class="token variable">$password</span><span class="token punctuation">,</span> <span class="token scope"><span class="token keyword keyword-self">self</span><span class="token punctuation">::</span></span><span class="token constant">HASH</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;cost&apos;</span> <span class="token operator">=&gt;</span> <span class="token scope"><span class="token keyword keyword-self">self</span><span class="token punctuation">::</span></span><span class="token constant">COST</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</pre><h3>FUNCI&#xD3;N <strong>hashear()</strong></h3>
<blockquote>
<p><span style="color:green">@params</span> <b>String</b> pwd</p>
</blockquote>
<blockquote>
<p><span style="color:green">@returns</span> <b>String</b></p>
</blockquote>
<p>Funci&#xF3;n p&#xFA;blica que se usa como debug. Devuelve el hash de cualquier texto.</p>
<pre data-role="codeBlock" data-info="php" class="language-php"><span class="token keyword keyword-public">public</span> <span class="token keyword keyword-function">function</span> <span class="token function-definition function">hashear</span><span class="token punctuation">(</span><span class="token variable">$pwd</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword keyword-return">return</span> <span class="token function">password_hash</span><span class="token punctuation">(</span><span class="token variable">$pwd</span><span class="token punctuation">,</span> <span class="token scope"><span class="token keyword keyword-self">self</span><span class="token punctuation">::</span></span><span class="token constant">HASH</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;cost&apos;</span> <span class="token operator">=&gt;</span> <span class="token scope"><span class="token keyword keyword-self">self</span><span class="token punctuation">::</span></span><span class="token constant">COST</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</pre><h3>FUNCI&#xD3;N <strong>getHash()</strong></h3>
<blockquote>
<p><span style="color:green">@params</span> Void</p>
</blockquote>
<blockquote>
<p><span style="color:green">@returns</span> <b>String</b></p>
</blockquote>
<p>Funci&#xF3;n getter est&#xE1;ndar de la propiedad <em>hash</em> de la clase.</p>
<h2><strong>3.2 CLASE Usuario.php</strong></h2>
<p>Esta es la clase que define el objeto usuario usado en el controlador y en los archivos Ajax.<br>
Contiene las distintas acciones que puede hacer un usuario en <span style="color:darkblue;"><b>Aquando</b></span>, aunque no todas.</p>
<blockquote>
<p>depende de Database.php</p>
</blockquote>
<p>La clase al instanciarse importa la clase <em>Database.php</em> y define las propiedades del usuario.<br>
Estas son:</p>
<ul>
<li>nombre</li>
<li>contrasena</li>
<li>cliente (ya no se usa)</li>
<li>estacionesUsuario</li>
<li>DB</li>
</ul>
<p>En su constructor se solicitan por lo menos el nombre y la contrasena para instanciar el objeto <em>Usuario</em>. Tambi&#xE9;n instancia el objeto Database.</p>
<p>--&gt; funciones</p>
<h2><strong>3.3 CLASE Validador.php</strong></h2>
<p>Esta clase se usa cuando hay imputs que tenga que introducir el usuario (generalmente los de texto) y se encarga de que no contengan contenidos perjudiciales para el funcionamiento de la aplicaci&#xF3;n.</p>
<blockquote>
<p>De momento funciona solamente si la llama el controlador pero el objetivo es que funciones tambi&#xE9;n con las de <span style="color:red"><b>AJAX</b></span>.</p>
</blockquote>
<blockquote>
<p>El c&#xF3;digo de esta clase no es definitivo y est&#xE1; sujeto a cambios.</p>
</blockquote>
<blockquote>
<p>Todas las funciones son p&#xFA;blicas</p>
</blockquote>
<p>Esta clase instancia varios diccionarios con elementos que no pueden introducirse en los imputs.<br>
Est&#xE1; el diccionario de texto, el diccionario de n&#xFA;meros, el de car&#xE1;cteres especiales y otro de car&#xE1;cteres especiales menos estricto.</p>
<blockquote>
<p>En el constructor se incluye la funci&#xF3;n <strong>str_tiene()</strong> (viene a ser un <strong>str_contains()</strong> pero que como algunas clases usan esta funci&#xF3;n generaba problemas y tuve que cambiarle el nombre). No requiere de par&#xE1;metros para ser instanciada.</p>
</blockquote>
<h3>FUNCI&#xD3;N <strong>limpiar()</strong></h3>
<blockquote>
<p><span style="color:green">@params</span> <b>String</b> elem</p>
</blockquote>
<blockquote>
<p><span style="color:green">@returns</span> <b>String</b></p>
</blockquote>
<p>Esta funci&#xF3;n elimina los car&#xE1;cteres las habituales.</p>
<pre data-role="codeBlock" data-info="php" class="language-php"><span class="token keyword keyword-public">public</span> <span class="token keyword keyword-function">function</span> <span class="token function-definition function">limpiar</span><span class="token punctuation">(</span><span class="token variable">$elem</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token variable">$elem</span> <span class="token operator">=</span>  <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&apos; &apos;</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">&apos;-&apos;</span><span class="token punctuation">,</span> <span class="token variable">$elem</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-return">return</span> <span class="token function">preg_replace</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&apos;/[^A-Za-z0-9\-]/&apos;</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">&apos;&apos;</span><span class="token punctuation">,</span> <span class="token variable">$elem</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</pre><h3>FUNCI&#xD3;N <strong>valTextoGen()</strong></h3>
<blockquote>
<p><span style="color:green">@params</span> <b>String</b> elem</p>
</blockquote>
<blockquote>
<p><span style="color:green">@returns</span> <b>Bool</b></p>
</blockquote>
<p>Comprueba que el input es un texto gen&#xE9;rico v&#xE1;lido (inluyendo n&#xFA;meros).</p>
<pre data-role="codeBlock" data-info="php" class="language-php">    <span class="token keyword keyword-public">public</span> <span class="token keyword keyword-function">function</span> <span class="token function-definition function">valTextoGen</span><span class="token punctuation">(</span><span class="token variable">$texto</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token variable">$texto</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;&quot;</span> <span class="token operator">.</span> <span class="token variable">$texto</span> <span class="token operator">.</span> <span class="token string double-quoted-string">&quot;&quot;</span><span class="token punctuation">;</span>
        <span class="token variable">$dic</span> <span class="token operator">=</span> <span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token property">diccionarioEspecial</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token variable">$i</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token variable">$i</span> <span class="token operator">&lt;</span> <span class="token function">sizeof</span><span class="token punctuation">(</span><span class="token variable">$dic</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token function">str_tiene</span><span class="token punctuation">(</span><span class="token variable">$texto</span><span class="token punctuation">,</span> <span class="token variable">$dic</span><span class="token punctuation">[</span><span class="token variable">$i</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword keyword-return">return</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword keyword-return">return</span> <span class="token constant boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</pre><h3>FUNCI&#xD3;N <strong>valTextoLimpio()</strong></h3>
<blockquote>
<p><span style="color:green">@params</span> <b>String</b> texto</p>
</blockquote>
<blockquote>
<p><span style="color:green">@returns</span> <b>Bool</b></p>
</blockquote>
<p>Valida que el input es texto estrictamente.</p>
<pre data-role="codeBlock" data-info="php" class="language-php">    <span class="token keyword keyword-public">public</span> <span class="token keyword keyword-function">function</span> <span class="token function-definition function">valTextoLimpio</span><span class="token punctuation">(</span><span class="token variable">$texto</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token variable">$texto</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;&quot;</span> <span class="token operator">.</span> <span class="token variable">$texto</span> <span class="token operator">.</span> <span class="token string double-quoted-string">&quot;&quot;</span><span class="token punctuation">;</span>
        <span class="token variable">$dic</span> <span class="token operator">=</span> <span class="token function">array_merge</span><span class="token punctuation">(</span><span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token property">diccionarioEspecial</span><span class="token punctuation">,</span> <span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token property">diccionarioNum</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token variable">$i</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token variable">$i</span> <span class="token operator">&lt;</span> <span class="token function">sizeof</span><span class="token punctuation">(</span><span class="token variable">$dic</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token function">str_tiene</span><span class="token punctuation">(</span><span class="token variable">$texto</span><span class="token punctuation">,</span> <span class="token variable">$dic</span><span class="token punctuation">[</span><span class="token variable">$i</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword keyword-return">return</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword keyword-return">return</span> <span class="token constant boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</pre><h3>FUNCI&#xD3;N <strong>valNum()</strong></h3>
<blockquote>
<p><span style="color:green">@params</span> <b>String</b> num</p>
</blockquote>
<blockquote>
<p><span style="color:green">@returns</span> <b>Bool</b></p>
</blockquote>
<p>Comprueba que el input se trata de un n&#xFA;mero v&#xE1;lido</p>
<pre data-role="codeBlock" data-info="php" class="language-php"><span class="token keyword keyword-public">public</span> <span class="token keyword keyword-function">function</span> <span class="token function-definition function">valconfig</span><span class="token punctuation">(</span><span class="token variable">$config</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token variable">$config</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;&quot;</span> <span class="token operator">.</span> <span class="token variable">$config</span> <span class="token operator">.</span> <span class="token string double-quoted-string">&quot;&quot;</span><span class="token punctuation">;</span>
        <span class="token variable">$dicExcep</span> <span class="token operator">=</span> <span class="token keyword keyword-array">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;5&quot;</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">&quot;6&quot;</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">&quot;7&quot;</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">&quot;8&quot;</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">&quot;9&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$dic</span> <span class="token operator">=</span> <span class="token function">array_merge</span><span class="token punctuation">(</span><span class="token variable">$dicExcep</span><span class="token punctuation">,</span> <span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token property">diccionarioTexto</span><span class="token punctuation">,</span> <span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token property">diccionarioEspecial</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token variable">$i</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token variable">$i</span> <span class="token operator">&lt;</span> <span class="token function">sizeof</span><span class="token punctuation">(</span><span class="token variable">$dic</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token function">str_tiene</span><span class="token punctuation">(</span><span class="token variable">$config</span><span class="token punctuation">,</span> <span class="token variable">$dic</span><span class="token punctuation">[</span><span class="token variable">$i</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword keyword-return">return</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword keyword-return">return</span> <span class="token constant boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</pre><h3>FUNCI&#xD3;N <strong>valFecha()</strong></h3>
<blockquote>
<p><span style="color:green">@params</span> <b>String</b> fecha</p>
</blockquote>
<blockquote>
<p><span style="color:green">@returns</span> <b>Bool</b></p>
</blockquote>
<p>Comprueba que el input es una fecha v&#xE1;lida.<br>
No se fija en el formato.</p>
<pre data-role="codeBlock" data-info="php" class="language-php"><span class="token keyword keyword-public">public</span> <span class="token keyword keyword-function">function</span> <span class="token function-definition function">valFecha</span><span class="token punctuation">(</span><span class="token variable">$fecha</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token variable">$fecha</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;&quot;</span> <span class="token operator">.</span> <span class="token variable">$fecha</span> <span class="token operator">.</span> <span class="token string double-quoted-string">&quot; &quot;</span><span class="token punctuation">;</span>
        <span class="token variable">$dic</span> <span class="token operator">=</span> <span class="token function">array_merge</span><span class="token punctuation">(</span><span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token property">diccionarioTexto</span><span class="token punctuation">,</span> <span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token property">diccionarioEspecialMin</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token variable">$i</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token variable">$i</span> <span class="token operator">&lt;</span> <span class="token function">sizeof</span><span class="token punctuation">(</span><span class="token variable">$dic</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token function">str_tiene</span><span class="token punctuation">(</span><span class="token variable">$fecha</span><span class="token punctuation">,</span> <span class="token variable">$dic</span><span class="token punctuation">[</span><span class="token variable">$i</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword keyword-return">return</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword keyword-return">return</span> <span class="token constant boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</pre><hr>
<h1><strong>4. Vistas / Secciones</strong></h1>
<p>Las vistas son archivos .php que contienen el c&#xF3;digo html de las secciones. Responden a la informaci&#xF3;n de contexto enviada del controlador. Tambi&#xE9;n suelen incorporar una paque&#xF1;a porci&#xF3;n del <span style="color:gold"><b>JS</b></span> que las acompa&#xF1;a.</p>
<h3>4.1 VISTA inicio.php</h3>
<p>Esta secci&#xF3;n es la principal de la aplicaci&#xF3;n. Inluye todas las dependencias de c&#xF3;digo comunes del resto de secciones.</p>
<p>Contiene el display principal incluyendo los men&#xFA;s de navegaci&#xF3;n, tips de alarma y banners. Es la que se muestra al iniciar la aplicaci&#xF3;n y tambi&#xE9;n es la secci&#xF3;n que se muestra cuando un usuario inicia sesi&#xF3;n lo que significa qie inicio.php es el <strong>display y secci&#xF3;n desconectado.</strong></p>
<blockquote>
<p>En ella aparecen el resto de secciones y la secci&#xF3;n de alarmas sur.</p>
</blockquote>
<blockquote>
<p>Tiene varios archivos <span style="color:gold"><b>JS</b></span> dedicados: ayuda.js, desconectado.js, mlat.js, reloj.js y una vez iniciada sesi&#xF3;n, sur.js</p>
</blockquote>
<blockquote>
<p>Tiene algunos archivos <span style="color:red"><b>AJAX</b></span> dedicados: A_reloj.php, A_Sur.php</p>
</blockquote>
<h3>4.2 VISTA principal.php</h3>
<p>Esta vista nace de inicio.php y crea la secci&#xF3;n principal una vez se inicia sesi&#xF3;n. Tiene dependencias propias &#xFA;nicas y convierte una gran cantidad de informaci&#xF3;n del controlador a <span style="color:gold"><b>JS</b></span>.</p>
<h3>4.3 VISTA inicioSesion.php</h3>
<p>Esta secci&#xF3;n nace de inicio.php es la que tiene el formulario de ingreso de sesi&#xF3;n.</p>
<h3>4.4 VISTA estacion.php</h3>
<p>Esta secci&#xF3;n nace de inicio.php y recibe informaci&#xF3;n de contexto del controlador para mostrar la vista de una estaci&#xF3;n concreta.<br>
Esta vista tiene dependencias propias.<br>
Tambi&#xE9;n declara parte de la informaci&#xF3;n del controlador en Js para poder trabajar con ella.</p>
<blockquote>
<p>Tiene un archivo js dedicado: estaciones.js</p>
</blockquote>
<blockquote>
<p>Tiene varios archivos <span style="color:red"><b>AJAX</b></span> dedicados: A_Estacion.php, A_Ajustes.php</p>
</blockquote>
<h3>4.5 VISTA graficas.php</h3>
<p>Esta vista nace de inicio.php y compone la secci&#xF3;n de vista r&#xE1;pida de las gr&#xE1;ficas.<br>
Esta vista tiene dependencias propias.<br>
Esta vista tambi&#xE9;n convierte informaci&#xF3;n del controlador a <span style="color:gold"><b>JS</b></span> en el codigo que incluye.</p>
<blockquote>
<p>Tiene un archivo js dedicado: graficas.js</p>
</blockquote>
<blockquote>
<p>Tiene un archivo <span style="color:red"><b>AJAX</b></span> dedicado: A_Graficas.php</p>
</blockquote>
<h3>4.6 VISTA graficasCustom.php</h3>
<p>Esta vista nace de incio.php y compone la secci&#xF3;n de vista personalizada dentro de las gr&#xE1;ficas.<br>
Esta vista tiene dependencias propias.<br>
Esta vista tambi&#xE9;n convierte informaci&#xF3;n del controlador a <span style="color:gold"><b>JS</b></span> en el codigo que incluye.</p>
<blockquote>
<p>Tiene un archivo js dedicado: graficasCustom.js</p>
</blockquote>
<blockquote>
<p>Tiene un archivo <span style="color:red"><b>AJAX</b></span> dedicado: A_GraficasCustom.php</p>
</blockquote>
<h3>4.7 VISTA alarmas.php</h3>
<p>Esta vista nace de inicio.php y crea la secci&#xF3;n del explorador de alarmas.<br>
No tiene dependencias especiales.<br>
Requiere de convertir informaci&#xF3;n del controlador a <span style="color:gold"><b>JS</b></span> y tiene su archivo dedicado.</p>
<blockquote>
<p>Tiene un archivo js dedicado: alarmas.js</p>
</blockquote>
<blockquote>
<p>Tiene un archivo <span style="color:red"><b>AJAX</b></span> dedicado: A_Alarmas.php</p>
</blockquote>
<h3>4.8 VISTA informes.php</h3>
<p>Esta vista nace de inicio.php y crea la secci&#xF3;n de generaci&#xF3;n de informes.<br>
No tiene dependencias especiales.<br>
Convierte una escasa cantidad de informaci&#xF3;n del controlador a <span style="color:gold"><b>JS</b></span> pero si que tiene archivos dedicados.</p>
<blockquote>
<p>Tiene un archivo js dedicado: informes.js</p>
</blockquote>
<blockquote>
<p>Tiene un archivo <span style="color:red"><b>AJAX</b></span> dedicado: A_Informes.php</p>
</blockquote>
<h3>4.8 VISTA comunicaciones.php</h3>
<p>Esta vista nace de inicio.php y crea la secci&#xF3;n de comunicaciones.<br>
No tiene apenas dependencias pero si que convierte informaci&#xF3;n del controlador a <span style="color:gold"><b>JS</b></span>.</p>
<blockquote>
<p>Tiene un archivo js dedicado: comunicaciones.js</p>
</blockquote>
<blockquote>
<p>Tiene un archivo <span style="color:red"><b>AJAX</b></span> dedicado: A_Conexiones.php</p>
</blockquote>
<hr>
<h1><strong>5. LADO CLIENTE</strong></h1>
<p>Con lado cliente incluyo todos los archivos en JavaScript y <span style="color:red"><b>AJAX</b></span>. B&#xE1;sicamente todo lo que se ejecuta desde fuera del servidor o dependiendo de las acciones del cliente.</p>
<h2>5.1 JavaScript</h2>
<p>Existen multitud de archivos <span style="color:gold"><b>JS</b></span> que se encargan de controlar todos los eventos nacidos de la interfaz y la interacci&#xF3;n del cliente pero tambi&#xE9;n tienen funciones que comunican con <span style="color:red"><b>AJAX</b></span> para llevar a cabo operaciones con el servidor en tiempo real.</p>
<blockquote>
<p>En este documento solo se resaltan estas funciones de peticiones por <span style="color:red"><b>AJAX</b></span> al ser las verdaderamente importantes.</p>
</blockquote>
<h3>5.1.1 <strong>alarmas.js</strong></h3>
<h4>5.1.1.1 FUNCI&#xD3;N <strong>actualizar()</strong></h4>
<blockquote>
<p><span style="color:green">@params</span> <b>String</b> reorden</p>
</blockquote>
<blockquote>
<p><span style="color:green">@returns</span> <b>HTML</b></p>
</blockquote>
<p>Esta funci&#xF3;n hace una llamada a Servidor (A_Alarmas.php) a trav&#xE9;s de Ajax para actualizar la informaci&#xF3;n en pantalla con la misma configuraci&#xF3;n que estuviese aplicada por el usuario en el momento de que se ejecute.</p>
<p>Petici&#xF3;n:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript">    <span class="token function">$</span><span class="token punctuation">(</span><span class="token dom variable">document</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">ready</span><span class="token punctuation">(</span><span class="token keyword keyword-function">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      $<span class="token punctuation">.</span><span class="token method function property-access">ajax</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        type<span class="token operator">:</span> <span class="token string">&quot;POST&quot;</span><span class="token punctuation">,</span>
        url<span class="token operator">:</span> <span class="token string">&quot;/&lt;span style=&apos;color:darkblue;&apos;&gt;&lt;b&gt;Aquando&lt;/b&gt;&lt;/span&gt;.com/A_Alarmas.php&quot;</span><span class="token punctuation">,</span>
        data<span class="token operator">:</span> <span class="token punctuation">{</span>
          funcion<span class="token operator">:</span> <span class="token string">&quot;actualizar&quot;</span><span class="token punctuation">,</span>
          nombre<span class="token operator">:</span> nombre<span class="token punctuation">,</span>
          emp<span class="token operator">:</span> emp<span class="token punctuation">,</span>
          sentido<span class="token operator">:</span> sentido<span class="token punctuation">,</span>
          orden<span class="token operator">:</span> orden<span class="token punctuation">,</span>
          fechaInicio<span class="token operator">:</span> fechaInicio<span class="token punctuation">,</span>
          fechaFin<span class="token operator">:</span> fechaFin<span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token keyword keyword-function">function</span> <span class="token punctuation">(</span><span class="token parameter">alarmas</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;tablaAlarmas&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access">inner</span><span class="token operator">&lt;</span>b<span class="token operator">&gt;</span><span class="token constant">HTML</span><span class="token operator">&lt;</span><span class="token operator">/</span>b<span class="token operator">&gt;</span> <span class="token operator">=</span> alarmas<span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token function-variable function">error</span><span class="token operator">:</span> <span class="token keyword keyword-function">function</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">&quot;error&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><h4>5.1.1.2 FUNCI&#xD3;N <strong>filtrarPorEstacion()</strong></h4>
<blockquote>
<p><span style="color:green">@params</span> Void</p>
</blockquote>
<blockquote>
<p><span style="color:green">@returns</span> <b>HTML</b></p>
</blockquote>
<p>Esta funci&#xF3;n hace una llamada a Servidor (A_Alarmas.php) a trav&#xE9;s de Ajax para extraer s&#xF3;lo las alarmas de una estaci&#xF3;n en particular.</p>
<p>Petici&#xF3;n:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript">    <span class="token function">$</span><span class="token punctuation">(</span><span class="token dom variable">document</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">ready</span><span class="token punctuation">(</span><span class="token keyword keyword-function">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      $<span class="token punctuation">.</span><span class="token method function property-access">ajax</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        type<span class="token operator">:</span> <span class="token string">&quot;POST&quot;</span><span class="token punctuation">,</span>
        url<span class="token operator">:</span> <span class="token string">&quot;/&lt;span style=&apos;color:darkblue;&apos;&gt;&lt;b&gt;Aquando&lt;/b&gt;&lt;/span&gt;.com/A_Alarmas.php&quot;</span><span class="token punctuation">,</span>
        data<span class="token operator">:</span> <span class="token punctuation">{</span>
          funcion<span class="token operator">:</span> <span class="token string">&quot;estacion&quot;</span><span class="token punctuation">,</span>
          sentido<span class="token operator">:</span> sentido<span class="token punctuation">,</span>
          orden<span class="token operator">:</span> orden<span class="token punctuation">,</span>
          estacion<span class="token operator">:</span> id_estacion<span class="token punctuation">,</span>
          fechaInicio<span class="token operator">:</span> fechaInicio<span class="token punctuation">,</span>
          fechaFin<span class="token operator">:</span> fechaFin<span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token keyword keyword-function">function</span> <span class="token punctuation">(</span><span class="token parameter">alarmas</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;tablaAlarmas&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access">inner</span><span class="token operator">&lt;</span>b<span class="token operator">&gt;</span><span class="token constant">HTML</span><span class="token operator">&lt;</span><span class="token operator">/</span>b<span class="token operator">&gt;</span> <span class="token operator">=</span> alarmas<span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token function-variable function">error</span><span class="token operator">:</span> <span class="token keyword keyword-function">function</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">&quot;error&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><h4>5.1.1.3 FUNCI&#xD3;N <strong>reconocer()</strong></h4>
<blockquote>
<p><span style="color:green">@params</span> <b>INT</b> id_alarma</p>
</blockquote>
<blockquote>
<p><span style="color:green">@returns</span> Void</p>
</blockquote>
<p>Esta funci&#xF3;n hace una llamada a Servidor (A_Alarmas.php) a trav&#xE9;s de Ajax para reconocerla a la fecha actual con el usuario que est&#xE9; logueado en ese momento.</p>
<p>Petici&#xF3;n:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token function">$</span><span class="token punctuation">(</span><span class="token dom variable">document</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">ready</span><span class="token punctuation">(</span><span class="token keyword keyword-function">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  $<span class="token punctuation">.</span><span class="token method function property-access">ajax</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    type<span class="token operator">:</span> <span class="token string">&quot;POST&quot;</span><span class="token punctuation">,</span>
    url<span class="token operator">:</span> <span class="token string">&quot;/&lt;span style=&apos;color:darkblue;&apos;&gt;&lt;b&gt;Aquando&lt;/b&gt;&lt;/span&gt;.com/A_Alarmas.php&quot;</span><span class="token punctuation">,</span>
    data<span class="token operator">:</span> <span class="token punctuation">{</span>
      funcion<span class="token operator">:</span> <span class="token string">&quot;reconocer&quot;</span><span class="token punctuation">,</span>
      alarma<span class="token operator">:</span> id_alarma<span class="token punctuation">,</span>
      nombre<span class="token operator">:</span> <span class="token dom variable">sessionStorage</span><span class="token punctuation">.</span><span class="token method function property-access">getItem</span><span class="token punctuation">(</span><span class="token string">&quot;nousu&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token keyword keyword-function">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">actualizar</span><span class="token punctuation">(</span><span class="token keyword null nil keyword-null">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function-variable function">error</span><span class="token operator">:</span> <span class="token keyword keyword-function">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">&quot;error en la update&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><h4>5.1.1.4 FUNCI&#xD3;N <strong>detallesAlarma()</strong></h4>
<blockquote>
<p><span style="color:green">@params</span> <b>INT</b> id</p>
</blockquote>
<blockquote>
<p><span style="color:green">@returns</span> <span style="color:gold"><b>JS</b></span>ON</p>
</blockquote>
<p>Esta funci&#xF3;n hace una llamada a Servidor (A_Alarmas.php) a trav&#xE9;s de Ajax para extraer los datos historicos de 12h en adelante y atr&#xE1;s de una se&#xF1;al perteneciente a una alarma.</p>
<p>Petici&#xF3;n:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token function">$</span><span class="token punctuation">(</span><span class="token dom variable">document</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">ready</span><span class="token punctuation">(</span><span class="token keyword keyword-function">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  $<span class="token punctuation">.</span><span class="token method function property-access">ajax</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    type<span class="token operator">:</span> <span class="token string">&quot;POST&quot;</span><span class="token punctuation">,</span>
    url<span class="token operator">:</span> <span class="token string">&quot;/&lt;span style=&apos;color:darkblue;&apos;&gt;&lt;b&gt;Aquando&lt;/b&gt;&lt;/span&gt;.com/A_Alarmas.php&quot;</span><span class="token punctuation">,</span>
    data<span class="token operator">:</span> <span class="token punctuation">{</span> funcion<span class="token operator">:</span> <span class="token string">&quot;detalles&quot;</span><span class="token punctuation">,</span> id<span class="token operator">:</span> id <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token keyword keyword-function">function</span> <span class="token punctuation">(</span><span class="token parameter">det</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword keyword-var">var</span> nombre_estacion <span class="token operator">=</span> det<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">&quot;nombre_estacion&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token keyword keyword-var">var</span> nombre_tag <span class="token operator">=</span> det<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">&quot;nombre_tag&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token keyword keyword-var">var</span> fechas <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token keyword keyword-var">var</span> vals <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token keyword control-flow keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-var">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> det<span class="token punctuation">.</span><span class="token property-access">length</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword control-flow keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-var">var</span> cosa <span class="token keyword keyword-in">in</span> det<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword control-flow keyword-if">if</span> <span class="token punctuation">(</span>cosa <span class="token operator">==</span> <span class="token string">&quot;fecha&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            fechas<span class="token punctuation">.</span><span class="token method function property-access">push</span><span class="token punctuation">(</span>det<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>cosa<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span> <span class="token keyword control-flow keyword-else">else</span> <span class="token punctuation">{</span>
            <span class="token keyword control-flow keyword-if">if</span> <span class="token punctuation">(</span>
              det<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>cosa<span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token keyword null nil keyword-null">null</span> <span class="token operator">&amp;&amp;</span>
              cosa <span class="token operator">!=</span> <span class="token string">&quot;nombre_estacion&quot;</span> <span class="token operator">&amp;&amp;</span>
              cosa <span class="token operator">!=</span> <span class="token string">&quot;nombre_tag&quot;</span>
            <span class="token punctuation">)</span> <span class="token punctuation">{</span>
              vals<span class="token punctuation">.</span><span class="token method function property-access">push</span><span class="token punctuation">(</span>det<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>cosa<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
      <span class="token keyword keyword-var">var</span> det_p <span class="token operator">=</span> <span class="token punctuation">[</span>fechas<span class="token punctuation">,</span> vals<span class="token punctuation">,</span> nombre_estacion<span class="token punctuation">,</span> nombre_tag<span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token function">popDetalles</span><span class="token punctuation">(</span>det_p<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function-variable function">error</span><span class="token operator">:</span> <span class="token keyword keyword-function">function</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">&quot;error en los detalles&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    dataType<span class="token operator">:</span> <span class="token string">&quot;json&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><h2>5.1.2 <strong>comunicaciones.js</strong></h2>
<h4>5.1.2.1 FUNCI&#xD3;N <strong>actualizarConexiones()</strong></h4>
<blockquote>
<p><span style="color:green">@params</span> Void</p>
</blockquote>
<blockquote>
<p><span style="color:green">@returns</span> <b>HTML</b></p>
</blockquote>
<p>Esta funci&#xF3;n hace una petici&#xF3;n a servidor por Ajax a trav&#xE9;s de A_Conexiones.php para actualizar la informaci&#xF3;n en pantalla de la secci&#xF3;n Comunicaciones</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript">  <span class="token function">$</span><span class="token punctuation">(</span><span class="token dom variable">document</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">ready</span><span class="token punctuation">(</span><span class="token keyword keyword-function">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    $<span class="token punctuation">.</span><span class="token method function property-access">ajax</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      type<span class="token operator">:</span> <span class="token string">&quot;POST&quot;</span><span class="token punctuation">,</span>
      url<span class="token operator">:</span> <span class="token string">&quot;/&lt;span style=&apos;color:darkblue;&apos;&gt;&lt;b&gt;Aquando&lt;/b&gt;&lt;/span&gt;.com/A_Conexiones.php&quot;</span><span class="token punctuation">,</span>
      data<span class="token operator">:</span> <span class="token punctuation">{</span>
        nombre<span class="token operator">:</span> nombre<span class="token punctuation">,</span>
        pwd<span class="token operator">:</span> pwd<span class="token punctuation">,</span>
        opcion<span class="token operator">:</span> <span class="token string">&quot;conex&quot;</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token keyword keyword-function">function</span> <span class="token punctuation">(</span><span class="token parameter">conex</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;tablaConex&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access">inner</span><span class="token operator">&lt;</span>b<span class="token operator">&gt;</span><span class="token constant">HTML</span><span class="token operator">&lt;</span><span class="token operator">/</span>b<span class="token operator">&gt;</span> <span class="token operator">=</span> conex<span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token function-variable function">error</span><span class="token operator">:</span> <span class="token keyword keyword-function">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">&quot;error&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><h4>5.1.2.2 FUNCI&#xD3;N <strong>nombrarEstacion()</strong></h4>
<blockquote>
<p><span style="color:green">@params</span> <b>INT</b> estacion</p>
</blockquote>
<blockquote>
<p><span style="color:green">@returns</span> <b>HTML</b></p>
</blockquote>
<p>Esta funci&#xF3;n hace una petici&#xF3;n a servidor por Ajax a trav&#xE9;s de A_Conexiones.php para extraer el nombre de una estaci&#xF3;n dado solo su id.</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript">  <span class="token function">$</span><span class="token punctuation">(</span><span class="token dom variable">document</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">ready</span><span class="token punctuation">(</span><span class="token keyword keyword-function">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    $<span class="token punctuation">.</span><span class="token method function property-access">ajax</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      type<span class="token operator">:</span> <span class="token string">&quot;POST&quot;</span><span class="token punctuation">,</span>
      url<span class="token operator">:</span> <span class="token string">&quot;/&lt;span style=&apos;color:darkblue;&apos;&gt;&lt;b&gt;Aquando&lt;/b&gt;&lt;/span&gt;.com/A_Conexiones.php&quot;</span><span class="token punctuation">,</span>
      data<span class="token operator">:</span> <span class="token punctuation">{</span>
        estacion<span class="token operator">:</span> estacion<span class="token punctuation">,</span>
        opcion<span class="token operator">:</span> <span class="token string">&quot;nom&quot;</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token keyword keyword-function">function</span> <span class="token punctuation">(</span><span class="token parameter">est</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;calidadSenales&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access">inner</span><span class="token operator">&lt;</span>b<span class="token operator">&gt;</span><span class="token constant">HTML</span><span class="token operator">&lt;</span><span class="token operator">/</span>b<span class="token operator">&gt;</span> <span class="token operator">=</span>
          <span class="token string">&apos;&lt;h4 id=&quot;calidadSenales&quot;&gt; Calidad de se&#xF1;al: &apos;</span> <span class="token operator">+</span> est <span class="token operator">+</span> <span class="token string">&quot;&lt;/h4&gt;&quot;</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token function-variable function">error</span><span class="token operator">:</span> <span class="token keyword keyword-function">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">&quot;error&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><h2>5.1.3 <strong>estaciones.js</strong></h2>
<h4>5.1.3.1 FUNCI&#xD3;N <strong>actualizar()</strong></h4>
<blockquote>
<p><span style="color:green">@params</span> <b>INT</b> id_estacion</p>
</blockquote>
<blockquote>
<p><span style="color:green">@returns</span> <span style="color:gold"><b>JS</b></span>ON</p>
</blockquote>
<p>Esta funci&#xF3;n hace una petici&#xF3;n a servidor por Ajax a trav&#xE9;s de A_Estacion.php y extrae toda la informaci&#xF3;n necesaria para actualizar los widgets de la secci&#xF3;n.</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript">    <span class="token function">$</span><span class="token punctuation">(</span><span class="token dom variable">document</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">ready</span><span class="token punctuation">(</span><span class="token keyword keyword-function">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      $<span class="token punctuation">.</span><span class="token method function property-access">ajax</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        type<span class="token operator">:</span> <span class="token string">&quot;POST&quot;</span><span class="token punctuation">,</span>
        url<span class="token operator">:</span> <span class="token string">&quot;/&lt;span style=&apos;color:darkblue;&apos;&gt;&lt;b&gt;Aquando&lt;/b&gt;&lt;/span&gt;.com/A_Estacion.php&quot;</span><span class="token punctuation">,</span>
        data<span class="token operator">:</span> <span class="token punctuation">{</span>
          opcion<span class="token operator">:</span> <span class="token string">&quot;actualizar&quot;</span><span class="token punctuation">,</span>
          estacion<span class="token operator">:</span> id_estacion<span class="token punctuation">,</span>
          tipo<span class="token operator">:</span> <span class="token string">&quot;todos&quot;</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token keyword keyword-function">function</span> <span class="token punctuation">(</span><span class="token parameter">datos</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token function">filtrarDatos</span><span class="token punctuation">(</span>datos<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token dom variable">sessionStorage</span><span class="token punctuation">.</span><span class="token method function property-access">setItem</span><span class="token punctuation">(</span><span class="token string">&quot;param_id&quot;</span><span class="token punctuation">,</span> id_estacion<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token dom variable">sessionStorage</span><span class="token punctuation">.</span><span class="token method function property-access">setItem</span><span class="token punctuation">(</span><span class="token string">&quot;data&quot;</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span>span style<span class="token operator">=</span><span class="token string">&apos;color:gold&apos;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>b<span class="token operator">&gt;</span><span class="token constant">JS</span><span class="token operator">&lt;</span><span class="token operator">/</span>b<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">&gt;</span><span class="token constant">ON</span><span class="token punctuation">.</span><span class="token method function property-access">stringify</span><span class="token punctuation">(</span>datos<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token function-variable function">error</span><span class="token operator">:</span> <span class="token keyword keyword-function">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">&quot;error&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        dataType<span class="token operator">:</span> <span class="token string">&quot;json&quot;</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><h4>5.1.3.2 FUNCI&#xD3;N <strong>trendTagsV2()</strong></h4>
<blockquote>
<p><span style="color:green">@params</span> Void</p>
</blockquote>
<blockquote>
<p><span style="color:green">@returns</span> <span style="color:gold"><b>JS</b></span>ON</p>
</blockquote>
<p>Esta funci&#xF3;n hace una petici&#xF3;n a servidor por Ajax a trav&#xE9;s de A_Estacion.php y extrae los trends de las se&#xF1;ales de la estaci&#xF3;n.</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript">    <span class="token function">$</span><span class="token punctuation">(</span><span class="token dom variable">document</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">ready</span><span class="token punctuation">(</span><span class="token keyword keyword-function">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      $<span class="token punctuation">.</span><span class="token method function property-access">ajax</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        type<span class="token operator">:</span> <span class="token string">&quot;POST&quot;</span><span class="token punctuation">,</span>
        data<span class="token operator">:</span> <span class="token punctuation">{</span>
          opcion<span class="token operator">:</span> <span class="token string">&quot;t_trend&quot;</span><span class="token punctuation">,</span>
          arrTags<span class="token operator">:</span> arrTags<span class="token punctuation">,</span>
          tipo<span class="token operator">:</span> <span class="token string">&quot;todos&quot;</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        url<span class="token operator">:</span> <span class="token string">&quot;/&lt;span style=&apos;color:darkblue;&apos;&gt;&lt;b&gt;Aquando&lt;/b&gt;&lt;/span&gt;.com/A_Estacion.php&quot;</span><span class="token punctuation">,</span>
        <span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token keyword keyword-function">function</span> <span class="token punctuation">(</span><span class="token parameter">trends</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword keyword-var">var</span> arrTrends <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
          <span class="token keyword control-flow keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-var">var</span> a <span class="token keyword keyword-in">in</span> trends<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            arrTrends<span class="token punctuation">[</span>a<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span> fecha<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> max<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
            <span class="token keyword control-flow keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-var">var</span> b <span class="token keyword keyword-in">in</span> trends<span class="token punctuation">[</span>a<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
              arrTrends<span class="token punctuation">[</span>a<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">&quot;fecha&quot;</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token method function property-access">push</span><span class="token punctuation">(</span>trends<span class="token punctuation">[</span>a<span class="token punctuation">]</span><span class="token punctuation">[</span>b<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">&quot;fecha&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token keyword control-flow keyword-if">if</span> <span class="token punctuation">(</span>trends<span class="token punctuation">[</span>a<span class="token punctuation">]</span><span class="token punctuation">[</span>b<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">&quot;acu&quot;</span><span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token keyword null nil keyword-null">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                arrTrends<span class="token punctuation">[</span>a<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">&quot;max&quot;</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token method function property-access">push</span><span class="token punctuation">(</span>trends<span class="token punctuation">[</span>a<span class="token punctuation">]</span><span class="token punctuation">[</span>b<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">&quot;acu&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token punctuation">}</span>
              <span class="token keyword control-flow keyword-if">if</span> <span class="token punctuation">(</span>trends<span class="token punctuation">[</span>a<span class="token punctuation">]</span><span class="token punctuation">[</span>b<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">&quot;float&quot;</span><span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token keyword null nil keyword-null">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                arrTrends<span class="token punctuation">[</span>a<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">&quot;max&quot;</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token method function property-access">push</span><span class="token punctuation">(</span>trends<span class="token punctuation">[</span>a<span class="token punctuation">]</span><span class="token punctuation">[</span>b<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">&quot;float&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token punctuation">}</span>
              <span class="token keyword control-flow keyword-if">if</span> <span class="token punctuation">(</span>trends<span class="token punctuation">[</span>a<span class="token punctuation">]</span><span class="token punctuation">[</span>b<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">&quot;int&quot;</span><span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token keyword null nil keyword-null">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                arrTrends<span class="token punctuation">[</span>a<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">&quot;max&quot;</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token method function property-access">push</span><span class="token punctuation">(</span>trends<span class="token punctuation">[</span>a<span class="token punctuation">]</span><span class="token punctuation">[</span>b<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">&quot;int&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">}</span>
          <span class="token function">montarWidgetsAnalogicos</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          todoTrends <span class="token operator">=</span> arrTrends<span class="token punctuation">;</span>
          <span class="token function">montarWidgetsDigi</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token dom variable">sessionStorage</span><span class="token punctuation">.</span><span class="token method function property-access">setItem</span><span class="token punctuation">(</span><span class="token string">&quot;trend_arrTags&quot;</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span>span style<span class="token operator">=</span><span class="token string">&apos;color:gold&apos;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>b<span class="token operator">&gt;</span><span class="token constant">JS</span><span class="token operator">&lt;</span><span class="token operator">/</span>b<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">&gt;</span><span class="token constant">ON</span><span class="token punctuation">.</span><span class="token method function property-access">stringify</span><span class="token punctuation">(</span>arrTags<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token dom variable">sessionStorage</span><span class="token punctuation">.</span><span class="token method function property-access">setItem</span><span class="token punctuation">(</span><span class="token string">&quot;trend_todoTrends&quot;</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span>span style<span class="token operator">=</span><span class="token string">&apos;color:gold&apos;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>b<span class="token operator">&gt;</span><span class="token constant">JS</span><span class="token operator">&lt;</span><span class="token operator">/</span>b<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">&gt;</span><span class="token constant">ON</span><span class="token punctuation">.</span><span class="token method function property-access">stringify</span><span class="token punctuation">(</span>arrTrends<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token function-variable function">error</span><span class="token operator">:</span> <span class="token keyword keyword-function">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">&quot;error&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        dataType<span class="token operator">:</span> <span class="token string">&quot;json&quot;</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><h4>5.1.3.3 FUNCI&#xD3;N <strong>fotoEstacion()</strong></h4>
<blockquote>
<p><span style="color:green">@params</span> <b>INT</b> id_estacion</p>
</blockquote>
<blockquote>
<p><span style="color:green">@returns</span> <b>HTML</b></p>
</blockquote>
<p>Esta funci&#xF3;n hace una petici&#xF3;n a servidor por Ajax a trav&#xE9;s de A_Estacion.php y extrae la foto en Base64 perteneciente a una estaci&#xF3;n</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token function">$</span><span class="token punctuation">(</span><span class="token dom variable">document</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">ready</span><span class="token punctuation">(</span><span class="token keyword keyword-function">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  $<span class="token punctuation">.</span><span class="token method function property-access">ajax</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    type<span class="token operator">:</span> <span class="token string">&quot;POST&quot;</span><span class="token punctuation">,</span>
    data<span class="token operator">:</span> <span class="token punctuation">{</span>
      opcion<span class="token operator">:</span> <span class="token string">&quot;foto&quot;</span><span class="token punctuation">,</span>
      estacion<span class="token operator">:</span> id_estacion<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    url<span class="token operator">:</span> <span class="token string">&quot;/&lt;span style=&apos;color:darkblue;&apos;&gt;&lt;b&gt;Aquando&lt;/b&gt;&lt;/span&gt;.com/A_Estacion.php?&quot;</span><span class="token punctuation">,</span>
    <span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token keyword keyword-function">function</span> <span class="token punctuation">(</span><span class="token parameter">foto</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword keyword-var">var</span> ima<span class="token punctuation">;</span>
      <span class="token keyword control-flow keyword-if">if</span> <span class="token punctuation">(</span>foto <span class="token operator">!=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        ima <span class="token operator">=</span>
          <span class="token string">&apos;linear-gradient(to left, rgba(255,255,255,0.99),rgba(255,255,255,0)),url(&quot;data:image/jpg;base64,&apos;</span> <span class="token operator">+</span>
          foto <span class="token operator">+</span>
          <span class="token string">&apos;&quot;)&apos;</span><span class="token punctuation">;</span>
        <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;seccionFoto&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access">style</span><span class="token punctuation">.</span><span class="token property-access">backgroundImage</span> <span class="token operator">=</span> ima<span class="token punctuation">;</span>
        <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;seccionFoto&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access">style</span><span class="token punctuation">.</span><span class="token property-access">backgroundSize</span> <span class="token operator">=</span> <span class="token string">&quot;cover&quot;</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function-variable function">error</span><span class="token operator">:</span> <span class="token keyword keyword-function">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">&quot;error&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><blockquote>
<p>aun faltar&#xED;a a&#xF1;adir las peticiones a A_Ajustes.php pero el c&#xF3;digo es provisional y est&#xE1; sujeto a cambios.</p>
</blockquote>
<h2>5.1.4 <strong>graficas.js</strong></h2>
<h4>5.1.4.1 FUNCI&#xD3;N <strong>metaDatostag()</strong></h4>
<blockquote>
<p><span style="color:green">@params</span> <b>INT</b> id_tag, <b>INT</b> id_estacion</p>
</blockquote>
<blockquote>
<p><span style="color:green">@returns</span> <span style="color:gold"><b>JS</b></span>ON</p>
</blockquote>
<p>Esta funci&#xF3;n hace una petici&#xF3;n a servidor por Ajax a trav&#xE9;s de A_Graficas.php y obtiene los calculados de una se&#xF1;al en funci&#xF3;n de una serie de par&#xE1;metros y dados el id de la se&#xF1;al y la estaci&#xF3;n.</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript">$<span class="token punctuation">.</span><span class="token method function property-access">ajax</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  type<span class="token operator">:</span> <span class="token string">&quot;POST&quot;</span><span class="token punctuation">,</span>
  url<span class="token operator">:</span> <span class="token string">&quot;/&lt;span style=&apos;color:darkblue;&apos;&gt;&lt;b&gt;Aquando&lt;/b&gt;&lt;/span&gt;.com/A_Graficas.php&quot;</span><span class="token punctuation">,</span>
  data<span class="token operator">:</span> <span class="token punctuation">{</span>
    opcion<span class="token operator">:</span> <span class="token string">&quot;meta&quot;</span><span class="token punctuation">,</span>
    tag<span class="token operator">:</span> id_tag<span class="token punctuation">,</span>
    estacion<span class="token operator">:</span> id_estacion<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token keyword keyword-function">function</span> <span class="token punctuation">(</span><span class="token parameter">meta</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    datosM<span class="token punctuation">[</span><span class="token string">&quot;max&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> meta<span class="token punctuation">[</span><span class="token string">&quot;max&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    datosM<span class="token punctuation">[</span><span class="token string">&quot;min&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> meta<span class="token punctuation">[</span><span class="token string">&quot;min&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    datosM<span class="token punctuation">[</span><span class="token string">&quot;avg&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> meta<span class="token punctuation">[</span><span class="token string">&quot;avg&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    $<span class="token punctuation">.</span><span class="token method function property-access">ajax</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      type<span class="token operator">:</span> <span class="token string">&quot;POST&quot;</span><span class="token punctuation">,</span>
      url<span class="token operator">:</span> <span class="token string">&quot;/&lt;span style=&apos;color:darkblue;&apos;&gt;&lt;b&gt;Aquando&lt;/b&gt;&lt;/span&gt;.com/A_Graficas.php&quot;</span><span class="token punctuation">,</span>
      data<span class="token operator">:</span> <span class="token punctuation">{</span>
        estacion<span class="token operator">:</span> id_estacion<span class="token punctuation">,</span>
        tag<span class="token operator">:</span> id_tag<span class="token punctuation">,</span>
        opcion<span class="token operator">:</span> <span class="token string">&quot;render&quot;</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token keyword keyword-function">function</span> <span class="token punctuation">(</span><span class="token parameter">histo</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        datosR <span class="token operator">=</span> histo<span class="token punctuation">;</span>
        <span class="token function">renderGrafico</span><span class="token punctuation">(</span>datosR<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token function-variable function">error</span><span class="token operator">:</span> <span class="token keyword keyword-function">function</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      dataType<span class="token operator">:</span> <span class="token string">&quot;json&quot;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">error</span><span class="token operator">:</span> <span class="token keyword keyword-function">function</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  dataType<span class="token operator">:</span> <span class="token string">&quot;json&quot;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><h4>5.1.4.2 FUNCI&#xD3;N <strong>tagsEstacion()</strong></h4>
<blockquote>
<p><span style="color:green">@params</span> <b>INT</b> id_estacion</p>
</blockquote>
<blockquote>
<p><span style="color:green">@returns</span> <b>HTML</b></p>
</blockquote>
<p>Esta funci&#xF3;n hace una petici&#xF3;n a servidor por Ajax a trav&#xE9;s de A_Graficas.php para extraer una lista de los tags disponibles seg&#xFA;n una estaci&#xF3;n dado su id.</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token function">$</span><span class="token punctuation">(</span><span class="token dom variable">document</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">ready</span><span class="token punctuation">(</span><span class="token keyword keyword-function">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    $<span class="token punctuation">.</span><span class="token method function property-access">ajax</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      type<span class="token operator">:</span> <span class="token string">&quot;POST&quot;</span><span class="token punctuation">,</span>
      url<span class="token operator">:</span> <span class="token string">&quot;/&lt;span style=&apos;color:darkblue;&apos;&gt;&lt;b&gt;Aquando&lt;/b&gt;&lt;/span&gt;.com/A_Graficas.php&quot;</span><span class="token punctuation">,</span>
      data<span class="token operator">:</span> <span class="token punctuation">{</span> estacion<span class="token operator">:</span> id_estacion<span class="token punctuation">,</span> opcion<span class="token operator">:</span> <span class="token string">&quot;tags&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token keyword keyword-function">function</span> <span class="token punctuation">(</span><span class="token parameter">tags</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;opcionesTag&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access">inner</span><span class="token operator">&lt;</span>b<span class="token operator">&gt;</span><span class="token constant">HTML</span><span class="token operator">&lt;</span><span class="token operator">/</span>b<span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
        <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;compararSel&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access">inner</span><span class="token operator">&lt;</span>b<span class="token operator">&gt;</span><span class="token constant">HTML</span><span class="token operator">&lt;</span><span class="token operator">/</span>b<span class="token operator">&gt;</span> <span class="token operator">=</span>
          <span class="token string">&quot;&lt;option value=&apos;nada&apos; selected&gt;Nada&lt;/option&gt;&quot;</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-var">var</span> e <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token dom variable">sessionStorage</span><span class="token punctuation">.</span><span class="token method function property-access">setItem</span><span class="token punctuation">(</span><span class="token string">&quot;tagsAct&quot;</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span>span style<span class="token operator">=</span><span class="token string">&apos;color:gold&apos;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>b<span class="token operator">&gt;</span><span class="token constant">JS</span><span class="token operator">&lt;</span><span class="token operator">/</span>b<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">&gt;</span><span class="token constant">ON</span><span class="token punctuation">.</span><span class="token method function property-access">stringify</span><span class="token punctuation">(</span>tags<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword control-flow keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-var">var</span> tag <span class="token keyword keyword-in">in</span> tags<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword control-flow keyword-if">if</span> <span class="token punctuation">(</span>e <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;opcionesTag&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access">inner</span><span class="token operator">&lt;</span>b<span class="token operator">&gt;</span><span class="token constant">HTML</span><span class="token operator">&lt;</span><span class="token operator">/</span>b<span class="token operator">&gt;</span> <span class="token operator">+=</span>
              <span class="token string">&quot;&lt;option value=&quot;</span> <span class="token operator">+</span>
              tags<span class="token punctuation">[</span>tag<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">&quot;id_tag&quot;</span><span class="token punctuation">]</span> <span class="token operator">+</span>
              <span class="token string">&quot; selected&gt;&quot;</span> <span class="token operator">+</span>
              tags<span class="token punctuation">[</span>tag<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">&quot;nombre_tag&quot;</span><span class="token punctuation">]</span> <span class="token operator">+</span>
              <span class="token string">&quot;&lt;/option&gt;&quot;</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span> <span class="token keyword control-flow keyword-else">else</span> <span class="token punctuation">{</span>
            <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;opcionesTag&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access">inner</span><span class="token operator">&lt;</span>b<span class="token operator">&gt;</span><span class="token constant">HTML</span><span class="token operator">&lt;</span><span class="token operator">/</span>b<span class="token operator">&gt;</span> <span class="token operator">+=</span>
              <span class="token string">&quot;&lt;option value=&quot;</span> <span class="token operator">+</span>
              tags<span class="token punctuation">[</span>tag<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">&quot;id_tag&quot;</span><span class="token punctuation">]</span> <span class="token operator">+</span>
              <span class="token string">&quot;&gt;&quot;</span> <span class="token operator">+</span>
              tags<span class="token punctuation">[</span>tag<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">&quot;nombre_tag&quot;</span><span class="token punctuation">]</span> <span class="token operator">+</span>
              <span class="token string">&quot;&lt;/option&gt;&quot;</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
          <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;compararSel&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access">inner</span><span class="token operator">&lt;</span>b<span class="token operator">&gt;</span><span class="token constant">HTML</span><span class="token operator">&lt;</span><span class="token operator">/</span>b<span class="token operator">&gt;</span> <span class="token operator">+=</span>
            <span class="token string">&quot;&lt;option value=&quot;</span> <span class="token operator">+</span>
            tags<span class="token punctuation">[</span>tag<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">&quot;id_tag&quot;</span><span class="token punctuation">]</span> <span class="token operator">+</span>
            <span class="token string">&quot;&gt;&quot;</span> <span class="token operator">+</span>
            tags<span class="token punctuation">[</span>tag<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">&quot;nombre_tag&quot;</span><span class="token punctuation">]</span> <span class="token operator">+</span>
            <span class="token string">&quot;&lt;/option&gt;&quot;</span><span class="token punctuation">;</span>
          e<span class="token operator">++</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token function">aplicarOpciones</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token function-variable function">error</span><span class="token operator">:</span> <span class="token keyword keyword-function">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">&quot;error&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      dataType<span class="token operator">:</span> <span class="token string">&quot;json&quot;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><h2>5.1.5 <strong>graficasCustom.js</strong></h2>
<h4>5.1.5.1 FUNCI&#xD3;N <strong>tagsEstacionCustom()</strong></h4>
<blockquote>
<p><span style="color:green">@params</span> <b>INT</b> id_estacion</p>
</blockquote>
<blockquote>
<p><span style="color:green">@returns</span> <b>HTML</b></p>
</blockquote>
<p>Esta funci&#xF3;n hace una petici&#xF3;n a servidor por Ajax a trav&#xE9;s de A_GraficasCustom.php para extraer una lista de los tags disponibles seg&#xFA;n una estaci&#xF3;n dado su id.</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript">$<span class="token punctuation">.</span><span class="token method function property-access">ajax</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      type<span class="token operator">:</span> <span class="token string">&quot;POST&quot;</span><span class="token punctuation">,</span>
      url<span class="token operator">:</span> <span class="token string">&quot;/&lt;span style=&apos;color:darkblue;&apos;&gt;&lt;b&gt;Aquando&lt;/b&gt;&lt;/span&gt;.com/A_Graficas.php&quot;</span><span class="token punctuation">,</span>
      data<span class="token operator">:</span> <span class="token punctuation">{</span> estacion<span class="token operator">:</span> id_estacion<span class="token punctuation">,</span> opcion<span class="token operator">:</span> <span class="token string">&quot;tags&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token keyword keyword-function">function</span> <span class="token punctuation">(</span><span class="token parameter">tags</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;opcionesTag&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access">inner</span><span class="token operator">&lt;</span>b<span class="token operator">&gt;</span><span class="token constant">HTML</span><span class="token operator">&lt;</span><span class="token operator">/</span>b<span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-var">var</span> e <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token dom variable">sessionStorage</span><span class="token punctuation">.</span><span class="token method function property-access">setItem</span><span class="token punctuation">(</span><span class="token string">&quot;tagsAct&quot;</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span>span style<span class="token operator">=</span><span class="token string">&apos;color:gold&apos;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>b<span class="token operator">&gt;</span><span class="token constant">JS</span><span class="token operator">&lt;</span><span class="token operator">/</span>b<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">&gt;</span><span class="token constant">ON</span><span class="token punctuation">.</span><span class="token method function property-access">stringify</span><span class="token punctuation">(</span>tags<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword control-flow keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-var">var</span> tag <span class="token keyword keyword-in">in</span> tags<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword control-flow keyword-if">if</span> <span class="token punctuation">(</span>e <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

            <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;opcionesTag&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access">inner</span><span class="token operator">&lt;</span>b<span class="token operator">&gt;</span><span class="token constant">HTML</span><span class="token operator">&lt;</span><span class="token operator">/</span>b<span class="token operator">&gt;</span> <span class="token operator">+=</span>
              <span class="token string">&apos;&lt;li&gt;&lt;input type=&quot;checkbox&quot; name=&quot;checkTag&quot; style=&quot;visibility: hidden;&quot; value=&quot;&apos;</span> <span class="token operator">+</span>
              tags<span class="token punctuation">[</span>tag<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">&quot;id_tag&quot;</span><span class="token punctuation">]</span> <span class="token operator">+</span>
              <span class="token string">&apos;&quot; id = &apos;</span> <span class="token operator">+</span>
              tags<span class="token punctuation">[</span>tag<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">&quot;id_tag&quot;</span><span class="token punctuation">]</span> <span class="token operator">+</span>
              <span class="token string">&apos;&gt;&lt;label for = &quot;&apos;</span> <span class="token operator">+</span>
              tags<span class="token punctuation">[</span>tag<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">&quot;id_tag&quot;</span><span class="token punctuation">]</span> <span class="token operator">+</span>
              <span class="token string">&apos;&quot; style=&quot;box-sizing: none&quot;&gt; &apos;</span> <span class="token operator">+</span>
              tags<span class="token punctuation">[</span>tag<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">&quot;nombre_tag&quot;</span><span class="token punctuation">]</span> <span class="token operator">+</span>
              <span class="token string">&apos; &lt;/label&gt; &lt;label&gt; &lt;i class= &quot;fas fa-palette&quot;&gt; &lt;/i&gt;&lt;input type=&quot;color&quot; class=&quot;form-control-color&quot; id=&quot;color&apos;</span> <span class="token operator">+</span>
              tags<span class="token punctuation">[</span>tag<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">&quot;id_tag&quot;</span><span class="token punctuation">]</span> <span class="token operator">+</span>
              <span class="token string">&apos;&quot; style=&quot;visibility:hidden&quot; title=&quot;color&quot; name=&quot;colorDato&quot; list=&quot;coloresTagGraf&quot;&gt;&lt;/label&gt;&lt;/li&gt;&apos;</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span> <span class="token keyword control-flow keyword-else">else</span> <span class="token punctuation">{</span>
            <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;opcionesTag&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access">inner</span><span class="token operator">&lt;</span>b<span class="token operator">&gt;</span><span class="token constant">HTML</span><span class="token operator">&lt;</span><span class="token operator">/</span>b<span class="token operator">&gt;</span> <span class="token operator">+=</span>
              <span class="token string">&apos;&lt;li&gt; &lt;input type = &quot;checkbox&quot; name=&quot;checkTag&quot; style = &quot;visibility: hidden;&quot; value=&quot;&apos;</span> <span class="token operator">+</span>
              tags<span class="token punctuation">[</span>tag<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">&quot;id_tag&quot;</span><span class="token punctuation">]</span> <span class="token operator">+</span>
              <span class="token string">&apos;&quot; id = &apos;</span> <span class="token operator">+</span>
              tags<span class="token punctuation">[</span>tag<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">&quot;id_tag&quot;</span><span class="token punctuation">]</span> <span class="token operator">+</span>
              <span class="token string">&apos; &gt;&lt;label for = &quot;&apos;</span> <span class="token operator">+</span>
              tags<span class="token punctuation">[</span>tag<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">&quot;id_tag&quot;</span><span class="token punctuation">]</span> <span class="token operator">+</span>
              <span class="token string">&apos;&quot; style=&quot;box-sizing: none&quot;&gt; &apos;</span> <span class="token operator">+</span>
              tags<span class="token punctuation">[</span>tag<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">&quot;nombre_tag&quot;</span><span class="token punctuation">]</span> <span class="token operator">+</span>
              <span class="token string">&apos; &lt;/label&gt; &lt;label&gt; &lt;i class= &quot;fas fa-palette&quot;&gt; &lt;/i&gt;&lt;input type=&quot;color&quot; class=&quot;form-control-color&quot; id=&quot;color&apos;</span> <span class="token operator">+</span>
              tags<span class="token punctuation">[</span>tag<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">&quot;id_tag&quot;</span><span class="token punctuation">]</span> <span class="token operator">+</span>
              <span class="token string">&apos;&quot; style=&quot;visibility:hidden&quot; title=&quot;color&quot; name=&quot;colorDato&quot; list=&quot;coloresTagGraf&quot;&gt;&lt;/label &gt;&lt;/li&gt;&apos;</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
          e<span class="token operator">++</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token function-variable function">error</span><span class="token operator">:</span> <span class="token keyword keyword-function">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">&quot;error&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      dataType<span class="token operator">:</span> <span class="token string">&quot;json&quot;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><h4>5.1.5.2 FUNCI&#xD3;N <strong>infoTags()</strong></h4>
<blockquote>
<p><span style="color:green">@params</span> <b>INT</b> estacion, <b>Array</b> ajustesTag, <b>INT</b> tag, <b>Array</b> metas, <b>TS</b> fechaIni, <b>TS</b> fechaFin</p>
</blockquote>
<blockquote>
<p><span style="color:green">@returns</span> <span style="color:gold"><b>JS</b></span>ON</p>
</blockquote>
<p>Esta funci&#xF3;n hace una petici&#xF3;n a servidor por Ajax a trav&#xE9;s de A_GraficasCustom.php para conseguir los calculados y metadados de un tag.</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript">$<span class="token punctuation">.</span><span class="token method function property-access">ajax</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  type<span class="token operator">:</span> <span class="token string">&quot;POST&quot;</span><span class="token punctuation">,</span>
  url<span class="token operator">:</span> <span class="token string">&quot;/&lt;span style=&apos;color:darkblue;&apos;&gt;&lt;b&gt;Aquando&lt;/b&gt;&lt;/span&gt;.com/A_GraficasCustom.php&quot;</span><span class="token punctuation">,</span>
  data<span class="token operator">:</span> <span class="token punctuation">{</span>
    estacion<span class="token operator">:</span> estacion<span class="token punctuation">,</span>
    id_tag<span class="token operator">:</span> tag<span class="token punctuation">,</span>
    fechaIni<span class="token operator">:</span> fechaIni<span class="token punctuation">,</span>
    fechaFin<span class="token operator">:</span> fechaFin<span class="token punctuation">,</span>
    meta<span class="token operator">:</span> metas<span class="token punctuation">,</span>
    opcion<span class="token operator">:</span> <span class="token string">&quot;tag&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token keyword keyword-function">function</span> <span class="token punctuation">(</span><span class="token parameter">datosTag</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">prepararTag</span><span class="token punctuation">(</span>datosTag<span class="token punctuation">,</span> tag<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow keyword-if">if</span> <span class="token punctuation">(</span>ajustesTag<span class="token punctuation">.</span><span class="token method function property-access">at</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">==</span> tag<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">setTimeout</span><span class="token punctuation">(</span>renderGrafico<span class="token punctuation">,</span> nTags <span class="token operator">*</span> <span class="token number">300</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">error</span><span class="token operator">:</span> <span class="token keyword keyword-function">function</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">&quot;error&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  dataType<span class="token operator">:</span> <span class="token string">&quot;json&quot;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><h4>5.1.5.3 FUNCI&#xD3;N <strong>leerPresets()</strong></h4>
<blockquote>
<p><span style="color:green">@params</span> <b>String</b> para</p>
</blockquote>
<blockquote>
<p><span style="color:green">@returns</span> Mixed <span style="color:gold"><b>JS</b></span>ON | <b>HTML</b></p>
</blockquote>
<p>Esta funci&#xF3;n hace una petici&#xF3;n a servidor por Ajax a trav&#xE9;s de A_GraficasCustom.php para leer los presets guardados por un usuario.</p>
<p>leer presets:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript">    <span class="token function">$</span><span class="token punctuation">(</span><span class="token dom variable">document</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">ready</span><span class="token punctuation">(</span><span class="token keyword keyword-function">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      $<span class="token punctuation">.</span><span class="token method function property-access">ajax</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        type<span class="token operator">:</span> <span class="token string">&quot;POST&quot;</span><span class="token punctuation">,</span>
        url<span class="token operator">:</span> <span class="token string">&quot;/&lt;span style=&apos;color:darkblue;&apos;&gt;&lt;b&gt;Aquando&lt;/b&gt;&lt;/span&gt;.com/A_GraficasCustom.php&quot;</span><span class="token punctuation">,</span>
        data<span class="token operator">:</span> <span class="token punctuation">{</span>
          opcion<span class="token operator">:</span> <span class="token string">&quot;leerPresets&quot;</span><span class="token punctuation">,</span>
          para<span class="token operator">:</span> para<span class="token punctuation">,</span>
          arrdatos<span class="token operator">:</span> arrdatos<span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token keyword keyword-function">function</span> <span class="token punctuation">(</span><span class="token parameter">presets</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;selPresets&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access">inner</span><span class="token operator">&lt;</span>b<span class="token operator">&gt;</span><span class="token constant">HTML</span><span class="token operator">&lt;</span><span class="token operator">/</span>b<span class="token operator">&gt;</span> <span class="token operator">=</span> presets<span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token function-variable function">error</span><span class="token operator">:</span> <span class="token keyword keyword-function">function</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">&quot;error&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>cargar presets:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token function">$</span><span class="token punctuation">(</span><span class="token dom variable">document</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">ready</span><span class="token punctuation">(</span><span class="token keyword keyword-function">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  $<span class="token punctuation">.</span><span class="token method function property-access">ajax</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    type<span class="token operator">:</span> <span class="token string">&quot;POST&quot;</span><span class="token punctuation">,</span>
    url<span class="token operator">:</span> <span class="token string">&quot;/&lt;span style=&apos;color:darkblue;&apos;&gt;&lt;b&gt;Aquando&lt;/b&gt;&lt;/span&gt;.com/A_GraficasCustom.php&quot;</span><span class="token punctuation">,</span>
    data<span class="token operator">:</span> <span class="token punctuation">{</span>
      opcion<span class="token operator">:</span> <span class="token string">&quot;leerPresets&quot;</span><span class="token punctuation">,</span>
      para<span class="token operator">:</span> para<span class="token punctuation">,</span>
      arrdatos<span class="token operator">:</span> arrdatos<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token keyword keyword-function">function</span> <span class="token punctuation">(</span><span class="token parameter">presets</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      presets_config <span class="token operator">=</span> presets<span class="token punctuation">;</span>
      <span class="token keyword control-flow keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-var">var</span> index <span class="token keyword keyword-in">in</span> presets_config<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword control-flow keyword-if">if</span> <span class="token punctuation">(</span>presets_config<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">&quot;configuracion&quot;</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token method function property-access">includes</span><span class="token punctuation">(</span>n_preset<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword keyword-var">var</span> config <span class="token operator">=</span> presets_config<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">&quot;configuracion&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
          config <span class="token operator">=</span> config<span class="token punctuation">.</span><span class="token method function property-access">substring</span><span class="token punctuation">(</span>config<span class="token punctuation">.</span><span class="token method function property-access">indexOf</span><span class="token punctuation">(</span><span class="token string">&quot;@&quot;</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword keyword-var">var</span> id_est <span class="token operator">=</span> config<span class="token punctuation">.</span><span class="token method function property-access">substring</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> config<span class="token punctuation">.</span><span class="token method function property-access">indexOf</span><span class="token punctuation">(</span><span class="token string">&quot;?&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword keyword-var">var</span> config_tags <span class="token operator">=</span> config<span class="token punctuation">.</span><span class="token method function property-access">substring</span><span class="token punctuation">(</span>config<span class="token punctuation">.</span><span class="token method function property-access">indexOf</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword keyword-var">var</span> tagsycolores <span class="token operator">=</span> config_tags<span class="token punctuation">.</span><span class="token method function property-access">split</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword keyword-var">var</span> config_tags_colores <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token punctuation">(</span><span class="token operator">&lt;</span>b<span class="token operator">&gt;</span><span class="token known-class-name class-name">Array</span><span class="token operator">&lt;</span><span class="token operator">/</span>b<span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword control-flow keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-var">var</span> index <span class="token keyword keyword-in">in</span> tagsycolores<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword keyword-var">var</span> info <span class="token operator">=</span> tagsycolores<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token method function property-access">split</span><span class="token punctuation">(</span><span class="token string">&quot;:&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            config_tags_colores<span class="token punctuation">[</span>info<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> info<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">getElementById</span><span class="token punctuation">(</span>info<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access">checked</span> <span class="token operator">=</span> <span class="token string">&quot;true&quot;</span><span class="token punctuation">;</span>
            <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;color&quot;</span> <span class="token operator">+</span> info<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access">value</span> <span class="token operator">=</span> info<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token keyword control-flow keyword-if">if</span> <span class="token punctuation">(</span>
              <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">getElementById</span><span class="token punctuation">(</span>info<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access">parentNode</span><span class="token punctuation">.</span><span class="token property-access">style</span>
                <span class="token punctuation">.</span><span class="token property-access">backgroundColor</span> <span class="token operator">==</span> <span class="token string">&quot;darkgray&quot;</span>
            <span class="token punctuation">)</span> <span class="token punctuation">{</span>
              <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">getElementById</span><span class="token punctuation">(</span>
                info<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
              <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access">parentNode</span><span class="token punctuation">.</span><span class="token property-access">style</span><span class="token punctuation">.</span><span class="token property-access">backgroundColor</span> <span class="token operator">=</span> <span class="token string">&quot;lightgray&quot;</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword control-flow keyword-else">else</span> <span class="token punctuation">{</span>
              <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">getElementById</span><span class="token punctuation">(</span>
                info<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
              <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access">parentNode</span><span class="token punctuation">.</span><span class="token property-access">style</span><span class="token punctuation">.</span><span class="token property-access">backgroundColor</span> <span class="token operator">=</span> <span class="token string">&quot;darkgray&quot;</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;color&quot;</span> <span class="token operator">+</span> info<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access">parentNode</span><span class="token punctuation">.</span><span class="token property-access">style</span><span class="token punctuation">.</span><span class="token property-access">color</span> <span class="token operator">=</span>
              info<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
          <span class="token function">aplicarCustom</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token function">ajustesPresets</span><span class="token punctuation">(</span><span class="token keyword null nil keyword-null">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function-variable function">error</span><span class="token operator">:</span> <span class="token keyword keyword-function">function</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">&quot;error&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    dataType<span class="token operator">:</span> <span class="token string">&quot;json&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><h4>5.1.5.4 FUNCI&#xD3;N <strong>borrarPreset()</strong></h4>
<blockquote>
<p><span style="color:green">@params</span> Void</p>
</blockquote>
<blockquote>
<p>returns <b>Bool</b></p>
</blockquote>
<p>Esta funci&#xF3;n hace una petici&#xF3;n a servidor por Ajax a trav&#xE9;s de A_GraficasCustom.php para borrar el preset seleccionado en ese momento.</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token function">$</span><span class="token punctuation">(</span><span class="token dom variable">document</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">ready</span><span class="token punctuation">(</span><span class="token keyword keyword-function">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  $<span class="token punctuation">.</span><span class="token method function property-access">ajax</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    type<span class="token operator">:</span> <span class="token string">&quot;POST&quot;</span><span class="token punctuation">,</span>
    url<span class="token operator">:</span> <span class="token string">&quot;/&lt;span style=&apos;color:darkblue;&apos;&gt;&lt;b&gt;Aquando&lt;/b&gt;&lt;/span&gt;.com/A_GraficasCustom.php&quot;</span><span class="token punctuation">,</span>
    data<span class="token operator">:</span> <span class="token punctuation">{</span>
      opcion<span class="token operator">:</span> <span class="token string">&quot;borrar&quot;</span><span class="token punctuation">,</span>
      preset<span class="token operator">:</span> n_preset<span class="token punctuation">,</span>
      arrdatos<span class="token operator">:</span> arrdatos<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token keyword keyword-function">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">leerPresets</span><span class="token punctuation">(</span><span class="token string">&quot;mostrar&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token function">ajustesPresets</span><span class="token punctuation">(</span><span class="token keyword null nil keyword-null">null</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function-variable function">error</span><span class="token operator">:</span> <span class="token keyword keyword-function">function</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">&quot;error&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    dataType<span class="token operator">:</span> <span class="token string">&quot;json&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><h4>5.1.5.5 FUNCI&#xD3;N <strong>guardarPreset()</strong></h4>
<blockquote>
<p><span style="color:green">@params</span> Void</p>
</blockquote>
<blockquote>
<p>@return Void</p>
</blockquote>
<p>Esta funci&#xF3;n hace una petici&#xF3;n a servidor por Ajax a trav&#xE9;s de A_GraficasCustom.php para guardar un preset seg&#xFA;n los ajustes seleccionados en ese momento para el usuario que est&#xE9; logueado en ese momento.</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token function">$</span><span class="token punctuation">(</span><span class="token dom variable">document</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">ready</span><span class="token punctuation">(</span><span class="token keyword keyword-function">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      $<span class="token punctuation">.</span><span class="token method function property-access">ajax</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        type<span class="token operator">:</span> <span class="token string">&quot;POST&quot;</span><span class="token punctuation">,</span>
        url<span class="token operator">:</span> <span class="token string">&quot;/&lt;span style=&apos;color:darkblue;&apos;&gt;&lt;b&gt;Aquando&lt;/b&gt;&lt;/span&gt;.com/A_GraficasCustom.php&quot;</span><span class="token punctuation">,</span>
        data<span class="token operator">:</span> <span class="token punctuation">{</span>
          opcion<span class="token operator">:</span> <span class="token string">&quot;guardar&quot;</span><span class="token punctuation">,</span>
          arrDatosPreset<span class="token operator">:</span> arrDatosPreset<span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token keyword keyword-function">function</span> <span class="token punctuation">(</span><span class="token parameter">info</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;ajustesPresets&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access">inner</span><span class="token operator">&lt;</span>b<span class="token operator">&gt;</span><span class="token constant">HTML</span><span class="token operator">&lt;</span><span class="token operator">/</span>b<span class="token operator">&gt;</span> <span class="token operator">+=</span>
            <span class="token string">&quot;preset guardado&quot;</span><span class="token punctuation">;</span>
          <span class="token function">leerPresets</span><span class="token punctuation">(</span><span class="token string">&quot;mostrar&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token function">ajustesPresets</span><span class="token punctuation">(</span><span class="token keyword null nil keyword-null">null</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token function-variable function">error</span><span class="token operator">:</span> <span class="token keyword keyword-function">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">&quot;error en el guardado&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        dataType<span class="token operator">:</span> <span class="token string">&quot;json&quot;</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><h2>5.1.6 <strong>informes.js</strong></h2>
<h4>5.1.6.1 FUNCI&#xD3;N <strong>obtenerInforme()</strong></h4>
<blockquote>
<p><span style="color:green">@params</span> Void</p>
</blockquote>
<blockquote>
<p><span style="color:green">@returns</span> <b>HTML</b></p>
</blockquote>
<p>Esta funci&#xF3;n hace una peticion a servidor por Ajax a trav&#xE9;s de A_Informes.php para obtener los datos necesarios para crear un informe a traves de Koolreport seg&#xFA;n las opciones seleccionadas en ese momento por el usuario.</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript">$<span class="token punctuation">.</span><span class="token method function property-access">ajax</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      type<span class="token operator">:</span> <span class="token string">&quot;POST&quot;</span><span class="token punctuation">,</span>
      data<span class="token operator">:</span> <span class="token punctuation">{</span>
        opcion<span class="token operator">:</span> opcion<span class="token punctuation">,</span>
        fechaIni<span class="token operator">:</span> fInicio<span class="token punctuation">,</span>
        fechaFin<span class="token operator">:</span> fFin<span class="token punctuation">,</span>
        arrEstaciones<span class="token operator">:</span> arrEstaciones<span class="token punctuation">,</span>
        arrNombres<span class="token operator">:</span> arrNombres<span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>

      url<span class="token operator">:</span> <span class="token string">&quot;/&lt;span style=&apos;color:darkblue;&apos;&gt;&lt;b&gt;Aquando&lt;/b&gt;&lt;/span&gt;.com/A_Informes.php&quot;</span><span class="token punctuation">,</span>
      <span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token keyword keyword-function">function</span> <span class="token punctuation">(</span><span class="token parameter">informe</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">reset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-var">var</span> ahora <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-var">var</span> fechahora <span class="token operator">=</span>
          <span class="token string">&quot;&quot;</span> <span class="token operator">+</span>
          ahora<span class="token punctuation">.</span><span class="token method function property-access">getDate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span>
          <span class="token string">&quot;-&quot;</span> <span class="token operator">+</span>
          <span class="token punctuation">(</span>ahora<span class="token punctuation">.</span><span class="token method function property-access">getMonth</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">+</span>
          <span class="token string">&quot;-&quot;</span> <span class="token operator">+</span>
          ahora<span class="token punctuation">.</span><span class="token method function property-access">getFullYear</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span>
          <span class="token string">&quot; a las &quot;</span> <span class="token operator">+</span>
          ahora<span class="token punctuation">.</span><span class="token method function property-access">getHours</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span>
          <span class="token string">&quot;:&quot;</span> <span class="token operator">+</span>
          ahora<span class="token punctuation">.</span><span class="token method function property-access">getMinutes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-var">var</span> cabecera <span class="token operator">=</span>
          <span class="token string">&quot;&lt;h1 style=&apos;color:rgb(1, 168, 184);&apos;&gt;Informe sobre &quot;</span> <span class="token operator">+</span>
          tipoInf <span class="token operator">+</span>
          <span class="token string">&quot;&lt;/h1&gt;&lt;hr&gt;&lt;p style=&apos;color:rgb(65, 65, 65);&apos;&gt;Desde: &quot;</span> <span class="token operator">+</span>
          fInicio <span class="token operator">+</span>
          <span class="token string">&quot; hasta: &quot;</span> <span class="token operator">+</span>
          fFin <span class="token operator">+</span>
          <span class="token string">&quot; &lt;/p&gt;&lt;p style=&apos;color:rgb(65, 65, 65);&apos;&gt;Por &quot;</span> <span class="token operator">+</span>
          nomusuario <span class="token operator">+</span>
          <span class="token string">&quot; el &quot;</span> <span class="token operator">+</span>
          fechahora <span class="token operator">+</span>
          <span class="token string">&quot;&lt;/p&gt;&lt;br&gt;&quot;</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-var">var</span> pie <span class="token operator">=</span>
          <span class="token string">&apos;&lt;p style=&quot;text-align:center&quot;&gt;powered by &lt;img src=&quot;../../logo.png&quot; style=&quot;height: 3.5em; margin-left: 1%;&quot;&gt;&lt;/p&gt;&apos;</span><span class="token punctuation">;</span>
        <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;espacioInforme&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access">inner</span><span class="token operator">&lt;</span>b<span class="token operator">&gt;</span><span class="token constant">HTML</span><span class="token operator">&lt;</span><span class="token operator">/</span>b<span class="token operator">&gt;</span> <span class="token operator">+=</span> cabecera<span class="token punctuation">;</span>
        <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;espacioInforme&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access">inner</span><span class="token operator">&lt;</span>b<span class="token operator">&gt;</span><span class="token constant">HTML</span><span class="token operator">&lt;</span><span class="token operator">/</span>b<span class="token operator">&gt;</span> <span class="token operator">+=</span> informe<span class="token punctuation">;</span>
        <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;espacioInforme&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access">inner</span><span class="token operator">&lt;</span>b<span class="token operator">&gt;</span><span class="token constant">HTML</span><span class="token operator">&lt;</span><span class="token operator">/</span>b<span class="token operator">&gt;</span> <span class="token operator">+=</span> pie<span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token function-variable function">error</span><span class="token operator">:</span> <span class="token keyword keyword-function">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">&quot;error en los informes&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><h2>5.1.7 <strong>principal.js</strong></h2>
<h4>5.1.7.1 FUNCI&#xD3;N <strong>actualizar()</strong></h4>
<blockquote>
<p><span style="color:green">@params</span> Void</p>
</blockquote>
<blockquote>
<p><span style="color:green">@returns</span> <span style="color:gold"><b>JS</b></span>ON</p>
</blockquote>
<p>Esta funci&#xF3;n hace una petici&#xF3;n a servidor por Ajax a trav&#xE9;s de A_Principal.php para actualizar la informaci&#xF3;n de los widgets de la secci&#xF3;n principal.</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token function">$</span><span class="token punctuation">(</span><span class="token dom variable">document</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">ready</span><span class="token punctuation">(</span><span class="token keyword keyword-function">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  $<span class="token punctuation">.</span><span class="token method function property-access">ajax</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    type<span class="token operator">:</span> <span class="token string">&quot;POST&quot;</span><span class="token punctuation">,</span>
    url<span class="token operator">:</span> <span class="token string">&quot;/&lt;span style=&apos;color:darkblue;&apos;&gt;&lt;b&gt;Aquando&lt;/b&gt;&lt;/span&gt;.com/A_Principal.php&quot;</span><span class="token punctuation">,</span>
    data<span class="token operator">:</span> <span class="token punctuation">{</span>
      opcion<span class="token operator">:</span> <span class="token string">&quot;refresh&quot;</span><span class="token punctuation">,</span>
      arrdatos<span class="token operator">:</span> arrdatos<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token keyword keyword-function">function</span> <span class="token punctuation">(</span><span class="token parameter">feedDigi</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      feedDigital <span class="token operator">=</span> feedDigi<span class="token punctuation">;</span>
      <span class="token function">feedPrincipalCustom</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">renderFeedDigi</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function-variable function">error</span><span class="token operator">:</span> <span class="token keyword keyword-function">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">&quot;refresh error&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">feedPrincipalCustom</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    dataType<span class="token operator">:</span> <span class="token string">&quot;json&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><h4>5.1.7.2 FUNCI&#xD3;N <strong>cargarAjustes()</strong></h4>
<blockquote>
<p><span style="color:green">@params</span> Void</p>
</blockquote>
<blockquote>
<p><span style="color:green">@returns</span> <b>HTML</b></p>
</blockquote>
<p>Esta funci&#xF3;n hace una petici&#xF3;n a servidor por Ajax a trav&#xE9;s de A_Principal.php para obtener la lista de tags compatibles con la configuraci&#xF3;n de la secci&#xF3;n (los widgets personalizados por el usuario) principal.</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token function">$</span><span class="token punctuation">(</span><span class="token dom variable">document</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">ready</span><span class="token punctuation">(</span><span class="token keyword keyword-function">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      $<span class="token punctuation">.</span><span class="token method function property-access">ajax</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        type<span class="token operator">:</span> <span class="token string">&quot;POST&quot;</span><span class="token punctuation">,</span>
        url<span class="token operator">:</span> <span class="token string">&quot;/&lt;span style=&apos;color:darkblue;&apos;&gt;&lt;b&gt;Aquando&lt;/b&gt;&lt;/span&gt;.com/A_Principal.php&quot;</span><span class="token punctuation">,</span>
        data<span class="token operator">:</span> <span class="token punctuation">{</span>
          opcion<span class="token operator">:</span> <span class="token string">&quot;ajustes&quot;</span><span class="token punctuation">,</span>
          arrEstaciones<span class="token operator">:</span> arrEstaciones<span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token keyword keyword-function">function</span> <span class="token punctuation">(</span><span class="token parameter">tagsAnalog</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          listaTags <span class="token operator">=</span> tagsAnalog<span class="token punctuation">;</span>
          <span class="token dom variable">sessionStorage</span><span class="token punctuation">.</span><span class="token method function property-access">setItem</span><span class="token punctuation">(</span><span class="token string">&quot;listaTags&quot;</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span>span style<span class="token operator">=</span><span class="token string">&apos;color:gold&apos;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>b<span class="token operator">&gt;</span><span class="token constant">JS</span><span class="token operator">&lt;</span><span class="token operator">/</span>b<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">&gt;</span><span class="token constant">ON</span><span class="token punctuation">.</span><span class="token method function property-access">stringify</span><span class="token punctuation">(</span>listaTags<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword control-flow keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-var">var</span> deposito <span class="token keyword keyword-in">in</span> tagsAnalog<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            sel<span class="token punctuation">.</span><span class="token property-access">inner</span><span class="token operator">&lt;</span>b<span class="token operator">&gt;</span><span class="token constant">HTML</span><span class="token operator">&lt;</span><span class="token operator">/</span>b<span class="token operator">&gt;</span> <span class="token operator">+=</span>
              <span class="token string">&quot;&lt;optgroup label = &apos;&quot;</span> <span class="token operator">+</span>
              tagsAnalog<span class="token punctuation">[</span>deposito<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">&quot;nombre_estacion&quot;</span><span class="token punctuation">]</span> <span class="token operator">+</span>
              <span class="token string">&quot;&apos;&gt;&quot;</span><span class="token punctuation">;</span>
            <span class="token keyword control-flow keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-var">var</span> tag <span class="token keyword keyword-in">in</span> tagsAnalog<span class="token punctuation">[</span>deposito<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
              <span class="token keyword keyword-var">var</span> n_tag <span class="token operator">=</span> tagsAnalog<span class="token punctuation">[</span>deposito<span class="token punctuation">]</span><span class="token punctuation">[</span>tag<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">&quot;nombre_tag&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
              <span class="token keyword keyword-var">var</span> id_tag <span class="token operator">=</span> tagsAnalog<span class="token punctuation">[</span>deposito<span class="token punctuation">]</span><span class="token punctuation">[</span>tag<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">&quot;id_tag&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
              sel<span class="token punctuation">.</span><span class="token property-access">inner</span><span class="token operator">&lt;</span>b<span class="token operator">&gt;</span><span class="token constant">HTML</span><span class="token operator">&lt;</span><span class="token operator">/</span>b<span class="token operator">&gt;</span> <span class="token operator">+=</span>
                <span class="token string">&quot;&lt;option value=&quot;</span> <span class="token operator">+</span> id_tag <span class="token operator">+</span> <span class="token string">&quot;&gt;&quot;</span> <span class="token operator">+</span> n_tag <span class="token operator">+</span> <span class="token string">&quot;&lt;/option&gt;&quot;</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            sel<span class="token punctuation">.</span><span class="token property-access">inner</span><span class="token operator">&lt;</span>b<span class="token operator">&gt;</span><span class="token constant">HTML</span><span class="token operator">&lt;</span><span class="token operator">/</span>b<span class="token operator">&gt;</span> <span class="token operator">+=</span> <span class="token string">&quot;&lt;/optgroup&gt;&quot;</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
          <span class="token dom variable">sessionStorage</span><span class="token punctuation">.</span><span class="token method function property-access">setItem</span><span class="token punctuation">(</span><span class="token string">&quot;mapas_arrEstaciones&quot;</span><span class="token punctuation">,</span> arrEstaciones<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token dom variable">sessionStorage</span><span class="token punctuation">.</span><span class="token method function property-access">setItem</span><span class="token punctuation">(</span><span class="token string">&quot;mapas_listaTags&quot;</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span>span style<span class="token operator">=</span><span class="token string">&apos;color:gold&apos;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>b<span class="token operator">&gt;</span><span class="token constant">JS</span><span class="token operator">&lt;</span><span class="token operator">/</span>b<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">&gt;</span><span class="token constant">ON</span><span class="token punctuation">.</span><span class="token method function property-access">stringify</span><span class="token punctuation">(</span>listaTags<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token dom variable">sessionStorage</span><span class="token punctuation">.</span><span class="token method function property-access">setItem</span><span class="token punctuation">(</span><span class="token string">&quot;mapas_sel&quot;</span><span class="token punctuation">,</span> sel<span class="token punctuation">.</span><span class="token property-access">inner</span><span class="token operator">&lt;</span>b<span class="token operator">&gt;</span><span class="token constant">HTML</span><span class="token operator">&lt;</span><span class="token operator">/</span>b<span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token function-variable function">error</span><span class="token operator">:</span> <span class="token keyword keyword-function">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">&quot;error de ajustes&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        dataType<span class="token operator">:</span> <span class="token string">&quot;json&quot;</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</pre><h4>5.1.7.3 FUNCI&#xD3;N <strong>confirmarAjusteswidget()</strong></h4>
<blockquote>
<p><span style="color:green">@params</span> <b>String</b> wid</p>
</blockquote>
<blockquote>
<p><span style="color:green">@returns</span> <b>HTML</b></p>
</blockquote>
<p>Esta funci&#xF3;n hace una petici&#xF3;n a servidor por Ajax a trav&#xE9;s de A_Principal.php para guardar la configuraci&#xF3;n de un widget en la secci&#xF3;n principal una vez configurado por el usuario.</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript">  <span class="token function">$</span><span class="token punctuation">(</span><span class="token dom variable">document</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">ready</span><span class="token punctuation">(</span><span class="token keyword keyword-function">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    $<span class="token punctuation">.</span><span class="token method function property-access">ajax</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      type<span class="token operator">:</span> <span class="token string">&quot;POST&quot;</span><span class="token punctuation">,</span>
      url<span class="token operator">:</span> <span class="token string">&quot;/&lt;span style=&apos;color:darkblue;&apos;&gt;&lt;b&gt;Aquando&lt;/b&gt;&lt;/span&gt;.com/A_Principal.php&quot;</span><span class="token punctuation">,</span>
      data<span class="token operator">:</span> <span class="token punctuation">{</span> opcion<span class="token operator">:</span> <span class="token string">&quot;confirmar&quot;</span><span class="token punctuation">,</span> wid<span class="token operator">:</span> widget<span class="token punctuation">,</span> tag<span class="token operator">:</span> tag<span class="token punctuation">,</span> usu<span class="token operator">:</span> usu <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token keyword keyword-function">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;seccionAjustes&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access">inner</span><span class="token operator">&lt;</span>b<span class="token operator">&gt;</span><span class="token constant">HTML</span><span class="token operator">&lt;</span><span class="token operator">/</span>b<span class="token operator">&gt;</span> <span class="token operator">+=</span>
          <span class="token string">&quot;&lt;br&gt;&lt;div id=&apos;ajustesRespuesta&apos;&gt;widget configurado con &#xE9;xito&lt;/div&gt;&quot;</span><span class="token punctuation">;</span>
        <span class="token dom variable">sessionStorage</span><span class="token punctuation">.</span><span class="token method function property-access">setItem</span><span class="token punctuation">(</span><span class="token string">&quot;feed_usu&quot;</span><span class="token punctuation">,</span> <span class="token keyword null nil keyword-null">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token dom variable">sessionStorage</span><span class="token punctuation">.</span><span class="token method function property-access">setItem</span><span class="token punctuation">(</span><span class="token string">&quot;mapas_arrEstaciones&quot;</span><span class="token punctuation">,</span> <span class="token keyword null nil keyword-null">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">feedPrincipalCustom</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token function-variable function">error</span><span class="token operator">:</span> <span class="token keyword keyword-function">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">&quot;error de confirmaci&#xF3;n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>

    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><h4>5.1.7.4 FUNCI&#xD3;N <strong>feedPrincipalCustom()</strong></h4>
<blockquote>
<p><span style="color:green">@params</span> Void</p>
</blockquote>
<blockquote>
<p><span style="color:green">@returns</span> <span style="color:gold"><b>JS</b></span>ON</p>
</blockquote>
<p>Esta funci&#xF3;n hace una petici&#xF3;n a servidor por Ajax a trav&#xE9;s de A_Principal.php para obtener los datos (anal&#xF3;gicos) de los widgets personalizados del usuario.</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript">    <span class="token function">$</span><span class="token punctuation">(</span><span class="token dom variable">document</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">ready</span><span class="token punctuation">(</span><span class="token keyword keyword-function">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      $<span class="token punctuation">.</span><span class="token method function property-access">ajax</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        type<span class="token operator">:</span> <span class="token string">&quot;POST&quot;</span><span class="token punctuation">,</span>
        url<span class="token operator">:</span> <span class="token string">&quot;/&lt;span style=&apos;color:darkblue;&apos;&gt;&lt;b&gt;Aquando&lt;/b&gt;&lt;/span&gt;.com/A_Principal.php&quot;</span><span class="token punctuation">,</span>
        data<span class="token operator">:</span> <span class="token punctuation">{</span> opcion<span class="token operator">:</span> <span class="token string">&quot;feed&quot;</span><span class="token punctuation">,</span> usu<span class="token operator">:</span> usu <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token keyword keyword-function">function</span> <span class="token punctuation">(</span><span class="token parameter">feedAna</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token dom variable">sessionStorage</span><span class="token punctuation">.</span><span class="token method function property-access">setItem</span><span class="token punctuation">(</span><span class="token string">&quot;feed_usu&quot;</span><span class="token punctuation">,</span> usu<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token dom variable">sessionStorage</span><span class="token punctuation">.</span><span class="token method function property-access">setItem</span><span class="token punctuation">(</span><span class="token string">&quot;feed_feedAna&quot;</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span>span style<span class="token operator">=</span><span class="token string">&apos;color:gold&apos;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>b<span class="token operator">&gt;</span><span class="token constant">JS</span><span class="token operator">&lt;</span><span class="token operator">/</span>b<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">&gt;</span><span class="token constant">ON</span><span class="token punctuation">.</span><span class="token method function property-access">stringify</span><span class="token punctuation">(</span>feedAna<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token function">renderPrincipalCustom</span><span class="token punctuation">(</span>feedAna<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token function-variable function">error</span><span class="token operator">:</span> <span class="token keyword keyword-function">function</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">&quot;error feed principal analog&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        dataType<span class="token operator">:</span> <span class="token string">&quot;json&quot;</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><h4>5.1.7.5 FUNCI&#xD3;N <strong>actualizar()</strong> --&gt; obsoleto</h4>
<blockquote>
<p><span style="color:green">@params</span> Void</p>
</blockquote>
<blockquote>
<p><span style="color:green">@returns</span> <span style="color:gold"><b>JS</b></span>ON</p>
</blockquote>
<p>Esta funci&#xF3;n hace una petici&#xF3;n a servidor por Ajax a trav&#xE9;s de A_Principal.php para obtener los datos de los widgets digitales del usuario. Esta llamada ya no se realiza dado que la secci&#xF3;n de widgets digitales fu&#xE9; eliminada aunque no ha sido eliminada por la posibilidad de reimplementarla en un futuro.</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token function">$</span><span class="token punctuation">(</span><span class="token dom variable">document</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">ready</span><span class="token punctuation">(</span><span class="token keyword keyword-function">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  $<span class="token punctuation">.</span><span class="token method function property-access">ajax</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    type<span class="token operator">:</span> <span class="token string">&quot;POST&quot;</span><span class="token punctuation">,</span>
    url<span class="token operator">:</span> <span class="token string">&quot;/&lt;span style=&apos;color:darkblue;&apos;&gt;&lt;b&gt;Aquando&lt;/b&gt;&lt;/span&gt;.com/A_Principal.php&quot;</span><span class="token punctuation">,</span>
    data<span class="token operator">:</span> <span class="token punctuation">{</span>
      opcion<span class="token operator">:</span> <span class="token string">&quot;refresh&quot;</span><span class="token punctuation">,</span>
      arrdatos<span class="token operator">:</span> arrdatos<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token keyword keyword-function">function</span> <span class="token punctuation">(</span><span class="token parameter">feedDigi</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      feedDigital <span class="token operator">=</span> feedDigi<span class="token punctuation">;</span>
      <span class="token function">feedPrincipalCustom</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">renderFeedDigi</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function-variable function">error</span><span class="token operator">:</span> <span class="token keyword keyword-function">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">&quot;refresh error&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">feedPrincipalCustom</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    dataType<span class="token operator">:</span> <span class="token string">&quot;json&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><h2>5.1.8 <strong>sur.js</strong></h2>
<h4>5.1.8.1 FUNCI&#xD3;N <strong>actualizarSur()</strong></h4>
<blockquote>
<p><span style="color:green">@params</span> <b>String</b> entorno, <b>String</b> nombre, <b>INT</b> estacion</p>
</blockquote>
<blockquote>
<p>@return <b>HTML</b></p>
</blockquote>
<p>Esta funci&#xF3;n hace una petici&#xF3;n a servidor por Ajax a trav&#xE9;s de A_Sur.php para obtener las alarmas del men&#xFA; sur en algunas secciones. Dependiendo de la secci&#xF3;n hace una petici&#xF3;n para alarmas generales y en la secci&#xF3;n de estaci&#xF3;n hace una petici&#xF3;n distinta para obtener s&#xF3;lo las de la estaci&#xF3;n seleccionada.</p>
<p>General:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript">      <span class="token function">$</span><span class="token punctuation">(</span><span class="token dom variable">document</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">ready</span><span class="token punctuation">(</span><span class="token keyword keyword-function">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        $<span class="token punctuation">.</span><span class="token method function property-access">ajax</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
          type<span class="token operator">:</span> <span class="token string">&quot;POST&quot;</span><span class="token punctuation">,</span>
          url<span class="token operator">:</span> <span class="token string">&quot;/&lt;span style=&apos;color:darkblue;&apos;&gt;&lt;b&gt;Aquando&lt;/b&gt;&lt;/span&gt;.com/A_Sur.php&quot;</span><span class="token punctuation">,</span>
          data<span class="token operator">:</span> <span class="token punctuation">{</span> caso<span class="token operator">:</span> <span class="token string">&quot;general&quot;</span><span class="token punctuation">,</span> nombre<span class="token operator">:</span> nombre <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token keyword keyword-function">function</span> <span class="token punctuation">(</span><span class="token parameter">alarmas</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;alarmasSur&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access">inner</span><span class="token operator">&lt;</span>b<span class="token operator">&gt;</span><span class="token constant">HTML</span><span class="token operator">&lt;</span><span class="token operator">/</span>b<span class="token operator">&gt;</span> <span class="token operator">=</span> alarmas<span class="token punctuation">;</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token function-variable function">error</span><span class="token operator">:</span> <span class="token keyword keyword-function">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">&quot;error&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>Particular:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript">      <span class="token function">$</span><span class="token punctuation">(</span><span class="token dom variable">document</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">ready</span><span class="token punctuation">(</span><span class="token keyword keyword-function">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        $<span class="token punctuation">.</span><span class="token method function property-access">ajax</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
          type<span class="token operator">:</span> <span class="token string">&quot;POST&quot;</span><span class="token punctuation">,</span>
          url<span class="token operator">:</span> <span class="token string">&quot;/&lt;span style=&apos;color:darkblue;&apos;&gt;&lt;b&gt;Aquando&lt;/b&gt;&lt;/span&gt;.com/A_Sur.php&quot;</span><span class="token punctuation">,</span>
          data<span class="token operator">:</span> <span class="token punctuation">{</span> caso<span class="token operator">:</span> <span class="token string">&quot;estacion&quot;</span><span class="token punctuation">,</span> estacion<span class="token operator">:</span> estacion <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token keyword keyword-function">function</span> <span class="token punctuation">(</span><span class="token parameter">alarmas</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;alarmasSur&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access">inner</span><span class="token operator">&lt;</span>b<span class="token operator">&gt;</span><span class="token constant">HTML</span><span class="token operator">&lt;</span><span class="token operator">/</span>b<span class="token operator">&gt;</span> <span class="token operator">=</span> alarmas<span class="token punctuation">;</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token function-variable function">error</span><span class="token operator">:</span> <span class="token keyword keyword-function">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">&quot;error&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><hr>
<h2>5.2 <span style="color:red"><b>AJAX</b></span> (<span style="color:purple"><b>PHP</b></span>)</h2>
<p>Los archivos Ajax son mini-controladores dedicados en las secciones, que se encargan de recibir peticiones desde el lado cliente para hacer los procesos que requieran conexiones a bases de datos o tratar con informaci&#xF3;n sensible.<br>
De esta forma se agrega una capa de seguridad y conseguimos hacer procesos en tiempo real que requieran del servidor sin tener que recargar la p&#xE1;gina.</p>
<p>Estos archivos Ajax est&#xE1;n presentes en casi todas las secciones, como en la secci&#xF3;n principal, las vistas de estaci&#xF3;n, las secciones de gr&#xE1;ficas, secciones de alarmas, secci&#xF3;n de informes y en menor medida la de comunicaciones.</p>
<blockquote>
<p>Se comunican con el lado cliente a trav&#xE9;s de peticiones de m&#xF3;todo POST.</p>
</blockquote>
<p>(En &#xF3;rden alfab&#xE9;tico)</p>
<h3>5.2.1 <strong>A_Ajustes()</strong></h3>
<blockquote>
<p>requiere: <em>DataWit.php</em>, <em>Validador.php</em></p>
</blockquote>
<blockquote>
<p><span style="color:green">@params</span>: <b>String</b> opcion<br>
Este archivo Ajax est&#xE1; presente en la secci&#xF3;n de estaciones.<br>
Su uso es gestionar las consignas y plannings de una estaci&#xF3;n.</p>
</blockquote>
<p>Dependiendo del valor de <em>opcion</em> este podr&#xE1;: listar consignas, leer consignas,modificar consignas, listar plannings (WIP), leer plannings (WIP) y modificar plannings (WIP).</p>
<p>Al tener varias funciones aun en desarrollo, su c&#xF3;digo est&#xE1; sujeto a cambios y por lo tanto no se muestra en este documento hasta que est&#xE9; acabado.</p>
<pre data-role="codeBlock" data-info="php" class="language-php"><span class="token comment">// c&#xF3;digo no disponible</span>
</pre><h3>5.2.2 <strong>A_Alarmas.php</strong></h3>
<blockquote>
<p>requiere Database.php, Validador.php</p>
</blockquote>
<blockquote>
<p><span style="color:green">@params</span> <b>String</b> funcion</p>
</blockquote>
<p>Este archivo Ajax aparece s&#xF3;lo en la secci&#xF3;n de explorador de alarmas (no en el menu Sur) y se encarga de buscar las alarmas de un cliente en funci&#xF3;n de una serie de filtros. Tambi&#xE9;n es capaz de reconocer las alarmas y en algunos casos tambi&#xE9;n puede extraer detalles de estas. Crea el codigo <b>HTML</b> de la secci&#xF3;n.</p>
<pre data-role="codeBlock" data-info="php" class="language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token keyword keyword-require_once">require_once</span> <span class="token string single-quoted-string">&apos;../app/Database/Database.php&apos;</span><span class="token punctuation">;</span>
<span class="token keyword keyword-require">require</span> <span class="token string single-quoted-string">&apos;../app/Models/Validador.php&apos;</span><span class="token punctuation">;</span>
<span class="token variable">$db</span> <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token class-name">Database</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$vlr</span> <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token class-name">Validador</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token global">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;funcion&apos;</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string double-quoted-string">&quot;actualizar&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token variable">$nombre</span> <span class="token operator">=</span> <span class="token global">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;nombre&apos;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token variable">$emp</span> <span class="token operator">=</span> <span class="token global">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;emp&apos;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token variable">$orden</span> <span class="token operator">=</span> <span class="token global">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;orden&apos;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token variable">$sentido</span> <span class="token operator">=</span> <span class="token global">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;sentido&apos;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token variable">$fechaIni</span> <span class="token operator">=</span> <span class="token global">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;fechaInicio&apos;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token variable">$fechaFin</span> <span class="token operator">=</span> <span class="token global">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;fechaFin&apos;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token variable">$vlr</span><span class="token operator">-&gt;</span><span class="token function">valFecha</span><span class="token punctuation">(</span><span class="token variable">$fechaFin</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token variable">$idusu</span> <span class="token operator">=</span> <span class="token variable">$db</span><span class="token operator">-&gt;</span><span class="token function">obtenerIdUsuario</span><span class="token punctuation">(</span><span class="token variable">$nombre</span><span class="token punctuation">,</span> <span class="token variable">$emp</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$alarmas</span> <span class="token operator">=</span> <span class="token variable">$db</span><span class="token operator">-&gt;</span><span class="token function">obtenerAlarmasUsuario</span><span class="token punctuation">(</span><span class="token variable">$idusu</span><span class="token punctuation">,</span> <span class="token variable">$orden</span><span class="token punctuation">,</span> <span class="token variable">$sentido</span><span class="token punctuation">,</span> <span class="token variable">$fechaIni</span><span class="token punctuation">,</span> <span class="token variable">$fechaFin</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$alarmasLimpio</span> <span class="token operator">=</span> <span class="token keyword keyword-array">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-foreach">foreach</span> <span class="token punctuation">(</span><span class="token variable">$alarmas</span> <span class="token keyword keyword-as">as</span> <span class="token variable">$estacion</span> <span class="token operator">=&gt;</span> <span class="token variable">$alarmas</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token variable">$alarmas</span> <span class="token operator">!=</span> <span class="token constant boolean">false</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token variable">$alarmasLimpio</span><span class="token punctuation">[</span><span class="token variable">$estacion</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$alarmas</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword keyword-echo">echo</span> <span class="token string double-quoted-string">&quot;&lt;tr&gt;
        &lt;th onclick=reordenar(&apos;estacion&apos;)&gt;Estacion&lt;/th&gt;
        &lt;th onclick=reordenar(&apos;senal&apos;)&gt;Indicador &lt;/th&gt;
        &lt;th onclick=reordenar(&apos;valor&apos;)&gt;Valor de la Indicador&lt;/th&gt;
        &lt;th onclick=reordenar(&apos;origenfecha&apos;)&gt;Fecha de Origen&lt;/th&gt;
        &lt;th onclick=reordenar(&apos;restauracionfecha&apos;)&gt;Fecha de Restauracion&lt;/th&gt;
        &lt;th onclick=reordenar(&apos;reconusu&apos;)&gt;Reconocida por&lt;/th&gt;
        &lt;th onclick=reordenar(&apos;reconfecha&apos;)&gt;Fecha de reconocimiento&lt;/th&gt;
        &lt;/tr&gt;&quot;</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-foreach">foreach</span> <span class="token punctuation">(</span><span class="token variable">$alarmasLimpio</span> <span class="token keyword keyword-as">as</span> <span class="token variable">$index</span> <span class="token operator">=&gt;</span> <span class="token variable">$alarma</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword keyword-switch">switch</span> <span class="token punctuation">(</span><span class="token variable">$alarma</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;estado&apos;</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword keyword-case">case</span> <span class="token number">1</span><span class="token punctuation">:</span>
                    <span class="token keyword keyword-echo">echo</span> <span class="token string double-quoted-string">&quot;&lt;tr class=&apos;activaNo&apos; &gt;&quot;</span><span class="token punctuation">;</span>
                    <span class="token keyword keyword-break">break</span><span class="token punctuation">;</span>
                <span class="token keyword keyword-case">case</span> <span class="token number">2</span><span class="token punctuation">:</span>
                    <span class="token keyword keyword-echo">echo</span> <span class="token string double-quoted-string">&quot;&lt;tr class=&apos;restNo&apos;&gt;&quot;</span><span class="token punctuation">;</span>
                    <span class="token keyword keyword-break">break</span><span class="token punctuation">;</span>
                <span class="token keyword keyword-case">case</span> <span class="token number">3</span><span class="token punctuation">:</span>
                    <span class="token keyword keyword-echo">echo</span> <span class="token string double-quoted-string">&quot;&lt;tr class=&apos;activaSi&apos;&gt;&quot;</span><span class="token punctuation">;</span>
                    <span class="token keyword keyword-break">break</span><span class="token punctuation">;</span>
                <span class="token keyword keyword-case">case</span> <span class="token number">4</span><span class="token punctuation">:</span>
                    <span class="token keyword keyword-echo">echo</span> <span class="token string double-quoted-string">&quot;&lt;tr class=&apos;restSi&apos;&gt;&quot;</span><span class="token punctuation">;</span>
                    <span class="token keyword keyword-break">break</span><span class="token punctuation">;</span>
                <span class="token keyword keyword-default">default</span><span class="token punctuation">:</span>
                    <span class="token keyword keyword-break">break</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword keyword-foreach">foreach</span> <span class="token punctuation">(</span><span class="token variable">$alarma</span> <span class="token keyword keyword-as">as</span> <span class="token variable">$dato</span> <span class="token operator">=&gt;</span> <span class="token variable">$valor</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token variable">$dato</span> <span class="token operator">!=</span> <span class="token string single-quoted-string">&apos;estado&apos;</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$dato</span> <span class="token operator">!=</span> <span class="token string single-quoted-string">&apos;id_alarmas&apos;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword keyword-switch">switch</span> <span class="token punctuation">(</span><span class="token variable">$dato</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token keyword keyword-case">case</span> <span class="token string single-quoted-string">&apos;valor_alarma&apos;</span><span class="token punctuation">:</span>
                            <span class="token keyword keyword-echo">echo</span> <span class="token string double-quoted-string">&quot;&lt;td&gt;&quot;</span><span class="token punctuation">;</span>
                            <span class="token keyword keyword-echo">echo</span> <span class="token variable">$valor</span><span class="token punctuation">;</span>


                            <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&apos;~[0-9]+~&apos;</span><span class="token punctuation">,</span> <span class="token variable">$alarma</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;valor_alarma&apos;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                                <span class="token keyword keyword-echo">echo</span> <span class="token string single-quoted-string">&apos;&lt;i class=&quot;fas fa-chart-bar&quot; style=&quot;opacity:100%;color:rgb(1,168,184)&quot; onclick=&quot;detallesAlarma(&apos;</span> <span class="token operator">.</span> <span class="token variable">$alarma</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;id_alarmas&apos;</span><span class="token punctuation">]</span> <span class="token operator">.</span> <span class="token string single-quoted-string">&apos;)&quot;&gt;&lt;/i&gt;&apos;</span><span class="token punctuation">;</span>
                            <span class="token punctuation">}</span>
                            <span class="token keyword keyword-echo">echo</span> <span class="token string double-quoted-string">&quot;&lt;/td&gt;&quot;</span><span class="token punctuation">;</span>
                            <span class="token keyword keyword-break">break</span><span class="token punctuation">;</span>
                        <span class="token keyword keyword-case">case</span> <span class="token string single-quoted-string">&apos;ack_por&apos;</span><span class="token punctuation">:</span>
                            <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token variable">$valor</span> <span class="token operator">==</span> <span class="token constant">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                                <span class="token keyword keyword-echo">echo</span> <span class="token string double-quoted-string">&quot;&lt;td&gt;&quot;</span><span class="token punctuation">;</span>
                                <span class="token keyword keyword-echo">echo</span> <span class="token string single-quoted-string">&apos;&lt;i class=&quot;fas fa-eye&quot; onclick=&quot;reconocer(&apos;</span> <span class="token operator">.</span> <span class="token variable">$alarma</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;id_alarmas&apos;</span><span class="token punctuation">]</span> <span class="token operator">.</span> <span class="token string single-quoted-string">&apos;)&quot;&gt;&lt;/i&gt;&apos;</span><span class="token punctuation">;</span>
                                <span class="token keyword keyword-echo">echo</span> <span class="token string double-quoted-string">&quot;&lt;/td&gt;&quot;</span><span class="token punctuation">;</span>
                            <span class="token punctuation">}</span> <span class="token keyword keyword-else">else</span> <span class="token punctuation">{</span>
                                <span class="token keyword keyword-echo">echo</span> <span class="token string double-quoted-string">&quot;&lt;td&gt;&quot;</span><span class="token punctuation">;</span>
                                <span class="token keyword keyword-echo">echo</span> <span class="token variable">$valor</span><span class="token punctuation">;</span>
                                <span class="token keyword keyword-echo">echo</span> <span class="token string double-quoted-string">&quot;&lt;/td&gt;&quot;</span><span class="token punctuation">;</span>
                            <span class="token punctuation">}</span>
                            <span class="token keyword keyword-break">break</span><span class="token punctuation">;</span>
                        <span class="token keyword keyword-default">default</span><span class="token punctuation">:</span>
                            <span class="token keyword keyword-echo">echo</span> <span class="token string double-quoted-string">&quot;&lt;td&gt;&quot;</span><span class="token punctuation">;</span>
                            <span class="token keyword keyword-echo">echo</span> <span class="token variable">$valor</span><span class="token punctuation">;</span>
                            <span class="token keyword keyword-echo">echo</span> <span class="token string double-quoted-string">&quot;&lt;/td&gt;&quot;</span><span class="token punctuation">;</span>
                            <span class="token keyword keyword-break">break</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            <span class="token keyword keyword-echo">echo</span> <span class="token string double-quoted-string">&quot;&lt;/tr&gt;&quot;</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword keyword-else">else</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-echo">echo</span> <span class="token string double-quoted-string">&quot;&lt;p&gt;fechas no validas&lt;/p&gt;&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token global">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;funcion&apos;</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string double-quoted-string">&quot;estacion&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token variable">$orden</span> <span class="token operator">=</span> <span class="token global">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;orden&apos;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token variable">$sentido</span> <span class="token operator">=</span> <span class="token global">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;sentido&apos;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token variable">$fechaIni</span> <span class="token operator">=</span> <span class="token global">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;fechaInicio&apos;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token variable">$fechaFin</span> <span class="token operator">=</span> <span class="token global">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;fechaFin&apos;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token variable">$id_estacion</span> <span class="token operator">=</span> <span class="token global">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;estacion&apos;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token variable">$alarmasEstacion</span> <span class="token operator">=</span> <span class="token variable">$db</span><span class="token operator">-&gt;</span><span class="token function">obtenerAlarmasEstacion</span><span class="token punctuation">(</span><span class="token variable">$id_estacion</span><span class="token punctuation">,</span> <span class="token variable">$orden</span><span class="token punctuation">,</span> <span class="token variable">$sentido</span><span class="token punctuation">,</span> <span class="token constant">null</span><span class="token punctuation">,</span> <span class="token constant">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token variable">$alarmasEstacion</span> <span class="token operator">!=</span> <span class="token constant boolean">false</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token variable">$alarmasEstacionLimpio</span> <span class="token operator">=</span> <span class="token keyword keyword-array">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-foreach">foreach</span> <span class="token punctuation">(</span><span class="token variable">$alarmasEstacion</span> <span class="token keyword keyword-as">as</span> <span class="token variable">$alarma</span> <span class="token operator">=&gt;</span> <span class="token variable">$datos</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token variable">$alarma</span> <span class="token operator">!=</span> <span class="token constant boolean">false</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token variable">$alarmasEstacionLimpio</span><span class="token punctuation">[</span><span class="token variable">$alarma</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$datos</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword keyword-echo">echo</span> <span class="token string double-quoted-string">&quot;&lt;tr&gt;
            &lt;th onclick=reordenar(&apos;estacion&apos;)&gt;Estacion&lt;/th&gt;
        &lt;th onclick=reordenar(&apos;senal&apos;)&gt;Indicador&lt;/th&gt;
        &lt;th onclick=reordenar(&apos;valor&apos;)&gt;Valor de Indicador&lt;/th&gt;
        &lt;th onclick=reordenar(&apos;origenfecha&apos;)&gt;Fecha de Origen&lt;/th&gt;
        &lt;th onclick=reordenar(&apos;restauracionfecha&apos;)&gt;Fecha de Restauracion&lt;/th&gt;
        &lt;th onclick=reordenar(&apos;reconusu&apos;)&gt;Reconocida por&lt;/th&gt;
        &lt;th onclick=reordenar(&apos;reconfecha&apos;)&gt;Fecha de reconocimiento&lt;/th&gt;
            &lt;/tr&gt;&quot;</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-foreach">foreach</span> <span class="token punctuation">(</span><span class="token variable">$alarmasEstacionLimpio</span> <span class="token keyword keyword-as">as</span> <span class="token variable">$alarma</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

            <span class="token keyword keyword-switch">switch</span> <span class="token punctuation">(</span><span class="token variable">$alarma</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;estado&apos;</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword keyword-case">case</span> <span class="token number">1</span><span class="token punctuation">:</span>
                    <span class="token keyword keyword-echo">echo</span> <span class="token string double-quoted-string">&quot;&lt;tr class=&apos;activaNo&apos; &gt;&quot;</span><span class="token punctuation">;</span>

                    <span class="token keyword keyword-break">break</span><span class="token punctuation">;</span>
                <span class="token keyword keyword-case">case</span> <span class="token number">2</span><span class="token punctuation">:</span>
                    <span class="token keyword keyword-echo">echo</span> <span class="token string double-quoted-string">&quot;&lt;tr class=&apos;restNo&apos;&gt;&quot;</span><span class="token punctuation">;</span>

                    <span class="token keyword keyword-break">break</span><span class="token punctuation">;</span>
                <span class="token keyword keyword-case">case</span> <span class="token number">3</span><span class="token punctuation">:</span>
                    <span class="token keyword keyword-echo">echo</span> <span class="token string double-quoted-string">&quot;&lt;tr class=&apos;activaSi&apos;&gt;&quot;</span><span class="token punctuation">;</span>

                    <span class="token keyword keyword-break">break</span><span class="token punctuation">;</span>
                <span class="token keyword keyword-case">case</span> <span class="token number">4</span><span class="token punctuation">:</span>
                    <span class="token keyword keyword-echo">echo</span> <span class="token string double-quoted-string">&quot;&lt;tr class=&apos;restSi&apos;&gt;&quot;</span><span class="token punctuation">;</span>
                    <span class="token keyword keyword-break">break</span><span class="token punctuation">;</span>

                <span class="token keyword keyword-default">default</span><span class="token punctuation">:</span>
                    <span class="token keyword keyword-break">break</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword keyword-foreach">foreach</span> <span class="token punctuation">(</span><span class="token variable">$alarma</span> <span class="token keyword keyword-as">as</span> <span class="token variable">$dato</span> <span class="token operator">=&gt;</span> <span class="token variable">$valor</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token variable">$dato</span> <span class="token operator">!=</span> <span class="token string single-quoted-string">&apos;estado&apos;</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$dato</span> <span class="token operator">!=</span> <span class="token string single-quoted-string">&apos;id_alarmas&apos;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword keyword-switch">switch</span> <span class="token punctuation">(</span><span class="token variable">$dato</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token keyword keyword-case">case</span> <span class="token string single-quoted-string">&apos;valor_alarma&apos;</span><span class="token punctuation">:</span>
                            <span class="token keyword keyword-echo">echo</span> <span class="token string double-quoted-string">&quot;&lt;td&gt;&quot;</span><span class="token punctuation">;</span>
                            <span class="token keyword keyword-echo">echo</span> <span class="token variable">$valor</span><span class="token punctuation">;</span>

                            <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&apos;~[0-9]+~&apos;</span><span class="token punctuation">,</span> <span class="token variable">$alarma</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;valor_alarma&apos;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                                <span class="token keyword keyword-echo">echo</span> <span class="token string single-quoted-string">&apos;&lt;i class=&quot;fas fa-chart-bar&quot; style=&quot;opacity:100%;color:rgb(1,168,184)&quot; onclick=&quot;detallesAlarma(&apos;</span> <span class="token operator">.</span> <span class="token variable">$alarma</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;id_alarmas&apos;</span><span class="token punctuation">]</span> <span class="token operator">.</span> <span class="token string single-quoted-string">&apos;)&quot;&gt;&lt;/i&gt;&apos;</span><span class="token punctuation">;</span>
                            <span class="token punctuation">}</span>
                            <span class="token keyword keyword-echo">echo</span> <span class="token string double-quoted-string">&quot;&lt;/td&gt;&quot;</span><span class="token punctuation">;</span>
                            <span class="token keyword keyword-break">break</span><span class="token punctuation">;</span>
                        <span class="token keyword keyword-case">case</span> <span class="token string single-quoted-string">&apos;ack_por&apos;</span><span class="token punctuation">:</span>
                            <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token variable">$valor</span> <span class="token operator">==</span> <span class="token constant">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                                <span class="token keyword keyword-echo">echo</span> <span class="token string double-quoted-string">&quot;&lt;td&gt;&quot;</span><span class="token punctuation">;</span>
                                <span class="token keyword keyword-echo">echo</span> <span class="token string single-quoted-string">&apos;&lt;i class=&quot;fas fa-eye&quot; onclick=&quot;reconocer(&apos;</span> <span class="token operator">.</span> <span class="token variable">$alarma</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;id_alarmas&apos;</span><span class="token punctuation">]</span> <span class="token operator">.</span> <span class="token string single-quoted-string">&apos;)&quot;&gt;&lt;/i&gt;&apos;</span><span class="token punctuation">;</span>
                                <span class="token keyword keyword-echo">echo</span> <span class="token string double-quoted-string">&quot;&lt;/td&gt;&quot;</span><span class="token punctuation">;</span>
                            <span class="token punctuation">}</span> <span class="token keyword keyword-else">else</span> <span class="token punctuation">{</span>
                                <span class="token keyword keyword-echo">echo</span> <span class="token string double-quoted-string">&quot;&lt;td&gt;&quot;</span><span class="token punctuation">;</span>
                                <span class="token keyword keyword-echo">echo</span> <span class="token variable">$valor</span><span class="token punctuation">;</span>
                                <span class="token keyword keyword-echo">echo</span> <span class="token string double-quoted-string">&quot;&lt;/td&gt;&quot;</span><span class="token punctuation">;</span>
                            <span class="token punctuation">}</span>
                            <span class="token keyword keyword-break">break</span><span class="token punctuation">;</span>
                        <span class="token keyword keyword-default">default</span><span class="token punctuation">:</span>
                            <span class="token keyword keyword-echo">echo</span> <span class="token string double-quoted-string">&quot;&lt;td&gt;&quot;</span><span class="token punctuation">;</span>
                            <span class="token keyword keyword-echo">echo</span> <span class="token variable">$valor</span><span class="token punctuation">;</span>
                            <span class="token keyword keyword-echo">echo</span> <span class="token string double-quoted-string">&quot;&lt;/td&gt;&quot;</span><span class="token punctuation">;</span>
                            <span class="token keyword keyword-break">break</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            <span class="token keyword keyword-echo">echo</span> <span class="token string double-quoted-string">&quot;&lt;/tr&gt;&quot;</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token global">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;funcion&apos;</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string double-quoted-string">&quot;reconocer&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token variable">$nombre</span> <span class="token operator">=</span> <span class="token global">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;nombre&apos;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token variable">$id_alarma</span> <span class="token operator">=</span> <span class="token global">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;alarma&apos;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token variable">$hora</span> <span class="token operator">=</span> <span class="token function">date</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&apos;Y/m/d H:i:s&apos;</span><span class="token punctuation">,</span> <span class="token function">time</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$recon</span> <span class="token operator">=</span> <span class="token variable">$db</span><span class="token operator">-&gt;</span><span class="token function">reconocerAlarma</span><span class="token punctuation">(</span><span class="token variable">$id_alarma</span><span class="token punctuation">,</span> <span class="token variable">$nombre</span><span class="token punctuation">,</span> <span class="token variable">$hora</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token variable">$recon</span> <span class="token operator">!=</span> <span class="token constant boolean">false</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-echo">echo</span> <span class="token string double-quoted-string">&quot;bien&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword keyword-else">else</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-echo">echo</span> <span class="token string double-quoted-string">&quot;fallo al reconocer la alarma&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token global">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;funcion&apos;</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string double-quoted-string">&quot;detalles&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token variable">$id</span> <span class="token operator">=</span> <span class="token global">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;id&apos;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token variable">$detalles</span> <span class="token operator">=</span> <span class="token variable">$db</span><span class="token operator">-&gt;</span><span class="token function">obtenerDetallesAlarma</span><span class="token punctuation">(</span><span class="token variable">$id</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token variable">$detalles</span> <span class="token operator">!=</span> <span class="token constant boolean">false</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-echo">echo</span> <span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token variable">$detalles</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword keyword-else">else</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-echo">echo</span> <span class="token string single-quoted-string">&apos; error extrayendo detalles (origen no historizable)&apos;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</pre><h3>5.2.3 <strong>A_Conexiones.php</strong></h3>
<blockquote>
<p>requiere Database.php, Validador.php</p>
</blockquote>
<blockquote>
<p><span style="color:green">@params</span> <b>String</b> opcion</p>
</blockquote>
<p>Este archivo complementa la secci&#xF3;n de comunicaciones y sus funciones son tan solo buscar las ultimas conexiones de las distintas estaciones que tenga un usuario y algunos detalles mas. Crea el <b>HTML</b> de la secci&#xF3;n.</p>
<pre data-role="codeBlock" data-info="php" class="language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token keyword keyword-require_once">require_once</span> <span class="token string single-quoted-string">&apos;../app/Database/Database.php&apos;</span><span class="token punctuation">;</span>
<span class="token keyword keyword-require">require</span> <span class="token string single-quoted-string">&apos;../app/Models/Validador.php&apos;</span><span class="token punctuation">;</span>
<span class="token variable">$opcion</span> <span class="token operator">=</span> <span class="token global">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;opcion&apos;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token variable">$db</span> <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token class-name">Database</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token variable">$opcion</span> <span class="token operator">==</span> <span class="token string single-quoted-string">&apos;conex&apos;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token variable">$nombre</span> <span class="token operator">=</span> <span class="token global">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;nombre&apos;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token variable">$pwd</span> <span class="token operator">=</span> <span class="token global">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;pwd&apos;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token variable">$estaciones</span> <span class="token operator">=</span> <span class="token variable">$db</span><span class="token operator">-&gt;</span><span class="token function">mostrarEstacionesCliente</span><span class="token punctuation">(</span><span class="token variable">$nombre</span><span class="token punctuation">,</span> <span class="token variable">$pwd</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$ultimasConexiones</span> <span class="token operator">=</span> <span class="token keyword keyword-array">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-foreach">foreach</span> <span class="token punctuation">(</span><span class="token variable">$estaciones</span> <span class="token keyword keyword-as">as</span> <span class="token variable">$estacion</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token variable">$ultimasConexiones</span><span class="token punctuation">[</span><span class="token variable">$estacion</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;nombre_estacion&apos;</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$db</span><span class="token operator">-&gt;</span><span class="token function">ultimaComunicacionEstacion</span><span class="token punctuation">(</span><span class="token variable">$estacion</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;id_estacion&apos;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword keyword-foreach">foreach</span> <span class="token punctuation">(</span><span class="token variable">$ultimasConexiones</span> <span class="token keyword keyword-as">as</span> <span class="token variable">$estacion</span> <span class="token operator">=&gt;</span> <span class="token variable">$datos</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-foreach">foreach</span> <span class="token punctuation">(</span><span class="token variable">$datos</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token keyword keyword-as">as</span> <span class="token variable">$dato</span> <span class="token operator">=&gt;</span> <span class="token variable">$valor</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token variable">$dato</span> <span class="token operator">==</span> <span class="token string single-quoted-string">&apos;valor_date&apos;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token variable">$valor</span> <span class="token operator">!=</span> <span class="token constant">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token variable">$ultima</span> <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token class-name">DateTime</span><span class="token punctuation">;</span>
                    <span class="token variable">$ultima</span> <span class="token operator">=</span> <span class="token scope">DateTime<span class="token punctuation">::</span></span><span class="token function">createFromFormat</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&apos;Y-m-d H:i:s&apos;</span><span class="token punctuation">,</span> <span class="token variable">$valor</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token variable">$ahora</span> <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token class-name">DateTime</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;now&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token variable">$dif</span> <span class="token operator">=</span> <span class="token variable">$ahora</span><span class="token operator">-&gt;</span><span class="token function">diff</span><span class="token punctuation">(</span><span class="token variable">$ultima</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token variable">$ultimasConexiones</span><span class="token punctuation">[</span><span class="token variable">$estacion</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;estado&apos;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;correcto&quot;</span><span class="token punctuation">;</span>
                    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token variable">$dif</span><span class="token operator">-&gt;</span><span class="token property">days</span> <span class="token operator">&gt;=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token variable">$ultimasConexiones</span><span class="token punctuation">[</span><span class="token variable">$estacion</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;estado&apos;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;aviso&quot;</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token variable">$dif</span><span class="token operator">-&gt;</span><span class="token property">days</span> <span class="token operator">&gt;=</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token variable">$ultimasConexiones</span><span class="token punctuation">[</span><span class="token variable">$estacion</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;estado&apos;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;error&quot;</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span> <span class="token keyword keyword-else">else</span> <span class="token punctuation">{</span>
                    <span class="token variable">$ultimasConexiones</span><span class="token punctuation">[</span><span class="token variable">$estacion</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;estado&apos;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;aviso&quot;</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword keyword-foreach">foreach</span> <span class="token punctuation">(</span><span class="token variable">$ultimasConexiones</span> <span class="token keyword keyword-as">as</span> <span class="token variable">$estacion</span> <span class="token operator">=&gt;</span> <span class="token variable">$datos</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-echo">echo</span> <span class="token string double-quoted-string">&quot;&lt;tr id=&apos;seccionEstacion&apos; name=&quot;</span> <span class="token operator">.</span> <span class="token variable">$datos</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;id_estacion&apos;</span><span class="token punctuation">]</span> <span class="token operator">.</span> <span class="token string double-quoted-string">&quot;&gt;&quot;</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-foreach">foreach</span> <span class="token punctuation">(</span><span class="token variable">$datos</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token keyword keyword-as">as</span> <span class="token variable">$dato</span> <span class="token operator">=&gt;</span> <span class="token variable">$valor</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token variable">$dato</span> <span class="token operator">==</span> <span class="token string single-quoted-string">&apos;nombre_estacion&apos;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword keyword-echo">echo</span> <span class="token string double-quoted-string">&quot;&lt;td id=&apos;secNombre&apos;&gt;&quot;</span><span class="token punctuation">;</span>
                <span class="token keyword keyword-echo">echo</span> <span class="token variable">$valor</span><span class="token punctuation">;</span>
                <span class="token keyword keyword-echo">echo</span> <span class="token string double-quoted-string">&quot;&lt;/td&gt;&quot;</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token variable">$dato</span> <span class="token operator">==</span> <span class="token string single-quoted-string">&apos;valor_date&apos;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token variable">$valor</span> <span class="token operator">!=</span> <span class="token constant">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword keyword-echo">echo</span> <span class="token string double-quoted-string">&quot;&lt;td id=&apos;secUltima&apos;&gt;&quot;</span><span class="token punctuation">;</span>
                    <span class="token keyword keyword-echo">echo</span> <span class="token string double-quoted-string">&quot;&#xDA;ltima conexi&#xF3;n: &quot;</span> <span class="token operator">.</span> <span class="token variable">$valor</span><span class="token punctuation">;</span>
                    <span class="token keyword keyword-echo">echo</span> <span class="token string double-quoted-string">&quot;&lt;/td&gt;&quot;</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword keyword-else">else</span> <span class="token punctuation">{</span>
                    <span class="token keyword keyword-echo">echo</span> <span class="token string double-quoted-string">&quot;&lt;td id=&apos;secUltima&apos;&gt;&quot;</span><span class="token punctuation">;</span>
                    <span class="token keyword keyword-echo">echo</span> <span class="token string double-quoted-string">&quot;&#xDA;ltima conexi&#xF3;n: desconocida&quot;</span><span class="token punctuation">;</span>
                    <span class="token keyword keyword-echo">echo</span> <span class="token string double-quoted-string">&quot;&lt;/td&gt;&quot;</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token variable">$dato</span> <span class="token operator">==</span> <span class="token string single-quoted-string">&apos;nombre_tag&apos;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token punctuation">}</span>
            <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token variable">$dato</span> <span class="token operator">==</span> <span class="token string single-quoted-string">&apos;id_estacion&apos;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token punctuation">}</span>
            <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token variable">$dato</span> <span class="token operator">==</span> <span class="token string single-quoted-string">&apos;estado&apos;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token variable">$valor</span> <span class="token operator">==</span> <span class="token string double-quoted-string">&quot;correcto&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword keyword-echo">echo</span> <span class="token string double-quoted-string">&quot;&lt;td id=&apos;secEstado&apos;&gt;&lt;i class=&apos;fas fa-check&apos;&gt;&lt;/i&gt;&lt;/td&gt;&quot;</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token variable">$valor</span> <span class="token operator">==</span> <span class="token string double-quoted-string">&quot;error&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword keyword-echo">echo</span> <span class="token string double-quoted-string">&quot;&lt;td id=&apos;secProblema&apos; class=&apos;&apos; style=&apos;color:tomato&apos;&gt;&lt;i name=&apos;alerta&apos; class=&apos;fas fa-exclamation-triangle alerta&apos;&gt;&lt;/i&gt;&lt;/td&gt;&quot;</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token variable">$valor</span> <span class="token operator">==</span> <span class="token string double-quoted-string">&quot;aviso&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword keyword-echo">echo</span> <span class="token string double-quoted-string">&quot;&lt;td id=&apos;secProblema&apos;&gt;&lt;i name=&apos;alerta&apos; class=&apos;fas fa-exclamation-triangle alerta&apos;&gt;&lt;/i&gt;&lt;/td&gt;&quot;</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword keyword-echo">echo</span> <span class="token string double-quoted-string">&quot;&lt;/tr&gt;&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token variable">$opcion</span> <span class="token operator">==</span> <span class="token string single-quoted-string">&apos;nom&apos;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token variable">$id_estacion</span> <span class="token operator">=</span> <span class="token global">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;estacion&apos;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token variable">$estacion</span> <span class="token operator">=</span> <span class="token variable">$db</span><span class="token operator">-&gt;</span><span class="token function">obtenerNombreEstacion</span><span class="token punctuation">(</span><span class="token variable">$id_estacion</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-echo">echo</span> <span class="token punctuation">(</span><span class="token variable">$estacion</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;nombre_estacion&apos;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</pre><h3>5.2.4 <strong>A_Estacion.php</strong></h3>
<blockquote>
<p>requiere Database.php</p>
</blockquote>
<blockquote>
<p>@ params <b>String</b> opcion, <b>INT</b> id_estacion, <b>String</b> tipo (opcional)</p>
</blockquote>
<p>Este archivo se usa en las vistas de estaci&#xF3;n y dependiendo de la peticion este archivo extrae datos est&#xE1;ticos de estaciones (nombre, ubicaci&#xF3;n, se&#xF1;ales etc) y extrae tambi&#xE9;n valores en tiempo real de estas. Los resultados los devuelve en formato <span style="color:gold"><b>JS</b></span>ON.</p>
<pre data-role="codeBlock" data-info="php" class="language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token keyword keyword-require_once">require_once</span> <span class="token string single-quoted-string">&apos;../app/Database/Database.php&apos;</span><span class="token punctuation">;</span>
<span class="token variable">$DB</span> <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token class-name">Database</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$opcion</span> <span class="token operator">=</span> <span class="token global">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;opcion&apos;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token variable">$id_estacion</span> <span class="token operator">=</span> <span class="token global">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;estacion&apos;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token variable">$tipo</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;&quot;</span><span class="token punctuation">;</span>
<span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token keyword keyword-isset">isset</span><span class="token punctuation">(</span><span class="token global">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;tipo&apos;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token variable">$tipo</span> <span class="token operator">=</span> <span class="token global">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;tipo&apos;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token variable">$opcion</span> <span class="token operator">==</span> <span class="token string single-quoted-string">&apos;actualizar&apos;</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$tipo</span> <span class="token operator">==</span> <span class="token string single-quoted-string">&apos;todos&apos;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-try">try</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-echo">echo</span> <span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token variable">$DB</span><span class="token operator">-&gt;</span><span class="token function">datosEstacion</span><span class="token punctuation">(</span><span class="token variable">$id_estacion</span><span class="token punctuation">,</span> <span class="token constant boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword keyword-catch">catch</span> <span class="token punctuation">(</span><span class="token class-name">Throwable</span> <span class="token variable">$e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-echo">echo</span> <span class="token variable">$e</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token variable">$opcion</span> <span class="token operator">==</span> <span class="token string single-quoted-string">&apos;trends&apos;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token variable">$datosAnalog</span> <span class="token operator">=</span> <span class="token function">json_decode</span><span class="token punctuation">(</span><span class="token global">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;arrTags&apos;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$trendsEstacion</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-foreach">foreach</span> <span class="token punctuation">(</span><span class="token variable">$datosAnalog</span> <span class="token keyword keyword-as">as</span> <span class="token variable">$indexTag</span> <span class="token operator">=&gt;</span> <span class="token variable">$datosTag</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token variable">$indexTag</span> <span class="token operator">!=</span> <span class="token constant">null</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$datosTag</span> <span class="token operator">!=</span> <span class="token constant">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token variable">$tag</span> <span class="token operator">=</span> <span class="token variable">$datosTag</span><span class="token operator">-&gt;</span><span class="token property">id_tag</span><span class="token punctuation">;</span>
            <span class="token variable">$trend</span> <span class="token operator">=</span> <span class="token variable">$DB</span><span class="token operator">-&gt;</span><span class="token function">tagTrend</span><span class="token punctuation">(</span><span class="token variable">$tag</span><span class="token punctuation">,</span> <span class="token variable">$id_estacion</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token variable">$trend</span> <span class="token operator">!=</span> <span class="token keyword type-declaration keyword-null">null</span> <span class="token operator">||</span> <span class="token operator">!</span><span class="token keyword keyword-empty">empty</span><span class="token punctuation">(</span><span class="token variable">$trend</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token variable">$trendFilt</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
                <span class="token keyword keyword-foreach">foreach</span> <span class="token punctuation">(</span><span class="token variable">$trend</span> <span class="token keyword keyword-as">as</span> <span class="token variable">$index</span> <span class="token operator">=&gt;</span> <span class="token variable">$valores</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword keyword-foreach">foreach</span> <span class="token punctuation">(</span><span class="token variable">$valores</span> <span class="token keyword keyword-as">as</span> <span class="token variable">$nombre</span> <span class="token operator">=&gt;</span> <span class="token variable">$valor</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token variable">$valor</span> <span class="token operator">!=</span> <span class="token constant">null</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$nombre</span> <span class="token operator">!=</span> <span class="token string single-quoted-string">&apos;fecha&apos;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                            <span class="token variable">$trendFilt</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;max&apos;</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$valor</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>
                        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token variable">$nombre</span> <span class="token operator">==</span> <span class="token string single-quoted-string">&apos;fecha&apos;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                            <span class="token variable">$trendFilt</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;fecha&apos;</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$valor</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
                <span class="token variable">$trendsEstacion</span><span class="token punctuation">[</span><span class="token variable">$datosTag</span><span class="token operator">-&gt;</span><span class="token property">id_tag</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$trendFilt</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword keyword-echo">echo</span> <span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token variable">$trendsEstacion</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token variable">$opcion</span> <span class="token operator">==</span> <span class="token string single-quoted-string">&apos;foto&apos;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token variable">$foto</span> <span class="token operator">=</span> <span class="token variable">$DB</span><span class="token operator">-&gt;</span><span class="token function">obtenerFotoEstacion</span><span class="token punctuation">(</span><span class="token variable">$id_estacion</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-echo">echo</span> <span class="token variable">$foto</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token variable">$opcion</span> <span class="token operator">==</span> <span class="token string single-quoted-string">&apos;t_trend&apos;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token variable">$datosAnalog</span> <span class="token operator">=</span> <span class="token function">json_decode</span><span class="token punctuation">(</span><span class="token global">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;arrTags&apos;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$datosTrends</span> <span class="token operator">=</span> <span class="token variable">$DB</span><span class="token operator">-&gt;</span><span class="token function">tagsTrends</span><span class="token punctuation">(</span><span class="token variable">$datosAnalog</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$arr</span> <span class="token operator">=</span> <span class="token keyword keyword-array">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$arrTrends</span> <span class="token operator">=</span> <span class="token keyword keyword-array">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-foreach">foreach</span> <span class="token punctuation">(</span><span class="token variable">$datosTrends</span> <span class="token keyword keyword-as">as</span> <span class="token variable">$key</span> <span class="token operator">=&gt;</span> <span class="token variable">$item</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token variable">$arr</span><span class="token punctuation">[</span><span class="token variable">$item</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;id_tag&apos;</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token variable">$key</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$item</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">ksort</span><span class="token punctuation">(</span><span class="token variable">$arr</span><span class="token punctuation">,</span> <span class="token constant">SORT_NUMERIC</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-echo">echo</span> <span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token variable">$arr</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</pre><h3>5.2.5 <strong>A_Graficas.php</strong></h3>
<blockquote>
<p>requiere Database.php</p>
</blockquote>
<blockquote>
<p><span style="color:green">@params</span> <b>String</b> opcion, <b>INT</b> id_estacion, <b>INT</b> tag (opcional)</p>
</blockquote>
<p>Este archivo se usa en la secci&#xF3;n de vista r&#xE1;pida en las gr&#xE1;ficas. Recolecta las se&#xF1;ales disponibles de las distintas estaciones de un usuario y tambi&#xE9;n los valores de estas y sus calculados en funci&#xF3;n de varios par&#xE1;metros. Los resultados los devuelve en formato <span style="color:gold"><b>JS</b></span>ON.</p>
<pre data-role="codeBlock" data-info="php" class="language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token keyword keyword-require_once">require_once</span> <span class="token string single-quoted-string">&apos;../app/Database/Database.php&apos;</span><span class="token punctuation">;</span>
<span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token keyword keyword-isset">isset</span><span class="token punctuation">(</span><span class="token global">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;tag&apos;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token variable">$id_tag</span> <span class="token operator">=</span> <span class="token global">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;tag&apos;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token variable">$opcion</span> <span class="token operator">=</span> <span class="token global">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;opcion&apos;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token variable">$id_estacion</span> <span class="token operator">=</span> <span class="token global">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;estacion&apos;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token variable">$db</span> <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token class-name">Database</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token variable">$opcion</span> <span class="token operator">==</span> <span class="token string double-quoted-string">&quot;render&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token variable">$histos</span> <span class="token operator">=</span> <span class="token variable">$db</span><span class="token operator">-&gt;</span><span class="token function">historicosTagEstacion</span><span class="token punctuation">(</span><span class="token variable">$id_estacion</span><span class="token punctuation">,</span> <span class="token variable">$id_tag</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token variable">$histos</span> <span class="token operator">!=</span> <span class="token constant boolean">false</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-echo">echo</span> <span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token variable">$histos</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword keyword-else">else</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-echo">echo</span> <span class="token string double-quoted-string">&quot;error&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token variable">$opcion</span> <span class="token operator">==</span> <span class="token string double-quoted-string">&quot;tags&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token variable">$tags</span> <span class="token operator">=</span> <span class="token variable">$db</span><span class="token operator">-&gt;</span><span class="token function">tagsEstacion</span><span class="token punctuation">(</span><span class="token variable">$id_estacion</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token variable">$tags</span> <span class="token operator">!=</span> <span class="token constant boolean">false</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-echo">echo</span> <span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token variable">$tags</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword keyword-else">else</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-echo">echo</span> <span class="token string double-quoted-string">&quot;error&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token variable">$opcion</span> <span class="token operator">==</span> <span class="token string double-quoted-string">&quot;meta&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token variable">$metaDatos</span> <span class="token operator">=</span> <span class="token variable">$db</span><span class="token operator">-&gt;</span><span class="token function">metaTag</span><span class="token punctuation">(</span><span class="token variable">$id_tag</span><span class="token punctuation">,</span> <span class="token variable">$id_estacion</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token variable">$metaDatos</span> <span class="token operator">!=</span> <span class="token constant boolean">false</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-echo">echo</span> <span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token variable">$metaDatos</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword keyword-else">else</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-echo">echo</span> <span class="token string double-quoted-string">&quot;error&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</pre><h3>5.2.6 <strong>A_GraficasCustom.php</strong></h3>
<blockquote>
<p>requiere Database.php, Validador.php</p>
</blockquote>
<blockquote>
<p><span style="color:green">@params</span> <b>String</b> opcion</p>
</blockquote>
<p>Este archivo se usa en las secci&#xF3;n de vista personalizada en las gr&#xE1;ficas. Recolecta las se&#xF1;ales disponibles de las distintas estaciones de un usuario y tambi&#xE9;n los valores de estas y sus calculados en funci&#xF3;n de varios par&#xE1;metros. Tambi&#xE9;n gestiona los presets de los usuarios siendo capaz de leerlos, aplicarlos y modificarlos. Los resultados los devuelve en formato <span style="color:gold"><b>JS</b></span>ON.</p>
<pre data-role="codeBlock" data-info="php" class="language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token keyword keyword-require_once">require_once</span> <span class="token string single-quoted-string">&apos;../app/Database/Database.php&apos;</span><span class="token punctuation">;</span>
<span class="token keyword keyword-require">require</span> <span class="token string single-quoted-string">&apos;../app/Models/Validador.php&apos;</span><span class="token punctuation">;</span>

<span class="token variable">$db</span> <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token class-name">Database</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$vlr</span> <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token class-name">Validador</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$opcion</span> <span class="token operator">=</span> <span class="token global">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;opcion&apos;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token variable">$opcion</span> <span class="token operator">==</span> <span class="token string single-quoted-string">&apos;tag&apos;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token variable">$id_estacion</span> <span class="token operator">=</span> <span class="token global">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;estacion&apos;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token variable">$id_tag</span> <span class="token operator">=</span> <span class="token global">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;id_tag&apos;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token variable">$fechaIni</span> <span class="token operator">=</span> <span class="token global">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;fechaIni&apos;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token variable">$fechaFin</span> <span class="token operator">=</span> <span class="token global">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;fechaFin&apos;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token variable">$meta</span> <span class="token operator">=</span> <span class="token global">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;meta&apos;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token variable">$ajustesMeta</span> <span class="token operator">=</span> <span class="token function">explode</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;/&quot;</span><span class="token punctuation">,</span> <span class="token variable">$meta</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token variable">$vlr</span><span class="token operator">-&gt;</span><span class="token function">valFecha</span><span class="token punctuation">(</span><span class="token variable">$fechaIni</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$vlr</span><span class="token operator">-&gt;</span><span class="token function">valFecha</span><span class="token punctuation">(</span><span class="token variable">$fechaFin</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token variable">$info</span> <span class="token operator">=</span> <span class="token variable">$db</span><span class="token operator">-&gt;</span><span class="token function">historicosTagEstacionCustom</span><span class="token punctuation">(</span><span class="token variable">$id_estacion</span><span class="token punctuation">,</span> <span class="token variable">$id_tag</span><span class="token punctuation">,</span> <span class="token variable">$ajustesMeta</span><span class="token punctuation">,</span> <span class="token variable">$fechaIni</span><span class="token punctuation">,</span> <span class="token variable">$fechaFin</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-echo">echo</span> <span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token variable">$info</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword keyword-else">else</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-echo">echo</span> <span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;fechas no validas&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token variable">$opcion</span> <span class="token operator">==</span> <span class="token string single-quoted-string">&apos;guardar&apos;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token variable">$datosPreset</span> <span class="token operator">=</span> <span class="token function">json_decode</span><span class="token punctuation">(</span><span class="token global">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;arrDatosPreset&apos;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$usuario</span> <span class="token operator">=</span> <span class="token variable">$datosPreset</span><span class="token operator">-&gt;</span><span class="token property">usuario</span><span class="token punctuation">;</span>
        <span class="token variable">$nombre_preset</span> <span class="token operator">=</span> <span class="token variable">$datosPreset</span><span class="token operator">-&gt;</span><span class="token property">nombre</span><span class="token punctuation">;</span>
        <span class="token variable">$id_estacion</span> <span class="token operator">=</span> <span class="token variable">$datosPreset</span><span class="token operator">-&gt;</span><span class="token property">id_estacion</span><span class="token punctuation">;</span>
        <span class="token variable">$tags_colores</span> <span class="token operator">=</span> <span class="token variable">$datosPreset</span><span class="token operator">-&gt;</span><span class="token property">tags_colores</span><span class="token punctuation">;</span>
        <span class="token variable">$resultado</span> <span class="token operator">=</span> <span class="token variable">$db</span><span class="token operator">-&gt;</span><span class="token function">guardarPreset</span><span class="token punctuation">(</span><span class="token variable">$usuario</span><span class="token punctuation">,</span> <span class="token variable">$nombre_preset</span><span class="token punctuation">,</span> <span class="token variable">$id_estacion</span><span class="token punctuation">,</span> <span class="token variable">$tags_colores</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-echo">echo</span> <span class="token variable">$resultado</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token variable">$opcion</span> <span class="token operator">==</span> <span class="token string single-quoted-string">&apos;leerPresets&apos;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token variable">$datos</span> <span class="token operator">=</span> <span class="token function">json_decode</span><span class="token punctuation">(</span><span class="token global">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;arrdatos&apos;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$n_usuario</span> <span class="token operator">=</span> <span class="token variable">$datos</span><span class="token operator">-&gt;</span><span class="token property">nombre</span><span class="token punctuation">;</span>
    <span class="token variable">$id_usuario</span> <span class="token operator">=</span> <span class="token variable">$db</span><span class="token operator">-&gt;</span><span class="token function">obtenerIdUsuario</span><span class="token punctuation">(</span><span class="token variable">$n_usuario</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token variable">$id_usuario</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token variable">$presets</span> <span class="token operator">=</span> <span class="token variable">$db</span><span class="token operator">-&gt;</span><span class="token function">leerPresets</span><span class="token punctuation">(</span><span class="token variable">$id_usuario</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token global">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;para&apos;</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string single-quoted-string">&apos;mostrar&apos;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token variable">$res</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;&lt;option value=&apos;none&apos;&gt;Sin preset&lt;/option&gt;&quot;</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-foreach">foreach</span> <span class="token punctuation">(</span><span class="token variable">$presets</span> <span class="token keyword keyword-as">as</span> <span class="token variable">$index</span> <span class="token operator">=&gt;</span> <span class="token variable">$datos</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token variable">$nombre_preset</span> <span class="token operator">=</span> <span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$datos</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;configuracion&apos;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token function">strpos</span><span class="token punctuation">(</span><span class="token variable">$datos</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;configuracion&apos;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">&apos;@&apos;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token variable">$res</span> <span class="token operator">.=</span> <span class="token string double-quoted-string">&quot;&lt;option value=&apos;&quot;</span> <span class="token operator">.</span> <span class="token variable">$nombre_preset</span> <span class="token operator">.</span> <span class="token string double-quoted-string">&quot;&apos;&gt;&quot;</span> <span class="token operator">.</span> <span class="token variable">$nombre_preset</span> <span class="token operator">.</span> <span class="token string double-quoted-string">&quot;&lt;/option&gt;&quot;</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword keyword-echo">echo</span> <span class="token variable">$res</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token global">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;para&apos;</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string single-quoted-string">&apos;cargar&apos;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword keyword-echo">echo</span> <span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token variable">$presets</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token variable">$opcion</span> <span class="token operator">==</span> <span class="token string single-quoted-string">&apos;borrar&apos;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token variable">$datos</span> <span class="token operator">=</span> <span class="token function">json_decode</span><span class="token punctuation">(</span><span class="token global">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;arrdatos&apos;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$usuario</span> <span class="token operator">=</span> <span class="token variable">$datos</span><span class="token operator">-&gt;</span><span class="token property">nombre</span><span class="token punctuation">;</span>
    <span class="token variable">$id_usuario</span> <span class="token operator">=</span> <span class="token variable">$db</span><span class="token operator">-&gt;</span><span class="token function">obtenerIdUsuario</span><span class="token punctuation">(</span><span class="token variable">$usuario</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token variable">$id_usuario</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token variable">$preset</span> <span class="token operator">=</span> <span class="token global">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;preset&apos;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token variable">$db</span><span class="token operator">-&gt;</span><span class="token function">borrarPreset</span><span class="token punctuation">(</span><span class="token variable">$preset</span><span class="token punctuation">,</span> <span class="token variable">$id_usuario</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</pre><h3>5.2.7 <strong>A_Informes.php</strong></h3>
<blockquote>
<p>requiere Database.php, Koolreport/core/autoload.php, Informecaudales.php, Validador.php</p>
</blockquote>
<blockquote>
<p><span style="color:green">@params</span> <b>String</b> opcion, <b>TS</b> fechaIni, <b>TS</b> fechaFin, <b>Array</b> nombres</p>
</blockquote>
<p>Este archivo se usa en la secci&#xF3;n de informes y se encarga de extraer los datos de los informes seg&#xFA;n una serie de par&#xE1;metros para despues formatearlos y usar Koolreport y crear el informe.</p>
<pre data-role="codeBlock" data-info="php" class="language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token keyword keyword-require_once">require_once</span> <span class="token string single-quoted-string">&apos;../app/Database/Database.php&apos;</span><span class="token punctuation">;</span>
<span class="token keyword keyword-require_once">require_once</span> <span class="token string double-quoted-string">&quot;../app/Libraries/koolreport/core/autoload.php&quot;</span><span class="token punctuation">;</span>
<span class="token keyword keyword-require_once">require_once</span> <span class="token string single-quoted-string">&apos;../app/Models/InformeCaudales.php&apos;</span><span class="token punctuation">;</span>
<span class="token keyword keyword-require">require</span> <span class="token string single-quoted-string">&apos;../app/Models/Validador.php&apos;</span><span class="token punctuation">;</span>
<span class="token keyword keyword-use">use</span> <span class="token package"><span class="token punctuation">\</span>koolreport<span class="token punctuation">\</span>widgets<span class="token punctuation">\</span>koolphp<span class="token punctuation">\</span>Table</span><span class="token punctuation">;</span>
<span class="token variable">$db</span> <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token class-name">Database</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$opcion</span> <span class="token operator">=</span> <span class="token global">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;opcion&apos;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token variable">$fechaIni</span> <span class="token operator">=</span> <span class="token global">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;fechaIni&apos;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token variable">$fechaFin</span> <span class="token operator">=</span> <span class="token global">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;fechaFin&apos;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token variable">$nombres</span> <span class="token operator">=</span> <span class="token function">json_decode</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token global">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;arrNombres&apos;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token variable">$opcion</span> <span class="token operator">==</span> <span class="token string double-quoted-string">&quot;cau&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token variable">$estaciones</span> <span class="token operator">=</span> <span class="token function">json_decode</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token global">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;arrEstaciones&apos;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$informesDep</span> <span class="token operator">=</span> <span class="token keyword keyword-array">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$informeDep</span> <span class="token operator">=</span> <span class="token keyword keyword-array">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$informeTabla</span> <span class="token operator">=</span> <span class="token keyword keyword-array">array</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;estacion&apos;</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">&apos;se&#xF1;al&apos;</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">&apos;fecha&apos;</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">&apos;maximo&apos;</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">&apos;minimo&apos;</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">&apos;media&apos;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-foreach">foreach</span> <span class="token punctuation">(</span><span class="token variable">$estaciones</span> <span class="token keyword keyword-as">as</span> <span class="token variable">$index</span> <span class="token operator">=&gt;</span> <span class="token variable">$estacion</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token variable">$informeDep</span> <span class="token operator">=</span> <span class="token variable">$db</span><span class="token operator">-&gt;</span><span class="token property">informeSe</span>&#xF1;<span class="token function">alEstacion</span><span class="token punctuation">(</span><span class="token variable">$estacion</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">&apos;cau&apos;</span><span class="token punctuation">,</span> <span class="token variable">$fechaIni</span><span class="token punctuation">,</span> <span class="token variable">$fechaFin</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token variable">$informeDep</span> <span class="token operator">!=</span> <span class="token constant">null</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token keyword keyword-empty">empty</span><span class="token punctuation">(</span><span class="token variable">$informeDep</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token variable">$informesDep</span><span class="token punctuation">[</span><span class="token variable">$estacion</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$informeDep</span><span class="token punctuation">;</span>
                <span class="token keyword keyword-foreach">foreach</span> <span class="token punctuation">(</span><span class="token variable">$informeDep</span> <span class="token keyword keyword-as">as</span> <span class="token variable">$se</span>&#xF1;al <span class="token operator">=&gt;</span> <span class="token variable">$info</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword keyword-foreach">foreach</span> <span class="token punctuation">(</span><span class="token variable">$info</span> <span class="token keyword keyword-as">as</span> <span class="token variable">$index</span> <span class="token operator">=&gt;</span> <span class="token variable">$datos</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token variable">$informeTabla</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token variable">$nombres</span><span class="token punctuation">[</span><span class="token variable">$estacion</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token variable">$se</span>&#xF1;al<span class="token punctuation">,</span> <span class="token variable">$datos</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;fecha&apos;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token variable">$datos</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;maximo&apos;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token variable">$datos</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;minimo&apos;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token variable">$datos</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;media&apos;</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token variable">$informe</span> <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token class-name">InformeCaudales</span><span class="token punctuation">(</span><span class="token variable">$informeTabla</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$informe</span><span class="token operator">-&gt;</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$table</span> <span class="token operator">=</span> <span class="token scope">Table<span class="token punctuation">::</span></span><span class="token function">create</span><span class="token punctuation">(</span><span class="token keyword keyword-array">array</span><span class="token punctuation">(</span>
            <span class="token string double-quoted-string">&quot;dataSource&quot;</span> <span class="token operator">=&gt;</span> <span class="token variable">$informeTabla</span><span class="token punctuation">,</span>
            <span class="token string double-quoted-string">&quot;sorting&quot;</span> <span class="token operator">=&gt;</span> <span class="token keyword keyword-array">array</span><span class="token punctuation">(</span>
                <span class="token string double-quoted-string">&quot;fecha&quot;</span><span class="token operator">=&gt;</span><span class="token string double-quoted-string">&quot;desc&quot;</span>
            <span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token string double-quoted-string">&quot;columns&quot;</span> <span class="token operator">=&gt;</span> <span class="token keyword keyword-array">array</span><span class="token punctuation">(</span>
                <span class="token string double-quoted-string">&quot;fecha&quot;</span> <span class="token operator">=&gt;</span> <span class="token keyword keyword-array">array</span><span class="token punctuation">(</span>
                    <span class="token string double-quoted-string">&quot;cssStyle&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;text-align:left&quot;</span>
                <span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token string double-quoted-string">&quot;maximo&quot;</span> <span class="token operator">=&gt;</span> <span class="token keyword keyword-array">array</span><span class="token punctuation">(</span>
                    <span class="token string double-quoted-string">&quot;cssStyle&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;text-align:center&quot;</span>
                <span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token string double-quoted-string">&quot;minimo&quot;</span> <span class="token operator">=&gt;</span> <span class="token keyword keyword-array">array</span><span class="token punctuation">(</span>
                    <span class="token string double-quoted-string">&quot;cssStyle&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;text-align:center&quot;</span>
                <span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token string double-quoted-string">&quot;media&quot;</span> <span class="token operator">=&gt;</span> <span class="token keyword keyword-array">array</span><span class="token punctuation">(</span>
                    <span class="token string double-quoted-string">&quot;cssStyle&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;text-align:center&quot;</span>
                <span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token string double-quoted-string">&quot;grouping&quot;</span> <span class="token operator">=&gt;</span> <span class="token keyword keyword-array">array</span><span class="token punctuation">(</span>
                <span class="token string double-quoted-string">&quot;estacion&quot;</span> <span class="token operator">=&gt;</span> <span class="token keyword keyword-array">array</span><span class="token punctuation">(</span>
                    <span class="token string double-quoted-string">&quot;top&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;&lt;td colspan=4 style=&apos;background-color:rgb(39,45,79);font-size:120%;color:whitesmoke;&apos;&gt;&lt;b&gt;{estacion}:&lt;/b&gt;&lt;/td&gt;&quot;</span><span class="token punctuation">,</span>
                <span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token string double-quoted-string">&quot;se&#xF1;al&quot;</span> <span class="token operator">=&gt;</span> <span class="token keyword keyword-array">array</span><span class="token punctuation">(</span>
                    <span class="token string double-quoted-string">&quot;calculate&quot;</span> <span class="token operator">=&gt;</span> <span class="token keyword keyword-array">array</span><span class="token punctuation">(</span>
                        <span class="token string double-quoted-string">&quot;{max}&quot;</span> <span class="token operator">=&gt;</span> <span class="token keyword keyword-array">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;max&quot;</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">&quot;maximo&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                        <span class="token string double-quoted-string">&quot;{med}&quot;</span> <span class="token operator">=&gt;</span> <span class="token keyword keyword-array">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;avg&quot;</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">&quot;media&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                        <span class="token string double-quoted-string">&quot;{min}&quot;</span> <span class="token operator">=&gt;</span> <span class="token keyword keyword-array">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;min&quot;</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">&quot;minimo&quot;</span><span class="token punctuation">)</span>
                    <span class="token punctuation">)</span><span class="token punctuation">,</span>
                    <span class="token string double-quoted-string">&quot;top&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;&lt;td style=&apos;background-color:rgb(1, 168, 184);font-size:100%;color:rgba(56, 56, 56);&apos;&gt;&lt;b&gt;{se&#xF1;al}:&lt;/b&gt;&lt;/td&gt;
                &lt;td style=&apos;background-color:rgb(1, 168, 184);font-size:100%;color:rgba(56, 56, 56);text-align:center&apos;&gt;&lt;b&gt;Maximo:&lt;/b&gt;&lt;/td&gt;
                &lt;td style=&apos;background-color:rgb(1, 168, 184);font-size:100%;color:rgba(56, 56, 56);text-align:center&apos;&gt;&lt;b&gt;Minimo:&lt;/b&gt;&lt;/td&gt;
                &lt;td style=&apos;background-color:rgb(1, 168, 184);font-size:100%;color:rgba(56, 56, 56);text-align:center&apos;&gt;&lt;b&gt;Media:&lt;/b&gt;&lt;/td&gt;&quot;</span><span class="token punctuation">,</span>
                    <span class="token string double-quoted-string">&quot;bottom&quot;</span> <span class="token operator">=&gt;</span> <span class="token keyword keyword-function">function</span> <span class="token punctuation">(</span><span class="token variable">$val</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token variable">$fila</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;&lt;td style=&apos;background-color:grey;font-size:100%;color:white;&apos;&gt;&lt;b&gt;Resumen de &quot;</span> <span class="token operator">.</span> <span class="token variable">$val</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;{se&#xF1;al}&apos;</span><span class="token punctuation">]</span> <span class="token operator">.</span> <span class="token string double-quoted-string">&quot;:&lt;/b&gt;&lt;/td&gt;
                   &lt;td style=&apos;background-color:grey;font-size:100%;color:white;text-align:center&apos;&gt; Maximo: &quot;</span> <span class="token operator">.</span> <span class="token variable">$val</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;{max}&apos;</span><span class="token punctuation">]</span> <span class="token operator">.</span> <span class="token string double-quoted-string">&quot;&lt;/td&gt;
                   &lt;td style=&apos;background-color:grey;font-size:100%;color:white;text-align:center&apos;&gt; Minimo: &quot;</span> <span class="token operator">.</span> <span class="token variable">$val</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;{min}&apos;</span><span class="token punctuation">]</span> <span class="token operator">.</span> <span class="token string double-quoted-string">&quot;&lt;/td&gt;
                   &lt;td style=&apos;background-color:grey;font-size:100%;color:white;text-align:center&apos;&gt; Media: &quot;</span> <span class="token operator">.</span> <span class="token function">number_format</span><span class="token punctuation">(</span><span class="token variable">$val</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;{med}&apos;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">.</span> <span class="token string double-quoted-string">&quot;&lt;/td&gt;&quot;</span><span class="token punctuation">;</span>
                        <span class="token keyword keyword-return">return</span> <span class="token variable">$fila</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">)</span>
            <span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token string double-quoted-string">&quot;showHeader&quot;</span> <span class="token operator">=&gt;</span> <span class="token constant boolean">false</span><span class="token punctuation">,</span>
            <span class="token string double-quoted-string">&quot;cssClass&quot;</span> <span class="token operator">=&gt;</span> <span class="token keyword keyword-array">array</span><span class="token punctuation">(</span>
                <span class="token string double-quoted-string">&quot;table&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;table table-hover table-bordered&quot;</span><span class="token punctuation">,</span>
            <span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token variable">$opcion</span> <span class="token operator">==</span> <span class="token string double-quoted-string">&quot;niv&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token variable">$estaciones</span> <span class="token operator">=</span> <span class="token function">json_decode</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token global">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;arrEstaciones&apos;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$informesDep</span> <span class="token operator">=</span> <span class="token keyword keyword-array">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$informeDep</span> <span class="token operator">=</span> <span class="token keyword keyword-array">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$informeTabla</span> <span class="token operator">=</span> <span class="token keyword keyword-array">array</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;estacion&apos;</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">&apos;se&#xF1;al&apos;</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">&apos;fecha&apos;</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">&apos;maximo&apos;</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">&apos;minimo&apos;</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">&apos;media&apos;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-foreach">foreach</span> <span class="token punctuation">(</span><span class="token variable">$estaciones</span> <span class="token keyword keyword-as">as</span> <span class="token variable">$index</span> <span class="token operator">=&gt;</span> <span class="token variable">$estacion</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// $informesDep[] = $estacion;</span>
            <span class="token variable">$informeDep</span> <span class="token operator">=</span> <span class="token variable">$db</span><span class="token operator">-&gt;</span><span class="token property">informeSe</span>&#xF1;<span class="token function">alEstacion</span><span class="token punctuation">(</span><span class="token variable">$estacion</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">&apos;niv&apos;</span><span class="token punctuation">,</span> <span class="token variable">$fechaIni</span><span class="token punctuation">,</span> <span class="token variable">$fechaFin</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token variable">$informeDep</span> <span class="token operator">!=</span> <span class="token constant">null</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token keyword keyword-empty">empty</span><span class="token punctuation">(</span><span class="token variable">$informeDep</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token variable">$informesDep</span><span class="token punctuation">[</span><span class="token variable">$estacion</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$informeDep</span><span class="token punctuation">;</span>
                <span class="token keyword keyword-foreach">foreach</span> <span class="token punctuation">(</span><span class="token variable">$informeDep</span> <span class="token keyword keyword-as">as</span> <span class="token variable">$se</span>&#xF1;al <span class="token operator">=&gt;</span> <span class="token variable">$info</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword keyword-foreach">foreach</span> <span class="token punctuation">(</span><span class="token variable">$info</span> <span class="token keyword keyword-as">as</span> <span class="token variable">$index</span> <span class="token operator">=&gt;</span> <span class="token variable">$datos</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token variable">$informeTabla</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token variable">$nombres</span><span class="token punctuation">[</span><span class="token variable">$estacion</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token variable">$se</span>&#xF1;al<span class="token punctuation">,</span> <span class="token variable">$datos</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;fecha&apos;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token variable">$datos</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;maximo&apos;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token variable">$datos</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;minimo&apos;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token variable">$datos</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;media&apos;</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token variable">$informe</span> <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token class-name">InformeCaudales</span><span class="token punctuation">(</span><span class="token variable">$informeTabla</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$informe</span><span class="token operator">-&gt;</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$table</span> <span class="token operator">=</span> <span class="token scope">Table<span class="token punctuation">::</span></span><span class="token function">create</span><span class="token punctuation">(</span><span class="token keyword keyword-array">array</span><span class="token punctuation">(</span>
            <span class="token string double-quoted-string">&quot;dataSource&quot;</span> <span class="token operator">=&gt;</span> <span class="token variable">$informeTabla</span><span class="token punctuation">,</span>
            <span class="token string double-quoted-string">&quot;sorting&quot;</span> <span class="token operator">=&gt;</span> <span class="token keyword keyword-array">array</span><span class="token punctuation">(</span>
                <span class="token string double-quoted-string">&quot;fecha&quot;</span><span class="token operator">=&gt;</span><span class="token string double-quoted-string">&quot;desc&quot;</span>
            <span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token string double-quoted-string">&quot;columns&quot;</span> <span class="token operator">=&gt;</span> <span class="token keyword keyword-array">array</span><span class="token punctuation">(</span>
                <span class="token string double-quoted-string">&quot;fecha&quot;</span> <span class="token operator">=&gt;</span> <span class="token keyword keyword-array">array</span><span class="token punctuation">(</span>
                    <span class="token string double-quoted-string">&quot;cssStyle&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;text-align:center&quot;</span>
                <span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token string double-quoted-string">&quot;maximo&quot;</span> <span class="token operator">=&gt;</span> <span class="token keyword keyword-array">array</span><span class="token punctuation">(</span>
                    <span class="token string double-quoted-string">&quot;cssStyle&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;text-align:center&quot;</span>
                <span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token string double-quoted-string">&quot;minimo&quot;</span> <span class="token operator">=&gt;</span> <span class="token keyword keyword-array">array</span><span class="token punctuation">(</span>
                    <span class="token string double-quoted-string">&quot;cssStyle&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;text-align:center&quot;</span>
                <span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token string double-quoted-string">&quot;media&quot;</span> <span class="token operator">=&gt;</span> <span class="token keyword keyword-array">array</span><span class="token punctuation">(</span>
                    <span class="token string double-quoted-string">&quot;cssStyle&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;text-align:center&quot;</span>
                <span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token string double-quoted-string">&quot;grouping&quot;</span> <span class="token operator">=&gt;</span> <span class="token keyword keyword-array">array</span><span class="token punctuation">(</span>
                <span class="token string double-quoted-string">&quot;estacion&quot;</span> <span class="token operator">=&gt;</span> <span class="token keyword keyword-array">array</span><span class="token punctuation">(</span>
                    <span class="token string double-quoted-string">&quot;top&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;&lt;td colspan=4 style=&apos;background-color:rgb(39,45,79);font-size:120%;color:whitesmoke;&apos;&gt;&lt;b&gt;{estacion}:&lt;/b&gt;&lt;/td&gt;&quot;</span><span class="token punctuation">,</span>
                <span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token string double-quoted-string">&quot;se&#xF1;al&quot;</span> <span class="token operator">=&gt;</span> <span class="token keyword keyword-array">array</span><span class="token punctuation">(</span>
                    <span class="token string double-quoted-string">&quot;calculate&quot;</span> <span class="token operator">=&gt;</span> <span class="token keyword keyword-array">array</span><span class="token punctuation">(</span>
                        <span class="token string double-quoted-string">&quot;{max}&quot;</span> <span class="token operator">=&gt;</span> <span class="token keyword keyword-array">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;max&quot;</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">&quot;maximo&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                        <span class="token string double-quoted-string">&quot;{med}&quot;</span> <span class="token operator">=&gt;</span> <span class="token keyword keyword-array">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;avg&quot;</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">&quot;media&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                        <span class="token string double-quoted-string">&quot;{min}&quot;</span> <span class="token operator">=&gt;</span> <span class="token keyword keyword-array">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;min&quot;</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">&quot;minimo&quot;</span><span class="token punctuation">)</span>
                    <span class="token punctuation">)</span><span class="token punctuation">,</span>
                    <span class="token string double-quoted-string">&quot;top&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;&lt;td style=&apos;background-color:rgb(1, 168, 184);font-size:100%;color:rgba(56, 56, 56);&apos;&gt;&lt;b&gt;{se&#xF1;al}:&lt;/b&gt;&lt;/td&gt;
                &lt;td style=&apos;background-color:rgb(1, 168, 184);font-size:100%;color:rgba(56, 56, 56);text-align:center&apos;&gt;&lt;b&gt;Maximo:&lt;/b&gt;&lt;/td&gt;
                &lt;td style=&apos;background-color:rgb(1, 168, 184);font-size:100%;color:rgba(56, 56, 56);text-align:center&apos;&gt;&lt;b&gt;Minimo:&lt;/b&gt;&lt;/td&gt;
                &lt;td style=&apos;background-color:rgb(1, 168, 184);font-size:100%;color:rgba(56, 56, 56);text-align:center&apos;&gt;&lt;b&gt;Media:&lt;/b&gt;&lt;/td&gt;&quot;</span><span class="token punctuation">,</span>
                    <span class="token string double-quoted-string">&quot;bottom&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;&lt;td style=&apos;background-color:grey;font-size:100%;color:white;&apos;&gt;&lt;b&gt;Resumen de {se&#xF1;al}:&lt;/b&gt;&lt;/td&gt;
                &lt;td style=&apos;background-color:grey;font-size:100%;color:white;text-align:center&apos;&gt; Maximo: {max}&lt;/td&gt;
                &lt;td style=&apos;background-color:grey;font-size:100%;color:white;text-align:center&apos;&gt; Minimo: {min}&lt;/td&gt;
                &lt;td style=&apos;background-color:grey;font-size:100%;color:white;text-align:center&apos;&gt; Media: {med}&lt;/td&gt;&quot;</span><span class="token punctuation">,</span>
                <span class="token punctuation">)</span>
            <span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token string double-quoted-string">&quot;showHeader&quot;</span> <span class="token operator">=&gt;</span> <span class="token constant boolean">false</span><span class="token punctuation">,</span>
            <span class="token string double-quoted-string">&quot;cssClass&quot;</span> <span class="token operator">=&gt;</span> <span class="token keyword keyword-array">array</span><span class="token punctuation">(</span>
                <span class="token string double-quoted-string">&quot;table&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;table table-hover table-bordered&quot;</span><span class="token punctuation">,</span>
            <span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token variable">$opcion</span> <span class="token operator">==</span> <span class="token string double-quoted-string">&quot;acu&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token variable">$estaciones</span> <span class="token operator">=</span> <span class="token function">json_decode</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token global">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;arrEstaciones&apos;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$informesDep</span> <span class="token operator">=</span> <span class="token keyword keyword-array">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$informeDep</span> <span class="token operator">=</span> <span class="token keyword keyword-array">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$informeTabla</span> <span class="token operator">=</span> <span class="token keyword keyword-array">array</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;estacion&apos;</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">&apos;se&#xF1;al&apos;</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">&apos;fecha&apos;</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">&apos;valor&apos;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-foreach">foreach</span> <span class="token punctuation">(</span><span class="token variable">$estaciones</span> <span class="token keyword keyword-as">as</span> <span class="token variable">$index</span> <span class="token operator">=&gt;</span> <span class="token variable">$estacion</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token variable">$informeDep</span> <span class="token operator">=</span> <span class="token variable">$db</span><span class="token operator">-&gt;</span><span class="token property">informeSe</span>&#xF1;<span class="token function">alEstacion</span><span class="token punctuation">(</span><span class="token variable">$estacion</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">&apos;acu&apos;</span><span class="token punctuation">,</span> <span class="token variable">$fechaIni</span><span class="token punctuation">,</span> <span class="token variable">$fechaFin</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token variable">$informeDep</span> <span class="token operator">!=</span> <span class="token constant">null</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token keyword keyword-empty">empty</span><span class="token punctuation">(</span><span class="token variable">$informeDep</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token variable">$informesDep</span><span class="token punctuation">[</span><span class="token variable">$estacion</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$informeDep</span><span class="token punctuation">;</span>
                <span class="token keyword keyword-foreach">foreach</span> <span class="token punctuation">(</span><span class="token variable">$informeDep</span> <span class="token keyword keyword-as">as</span> <span class="token variable">$se</span>&#xF1;al <span class="token operator">=&gt;</span> <span class="token variable">$info</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword keyword-foreach">foreach</span> <span class="token punctuation">(</span><span class="token variable">$info</span> <span class="token keyword keyword-as">as</span> <span class="token variable">$index</span> <span class="token operator">=&gt;</span> <span class="token variable">$datos</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token variable">$informeTabla</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token variable">$nombres</span><span class="token punctuation">[</span><span class="token variable">$estacion</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token variable">$se</span>&#xF1;al<span class="token punctuation">,</span> <span class="token variable">$datos</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;fecha&apos;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token variable">$datos</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;valor&apos;</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token variable">$informe</span> <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token class-name">InformeCaudales</span><span class="token punctuation">(</span><span class="token variable">$informeTabla</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$informe</span><span class="token operator">-&gt;</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$table</span> <span class="token operator">=</span> <span class="token scope">Table<span class="token punctuation">::</span></span><span class="token function">create</span><span class="token punctuation">(</span><span class="token keyword keyword-array">array</span><span class="token punctuation">(</span>
            <span class="token string double-quoted-string">&quot;dataSource&quot;</span> <span class="token operator">=&gt;</span> <span class="token variable">$informeTabla</span><span class="token punctuation">,</span>
            <span class="token string double-quoted-string">&quot;sorting&quot;</span> <span class="token operator">=&gt;</span> <span class="token keyword keyword-array">array</span><span class="token punctuation">(</span>
                <span class="token string double-quoted-string">&quot;fecha&quot;</span><span class="token operator">=&gt;</span><span class="token string double-quoted-string">&quot;desc&quot;</span>
            <span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token string double-quoted-string">&quot;columns&quot;</span> <span class="token operator">=&gt;</span> <span class="token keyword keyword-array">array</span><span class="token punctuation">(</span>

                <span class="token string double-quoted-string">&quot;fecha&quot;</span> <span class="token operator">=&gt;</span> <span class="token keyword keyword-array">array</span><span class="token punctuation">(</span>
                    <span class="token string double-quoted-string">&quot;cssStyle&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;text-align:left&quot;</span>
                <span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token string double-quoted-string">&quot;valor&quot;</span> <span class="token operator">=&gt;</span> <span class="token keyword keyword-array">array</span><span class="token punctuation">(</span>
                    <span class="token string double-quoted-string">&quot;cssStyle&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;text-align:center&quot;</span>
                <span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token string double-quoted-string">&quot;grouping&quot;</span> <span class="token operator">=&gt;</span> <span class="token keyword keyword-array">array</span><span class="token punctuation">(</span>
                <span class="token string double-quoted-string">&quot;estacion&quot;</span> <span class="token operator">=&gt;</span> <span class="token keyword keyword-array">array</span><span class="token punctuation">(</span>
                    <span class="token string double-quoted-string">&quot;top&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;&lt;td colspan=4 style=&apos;background-color:rgb(39,45,79);font-size:120%;color:whitesmoke;&apos;&gt;&lt;b&gt;{estacion}:&lt;/b&gt;&lt;/td&gt;&quot;</span><span class="token punctuation">,</span>
                <span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token string double-quoted-string">&quot;se&#xF1;al&quot;</span> <span class="token operator">=&gt;</span> <span class="token keyword keyword-array">array</span><span class="token punctuation">(</span>
                    <span class="token string double-quoted-string">&quot;calculate&quot;</span> <span class="token operator">=&gt;</span> <span class="token keyword keyword-array">array</span><span class="token punctuation">(</span>
                        <span class="token string double-quoted-string">&quot;{maxi}&quot;</span> <span class="token operator">=&gt;</span> <span class="token keyword keyword-array">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;sum&quot;</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">&quot;valor&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    <span class="token punctuation">)</span><span class="token punctuation">,</span>
                    <span class="token string double-quoted-string">&quot;top&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;&lt;td style=&apos;background-color:rgb(1, 168, 184);font-size:100%;color:rgba(56, 56, 56);text-align:left&apos;&gt;&lt;b&gt;{se&#xF1;al}:&lt;/b&gt;&lt;/td&gt;
                            &lt;td style=&apos;background-color:rgb(1, 168, 184);font-size:100%;color:rgba(56, 56, 56);text-align:center&apos;&gt;&lt;b&gt;acumulado:&lt;/b&gt;&lt;/td&gt;&quot;</span><span class="token punctuation">,</span>

                    <span class="token string double-quoted-string">&quot;bottom&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;&lt;td  style=&apos;background-color:grey;font-size:100%;color:white;&apos;&gt;&lt;b&gt;Total de {se&#xF1;al}:&lt;/b&gt;&lt;/td&gt;
                            &lt;td style=&apos;background-color:grey;font-size:100%;color:white;text-align:center&apos;&gt;&lt;b&gt;{maxi}&lt;/b&gt;&lt;/td&gt;&quot;</span><span class="token punctuation">,</span>
                <span class="token punctuation">)</span>
            <span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token string double-quoted-string">&quot;showHeader&quot;</span> <span class="token operator">=&gt;</span> <span class="token constant boolean">false</span><span class="token punctuation">,</span>
            <span class="token string double-quoted-string">&quot;cssClass&quot;</span> <span class="token operator">=&gt;</span> <span class="token keyword keyword-array">array</span><span class="token punctuation">(</span>
                <span class="token string double-quoted-string">&quot;table&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;table table-hover table-bordered&quot;</span><span class="token punctuation">,</span>
            <span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token variable">$opcion</span> <span class="token operator">==</span> <span class="token string double-quoted-string">&quot;clo&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token variable">$estaciones</span> <span class="token operator">=</span> <span class="token function">json_decode</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token global">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;arrEstaciones&apos;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$informesDep</span> <span class="token operator">=</span> <span class="token keyword keyword-array">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$informeDep</span> <span class="token operator">=</span> <span class="token keyword keyword-array">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$informeTabla</span> <span class="token operator">=</span> <span class="token keyword keyword-array">array</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;estacion&apos;</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">&apos;se&#xF1;al&apos;</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">&apos;fecha&apos;</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">&apos;maximo&apos;</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">&apos;minimo&apos;</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">&apos;media&apos;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-foreach">foreach</span> <span class="token punctuation">(</span><span class="token variable">$estaciones</span> <span class="token keyword keyword-as">as</span> <span class="token variable">$index</span> <span class="token operator">=&gt;</span> <span class="token variable">$estacion</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token variable">$informeDep</span> <span class="token operator">=</span> <span class="token variable">$db</span><span class="token operator">-&gt;</span><span class="token property">informeSe</span>&#xF1;<span class="token function">alEstacion</span><span class="token punctuation">(</span><span class="token variable">$estacion</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">&apos;clo&apos;</span><span class="token punctuation">,</span> <span class="token variable">$fechaIni</span><span class="token punctuation">,</span> <span class="token variable">$fechaFin</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token variable">$informeDep</span> <span class="token operator">!=</span> <span class="token constant">null</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token keyword keyword-empty">empty</span><span class="token punctuation">(</span><span class="token variable">$informeDep</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token variable">$informesDep</span><span class="token punctuation">[</span><span class="token variable">$estacion</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$informeDep</span><span class="token punctuation">;</span>
                <span class="token keyword keyword-foreach">foreach</span> <span class="token punctuation">(</span><span class="token variable">$informeDep</span> <span class="token keyword keyword-as">as</span> <span class="token variable">$se</span>&#xF1;al <span class="token operator">=&gt;</span> <span class="token variable">$info</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword keyword-foreach">foreach</span> <span class="token punctuation">(</span><span class="token variable">$info</span> <span class="token keyword keyword-as">as</span> <span class="token variable">$index</span> <span class="token operator">=&gt;</span> <span class="token variable">$datos</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token variable">$informeTabla</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token variable">$nombres</span><span class="token punctuation">[</span><span class="token variable">$estacion</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token variable">$se</span>&#xF1;al<span class="token punctuation">,</span> <span class="token variable">$datos</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;fecha&apos;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token variable">$datos</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;maximo&apos;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token variable">$datos</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;minimo&apos;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token variable">$datos</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&apos;media&apos;</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token variable">$informe</span> <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token class-name">InformeCaudales</span><span class="token punctuation">(</span><span class="token variable">$informeTabla</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$informe</span><span class="token operator">-&gt;</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$table</span> <span class="token operator">=</span> <span class="token scope">Table<span class="token punctuation">::</span></span><span class="token function">create</span><span class="token punctuation">(</span><span class="token keyword keyword-array">array</span><span class="token punctuation">(</span>
            <span class="token string double-quoted-string">&quot;dataSource&quot;</span> <span class="token operator">=&gt;</span> <span class="token variable">$informeTabla</span><span class="token punctuation">,</span>
            <span class="token string double-quoted-string">&quot;sorting&quot;</span> <span class="token operator">=&gt;</span> <span class="token keyword keyword-array">array</span><span class="token punctuation">(</span>
                <span class="token string double-quoted-string">&quot;fecha&quot;</span><span class="token operator">=&gt;</span><span class="token string double-quoted-string">&quot;desc&quot;</span>
            <span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token string double-quoted-string">&quot;columns&quot;</span> <span class="token operator">=&gt;</span> <span class="token keyword keyword-array">array</span><span class="token punctuation">(</span>
                <span class="token string double-quoted-string">&quot;fecha&quot;</span> <span class="token operator">=&gt;</span> <span class="token keyword keyword-array">array</span><span class="token punctuation">(</span>
                    <span class="token string double-quoted-string">&quot;cssStyle&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;text-align:center&quot;</span>
                <span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token string double-quoted-string">&quot;maximo&quot;</span> <span class="token operator">=&gt;</span> <span class="token keyword keyword-array">array</span><span class="token punctuation">(</span>
                    <span class="token string double-quoted-string">&quot;cssStyle&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;text-align:center&quot;</span>
                <span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token string double-quoted-string">&quot;minimo&quot;</span> <span class="token operator">=&gt;</span> <span class="token keyword keyword-array">array</span><span class="token punctuation">(</span>
                    <span class="token string double-quoted-string">&quot;cssStyle&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;text-align:center&quot;</span>
                <span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token string double-quoted-string">&quot;media&quot;</span> <span class="token operator">=&gt;</span> <span class="token keyword keyword-array">array</span><span class="token punctuation">(</span>
                    <span class="token string double-quoted-string">&quot;cssStyle&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;text-align:center&quot;</span>
                <span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token string double-quoted-string">&quot;grouping&quot;</span> <span class="token operator">=&gt;</span> <span class="token keyword keyword-array">array</span><span class="token punctuation">(</span>
                <span class="token string double-quoted-string">&quot;estacion&quot;</span> <span class="token operator">=&gt;</span> <span class="token keyword keyword-array">array</span><span class="token punctuation">(</span>
                    <span class="token string double-quoted-string">&quot;top&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;&lt;td colspan=4 style=&apos;background-color:rgb(39,45,79);font-size:120%;color:whitesmoke;&apos;&gt;&lt;b&gt;{estacion}:&lt;/b&gt;&lt;/td&gt;&quot;</span><span class="token punctuation">,</span>
                <span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token string double-quoted-string">&quot;se&#xF1;al&quot;</span> <span class="token operator">=&gt;</span> <span class="token keyword keyword-array">array</span><span class="token punctuation">(</span>
                    <span class="token string double-quoted-string">&quot;calculate&quot;</span> <span class="token operator">=&gt;</span> <span class="token keyword keyword-array">array</span><span class="token punctuation">(</span>
                        <span class="token string double-quoted-string">&quot;{max}&quot;</span> <span class="token operator">=&gt;</span> <span class="token keyword keyword-array">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;max&quot;</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">&quot;maximo&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                        <span class="token string double-quoted-string">&quot;{med}&quot;</span> <span class="token operator">=&gt;</span> <span class="token keyword keyword-array">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;avg&quot;</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">&quot;media&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                        <span class="token string double-quoted-string">&quot;{min}&quot;</span> <span class="token operator">=&gt;</span> <span class="token keyword keyword-array">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;min&quot;</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">&quot;minimo&quot;</span><span class="token punctuation">)</span>
                    <span class="token punctuation">)</span><span class="token punctuation">,</span>
                    <span class="token string double-quoted-string">&quot;top&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;&lt;td style=&apos;background-color:rgb(1, 168, 184);font-size:100%;color:rgba(56, 56, 56);&apos;&gt;&lt;b&gt;{se&#xF1;al}:&lt;/b&gt;&lt;/td&gt;
                &lt;td style=&apos;background-color:rgb(1, 168, 184);font-size:100%;color:rgba(56, 56, 56);text-align:center&apos;&gt;&lt;b&gt;Maximo:&lt;/b&gt;&lt;/td&gt;
                &lt;td style=&apos;background-color:rgb(1, 168, 184);font-size:100%;color:rgba(56, 56, 56);text-align:center&apos;&gt;&lt;b&gt;Minimo:&lt;/b&gt;&lt;/td&gt;
                &lt;td style=&apos;background-color:rgb(1, 168, 184);font-size:100%;color:rgba(56, 56, 56);text-align:center&apos;&gt;&lt;b&gt;Media:&lt;/b&gt;&lt;/td&gt;&quot;</span><span class="token punctuation">,</span>
                    <span class="token string double-quoted-string">&quot;bottom&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;&lt;td style=&apos;background-color:grey;font-size:100%;color:white;&apos;&gt;&lt;b&gt;Resumen de {se&#xF1;al}:&lt;/b&gt;&lt;/td&gt;
                &lt;td style=&apos;background-color:grey;font-size:100%;color:white;text-align:center&apos;&gt; Maximo: {max}&lt;/td&gt;
                &lt;td style=&apos;background-color:grey;font-size:100%;color:white;text-align:center&apos;&gt; Minimo: {min}&lt;/td&gt;
                &lt;td style=&apos;background-color:grey;font-size:100%;color:white;text-align:center&apos;&gt; Media: {med}&lt;/td&gt;&quot;</span><span class="token punctuation">,</span>
                <span class="token punctuation">)</span>
            <span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token string double-quoted-string">&quot;showHeader&quot;</span> <span class="token operator">=&gt;</span> <span class="token constant boolean">false</span><span class="token punctuation">,</span>
            <span class="token string double-quoted-string">&quot;cssClass&quot;</span> <span class="token operator">=&gt;</span> <span class="token keyword keyword-array">array</span><span class="token punctuation">(</span>
                <span class="token string double-quoted-string">&quot;table&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;table table-hover table-bordered&quot;</span><span class="token punctuation">,</span>
            <span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</pre><h3>5.2.8 <strong>A_Principal.php</strong></h3>
<blockquote>
<p>requiere Database.php</p>
</blockquote>
<blockquote>
<p><span style="color:green">@params</span> <b>String</b> opcion</p>
</blockquote>
<p>Este es el archivo que acompa&#xF1;a a la vista principal.php y gestiona los feeds de las se&#xF1;ales que lee como las configuradas por el usuario. Tambi&#xE9;n puede leer las configuraciones y modificarlas. Los resultados los devuelve en formato <span style="color:gold"><b>JS</b></span>ON.</p>
<h3>5.2.9 <strong>A_Reloj.php</strong> --&gt; obsoleta</h3>
<blockquote>
<p>requiere Void</p>
</blockquote>
<blockquote>
<p><span style="color:green">@params</span> Void</p>
</blockquote>
<p>Esta secci&#xF3;n se cargaba desde el inicio y comprobaba el estado de la sesi&#xF3;n en servidor para calcular tiempos fuera de la p&#xE1;gina. Ya no est&#xE1; en uso y depende del cliente.</p>
<h3>5.2.10 <strong>A_Sur.php</strong></h3>
<blockquote>
<p>requiere Database.php</p>
</blockquote>
<blockquote>
<p><span style="color:green">@params</span> <b>String</b> caso</p>
</blockquote>
<p>Este archivo es el que gestiona el men&#xFA; sur de alarmas. Dependiendo de la secci&#xF3;n en la que se encuentre, extrae las alarmas que aparecen en el men&#xFA; sur creando el c&#xF3;digo <b>HTML</b>.</p>
</div>
      </div>
      
      
    
    
    
    
    
    
    
    
  
    </body></html>